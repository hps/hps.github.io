var GlobalPayments=function(){"use strict";var e="function"==typeof fetch?fetch.bind():function(a,o){return o=o||{},new Promise(function(e,t){var r=new XMLHttpRequest;for(var n in r.open(o.method||"get",a),o.headers)r.setRequestHeader(n,o.headers[n]);function d(){var n,a=[],o=[],i={};return r.getAllResponseHeaders().replace(/^(.*?):\s*([\s\S]*?)$/gm,function(e,t,r){a.push(t=t.toLowerCase()),o.push([t,r]),n=i[t],i[t]=n?n+","+r:r}),{ok:1==(r.status/200|0),status:r.status,statusText:r.statusText,url:r.responseURL,clone:d,text:function(){return Promise.resolve(r.responseText)},json:function(){return Promise.resolve(r.responseText).then(JSON.parse)},blob:function(){return Promise.resolve(new Blob([r.response]))},headers:{keys:function(){return a},entries:function(){return o},get:function(e){return i[e.toLowerCase()]},has:function(e){return e.toLowerCase()in i}}}}r.withCredentials="include"==o.credentials,r.onload=function(){e(d())},r.onerror=t,r.send(o.body)})},t=Object.freeze({default:e}),r=t&&e||t;window.fetch||(window.fetch=r.default||r);var n=void 0;Array.prototype.forEach||(Array.prototype.forEach=function(e){for(var t=0;t<n.length;t++)e(n[t],t,n)});for(var o=function(e){for(var t,r=function(e){var t=e.length;if(0<t%4)throw new Error("Invalid string. Length must be a multiple of 4");var r=e.indexOf("=");-1===r&&(r=t);return[r,r===t?0:4-r%4]}(e),n=r[0],a=r[1],o=new p((s=n,u=a,3*(s+u)/4-u)),i=0,d=0<a?n-4:n,c=0;c<d;c+=4)t=l[e.charCodeAt(c)]<<18|l[e.charCodeAt(c+1)]<<12|l[e.charCodeAt(c+2)]<<6|l[e.charCodeAt(c+3)],o[i++]=t>>16&255,o[i++]=t>>8&255,o[i++]=255&t;var s,u;2===a&&(t=l[e.charCodeAt(c)]<<2|l[e.charCodeAt(c+1)]>>4,o[i++]=255&t);1===a&&(t=l[e.charCodeAt(c)]<<10|l[e.charCodeAt(c+1)]<<4|l[e.charCodeAt(c+2)]>>2,o[i++]=t>>8&255,o[i++]=255&t);return o},a=function(e){for(var t,r=e.length,n=r%3,a=[],o=0,i=r-n;o<i;o+=16383)a.push(u(e,o,i<o+16383?i:o+16383));1===n?(t=e[r-1],a.push(d[t>>2]+d[t<<4&63]+"==")):2===n&&(t=(e[r-2]<<8)+e[r-1],a.push(d[t>>10]+d[t>>4&63]+d[t<<2&63]+"="));return a.join("")},d=[],l=[],p="undefined"!=typeof Uint8Array?Uint8Array:Array,i="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",c=0,s=i.length;c<s;++c)d[c]=i[c],l[i.charCodeAt(c)]=c;function u(e,t,r){for(var n,a,o=[],i=t;i<r;i+=3)n=(e[i]<<16&16711680)+(e[i+1]<<8&65280)+(255&e[i+2]),o.push(d[(a=n)>>18&63]+d[a>>12&63]+d[a>>6&63]+d[63&a]);return o.join("")}l["-".charCodeAt(0)]=62,l["_".charCodeAt(0)]=63,window.btoa=window.btoa||function(e){var t,r=e.length,n=new("undefined"!=typeof Uint8Array?Uint8Array:Array)(r);for(t=0;t<r;t++)n[t]=e.charCodeAt(t);return a(n)},window.atob=window.atob||function(e){var t,r=o(e),n=r.length,a="";for(t=0;t<n;t++)a+=String.fromCharCode(r[t]);return a};var f,m=void 0,h={};!function(){function t(e){return e<10?"0"+e:e}if("function"!=typeof Date.prototype.toJSON){Date.prototype.toJSON=function(e){return isFinite(m.valueOf())?m.getUTCFullYear()+"-"+t(m.getUTCMonth()+1)+"-"+t(m.getUTCDate())+"T"+t(m.getUTCHours())+":"+t(m.getUTCMinutes())+":"+t(m.getUTCSeconds())+"Z":""};var e=String.prototype;Number.prototype.JSON=e.JSON=Boolean.prototype.toJSON=function(e){return m.valueOf()}}var u,l,p,r=/[\u0000\u00ad\u0600-\u0604\u070f\u17b4\u17b5\u200c-\u200f\u2028-\u202f\u2060-\u206f\ufeff\ufff0-\uffff]/g,n=/[\\\"\x00-\x1f\x7f-\x9f\u00ad\u0600-\u0604\u070f\u17b4\u17b5\u200c-\u200f\u2028-\u202f\u2060-\u206f\ufeff\ufff0-\uffff]/g,a={"\b":"\\b","\t":"\\t","\n":"\\n","\f":"\\f","\r":"\\r",'"':'\\"',"\\":"\\\\"};function f(e){return n.lastIndex=0,n.test(e)?'"'+e.replace(n,function(e){var t=a[e];return"string"==typeof t?t:"\\u"+("0000"+e.charCodeAt(0).toString(16)).slice(-4)})+'"':'"'+e+'"'}"function"!=typeof h.stringify&&(h.stringify=function(e,t,r){var n;if(l=u="","number"==typeof r)for(n=0;n<r;n+=1)l+=" ";else"string"==typeof r&&(l=r);if((p=t)&&"function"!=typeof t&&("object"!=typeof t||"number"!=typeof t.length))throw new Error("JSON.stringify");return function e(t,r){var n,a,o,i,d,c=u,s=r[t];switch(s&&"object"==typeof s&&"function"==typeof s.toJSON&&(s=s.toJSON(t)),"function"==typeof p&&(s=p.call(r,t,s)),typeof s){case"string":return f(s);case"number":return isFinite(s)?String(s):"null";case"boolean":case"null":return String(s);case"object":if(!s)return"null";if(u+=l,d=[],"[object Array]"===Object.prototype.toString.apply(s,[])){for(i=s.length,n=0;n<i;n+=1)d[n]=e(n.toString(),s)||"null";return o=0===d.length?"[]":u?"[\n"+u+d.join(",\n"+u)+"\n"+c+"]":"["+d.join(",")+"]",u=c,o}if(p&&"object"==typeof p)for(i=p.length,n=0;n<i;n+=1)"string"==typeof p[n]&&(o=e(a=p[n],s))&&d.push(f(a)+(u?": ":":")+o);else for(a in s)Object.prototype.hasOwnProperty.call(s,a)&&(o=e(a,s))&&d.push(f(a)+(u?": ":":")+o);return o=0===d.length?"{}":u?"{\n"+u+d.join(",\n"+u)+"\n"+c+"}":"{"+d.join(",")+"}",u=c,o}}("",{"":e})}),"function"!=typeof h.parse&&(h.parse=function(e,i){var t;if(e=String(e),r.lastIndex=0,r.test(e)&&(e=e.replace(r,function(e){return"\\u"+("0000"+e.charCodeAt(0).toString(16)).slice(-4)})),/^[\],:{}\s]*$/.test(e.replace(/\\(?:["\\\/bfnrt]|u[0-9a-fA-F]{4})/g,"@").replace(/"[^"\\\n\r]*"|true|false|null|-?\d+(?:\.\d*)?(?:[eE][+\-]?\d+)?/g,"]").replace(/(?:^|:|,)(?:\s*\[)+/g,"")))return t=new Function("return ("+e+")")(),"function"==typeof i?function e(t,r){var n,a,o=t[r];if(o&&"object"==typeof o)for(n in o)Object.prototype.hasOwnProperty.call(o,n)&&(a=e(o,n),o[n]=a);return i.call(t,r,o)}({"":t},""):t;throw new SyntaxError("JSON.parse")})}(),window.JSON=window.JSON||h,Object.freeze||(Object.freeze=function(e){if(Object(e)!==e)throw new TypeError("Object.freeze can only be called on Objects.");return e});try{Object.freeze(function(){})}catch(e){Object.freeze=(f=Object.freeze,function(e){return"function"==typeof e?e:f(e)})}Object.prototype.hasOwnProperty||(Object.prototype.hasOwnProperty=function(e){return void 0!==(void 0)[e]}),Object.getOwnPropertyNames||(Object.getOwnPropertyNames=function(e){var t=[];for(var r in e)void 0!==e.hasOwnProperty&&e.hasOwnProperty(r)&&t.push(r);return t});var v=setTimeout;function y(){}function g(e){if(!(this instanceof g))throw new TypeError("Promises must be constructed via new");if("function"!=typeof e)throw new TypeError("not a function");this._state=0,this._handled=!1,this._value=void 0,this._deferreds=[],k(e,this)}function b(r,n){for(;3===r._state;)r=r._value;0!==r._state?(r._handled=!0,g._immediateFn(function(){var e=1===r._state?n.onFulfilled:n.onRejected;if(null!==e){var t;try{t=e(r._value)}catch(e){return void w(n.promise,e)}x(n.promise,t)}else(1===r._state?x:w)(n.promise,r._value)})):r._deferreds.push(n)}function x(t,e){try{if(e===t)throw new TypeError("A promise cannot be resolved with itself.");if(e&&("object"==typeof e||"function"==typeof e)){var r=e.then;if(e instanceof g)return t._state=3,t._value=e,void E(t);if("function"==typeof r)return void k((n=r,a=e,function(){n.apply(a,arguments)}),t)}t._state=1,t._value=e,E(t)}catch(e){w(t,e)}var n,a}function w(e,t){e._state=2,e._value=t,E(e)}function E(e){2===e._state&&0===e._deferreds.length&&g._immediateFn(function(){e._handled||g._unhandledRejectionFn(e._value)});for(var t=0,r=e._deferreds.length;t<r;t++)b(e,e._deferreds[t]);e._deferreds=null}function C(e,t,r){this.onFulfilled="function"==typeof e?e:null,this.onRejected="function"==typeof t?t:null,this.promise=r}function k(e,t){var r=!1;try{e(function(e){r||(r=!0,x(t,e))},function(e){r||(r=!0,w(t,e))})}catch(e){if(r)return;r=!0,w(t,e)}}g.prototype.catch=function(e){return this.then(null,e)},g.prototype.then=function(e,t){var r=new this.constructor(y);return b(this,new C(e,t,r)),r},g.prototype.finally=function(t){var r=this.constructor;return this.then(function(e){return r.resolve(t()).then(function(){return e})},function(e){return r.resolve(t()).then(function(){return r.reject(e)})})},g.all=function(t){return new g(function(n,a){if(!t||void 0===t.length)throw new TypeError("Promise.all accepts an array");var o=Array.prototype.slice.call(t);if(0===o.length)return n([]);var i=o.length;function d(t,e){try{if(e&&("object"==typeof e||"function"==typeof e)){var r=e.then;if("function"==typeof r)return void r.call(e,function(e){d(t,e)},a)}o[t]=e,0==--i&&n(o)}catch(e){a(e)}}for(var e=0;e<o.length;e++)d(e,o[e])})},g.resolve=function(t){return t&&"object"==typeof t&&t.constructor===g?t:new g(function(e){e(t)})},g.reject=function(r){return new g(function(e,t){t(r)})},g.race=function(a){return new g(function(e,t){for(var r=0,n=a.length;r<n;r++)a[r].then(e,t)})},g._immediateFn="function"==typeof setImmediate&&function(e){setImmediate(e)}||function(e){v(e,0)},g._unhandledRejectionFn=function(e){"undefined"!=typeof console&&console};var O=g;window.Promise=window.Promise||O;function N(e,t){var r=document.createElement("div"),n=document.createTextNode("This page is currently in sandbox/test mode. Do not use real/active card numbers.");if(r.appendChild(n),r.className="sandbox-warning",r.style.display="block",r.style.width="100%",r.style.marginBottom="5px",r.style.color="#fff",r.style.backgroundColor="#770000",r.style.padding="8px 5px",r.style.fontFamily="Verdana",r.style.fontWeight="100",r.style.fontSize="12px",r.style.textAlign="center",r.style.boxSizing="border-box","string"==typeof e){var a=document.querySelector(e);if(!a)throw new Error("Credit card form target does not exist");e=a}e&&(t?e.insertBefore(r,t):e.insertBefore(r,e.firstChild))}String.prototype.repeat||(String.prototype.repeat=function(e){for(var t="",r=0;r<e;r++)t+=void 0;return t});var A={},R=function(e,t){return(R=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r])})(e,t)};function S(e,t){function r(){this.constructor=e}R(e,t),e.prototype=null===t?Object.create(t):(r.prototype=t.prototype,new r)}function _(o,i,d,c){return new(d||(d=Promise))(function(e,t){function r(e){try{a(c.next(e))}catch(e){t(e)}}function n(e){try{a(c.throw(e))}catch(e){t(e)}}function a(t){t.done?e(t.value):new d(function(e){e(t.value)}).then(r,n)}a((c=c.apply(o,i||[])).next())})}function T(r,n){var a,o,i,e,d={label:0,sent:function(){if(1&i[0])throw i[1];return i[1]},trys:[],ops:[]};return e={next:t(0),throw:t(1),return:t(2)},"function"==typeof Symbol&&(e[Symbol.iterator]=function(){return this}),e;function t(t){return function(e){return function(t){if(a)throw new TypeError("Generator is already executing.");for(;d;)try{if(a=1,o&&(i=2&t[0]?o.return:t[0]?o.throw||((i=o.return)&&i.call(o),0):o.next)&&!(i=i.call(o,t[1])).done)return i;switch(o=0,i&&(t=[2&t[0],i.value]),t[0]){case 0:case 1:i=t;break;case 4:return d.label++,{value:t[1],done:!1};case 5:d.label++,o=t[1],t=[0];continue;case 7:t=d.ops.pop(),d.trys.pop();continue;default:if(!(i=0<(i=d.trys).length&&i[i.length-1])&&(6===t[0]||2===t[0])){d=0;continue}if(3===t[0]&&(!i||t[1]>i[0]&&t[1]<i[3])){d.label=t[1];break}if(6===t[0]&&d.label<i[1]){d.label=i[1],i=t;break}if(i&&d.label<i[2]){d.label=i[2],d.ops.push(t);break}i[2]&&d.ops.pop(),d.trys.pop();continue}t=n.call(r,d)}catch(e){t=[6,e],o=0}finally{a=i=0}if(5&t[0])throw t[1];return{value:t[0]?t[1]:void 0,done:!0}}([t,e])}}}var P={},I=new(function(){function e(){}return e.prototype.post=function(e,t){if(e.source=e.source||{},e.source.name=window.name||"parent",P){var r=P[t];if(r){var n=r.frame,a=r.url;try{void 0!==r.targetNode&&(n=r.targetNode)}catch(e){}var o="parent"===t?parent:n.contentWindow||n;void 0!==o.postMessage&&o.postMessage(JSON.stringify(e),a)}}},e.prototype.receive=function(n){return new Promise(function(r){var e=function(e){try{var t=JSON.parse(e.data);n?n.call(n,t):r(t)}catch(e){}};window.addEventListener?window.addEventListener("message",e,!1):window.attachEvent("onmessage",e)})},e}()),D=!1,j="secure-payment-field",F=function(){var e=function(){return(65536*(1+Math.random())|0).toString(16).substring(1)};return""+e()+e()+"-"+e()+"-"+e()+"-"+e()+"-"+e()+e()+e()+")"},L=function(e){var t=X();if(!t)return"";var r=t.urls.tokenization("production"===t.getEnv(A));if(!e)return r;var n="?";for(var a in e)e.hasOwnProperty(a)&&e[a]&&(n+=a+"="+encodeURIComponent(e[a])+"&");return r+n},z=function(e){var t=document.getElementById(j);return t?(I.post({data:e,id:t.getAttribute("data-id"),type:"gateway:globalpayments:hash"},"parent"),new Promise(function(t){I.receive(function(e){"gateway:globalpayments:hash-result"===e.type&&t(e.data)})})):Promise.reject({error:!0,reasons:[{code:"ERROR",message:"Missing field"}]})},H=function(e){var t,r,n=(t=e.ORDER_ID,(r=document.createElement("iframe")).setAttribute("name","global-payments-rxp-"+t),r.setAttribute("id","global-payments-rxp-"+t),r.setAttribute("height","0"),r.setAttribute("width","0"),r.style.display="none",r.style.opacity="0",r),a=document.createElement("form");for(var o in a.method="POST",a.action=L(),e)if(Object.prototype.hasOwnProperty.call(e,o)){var i=document.createElement("input");i.type="hidden",i.name=o,i.value=e[o],a.appendChild(i)}if(document.body.appendChild(n),!n.contentWindow)throw new Error("Source iframe loaded incorrectly");void 0!==n.contentWindow.document.body?n.contentWindow.document.body.appendChild(a):n.contentWindow.document.appendChild(a),a.submit()},U=function(a){return new Promise(function(t,r){var n=setTimeout(function(){r({error:!0,reasons:[{code:"TIMEOUT",message:"HPP setup timeout"}]})},3e4);I.receive(function(e){clearTimeout(n),"hpp-listener-loaded"===(e.action||"")&&(e.payload?t(a):r({error:!0,reasons:[{code:"ERROR",message:"HPP setup failure"}]}))})})},M="https://pay.realexpayments.com",B="https://pay.sandbox.realexpayments.com",q={tokenization:function(e){return(e?M:B)+"/pay"}},V={normalizeResponse:function(e){if(e.error&&e.reasons)return{error:e.error,reasons:e.reasons};if(e.action){var t=[];switch(e.action){case"action-error":t.push({code:"INVALID_REQUEST",message:e.payload});break;case"hpp-api-timeout-error":t.push({code:"API_ERROR",message:e.payload});break;default:for(var r in e.payload)if(e.payload.hasOwnProperty(r)){var n=e.payload[r],a="";switch(n.errorCode){case"INVALID_CARDNUMBER":a="INVALID_CARD_NUMBER";break;case"INVALID_EXPIRY_DATE":a="INVALID_CARD_EXPIRATION";break;case"INVALID_SECURITY_CODE":a="INVALID_CARD_SECURITY_CODE";break;case"INVALID_CARDHOLDER_NAME":a="INVALID_CARD_HOLDER_NAME"}t.push({code:a,message:n.errorMessage})}}return{error:!0,reasons:t}}return{customerReference:atob(e.SAVED_PAYER_REF),details:{cardholderName:atob(e.SAVED_PMT_NAME),orderId:atob(e.ORDER_ID)},paymentReference:atob(e.SAVED_PMT_REF),requestId:atob(e.PASREF)}},setup:function(){return _(void 0,void 0,void 0,function(){var t=this;return T(this,function(e){return D||(D=!0,I.receive(function(r){return _(t,void 0,void 0,function(){var t;return T(this,function(e){switch(e.label){case 0:return"gateway:globalpayments:hash"===r.type&&A.hash?[4,A.hash(r.data)]:[3,2];case 1:t=e.sent(),I.post({data:t,id:r.id,type:"gateway:globalpayments:hash-result"},r.id),e.label=2;case 2:return[2]}})})})),[2]})})},tokenize:function(b){return _(void 0,void 0,void 0,function(){var l,p,f,m,h,v,y,g;return T(this,function(e){switch(e.label){case 0:return e.trys.push([0,2,,3]),[4,(t=btoa(F()).substring(0,22),r=new Date,n=r.getUTCMonth()+1,a=r.getUTCDate(),o=r.getUTCHours(),i=r.getUTCMinutes(),d=r.getUTCSeconds(),c=r.getUTCFullYear().toString()+(n<10?"0"+n.toString():n.toString()).toString()+(a<10?"0"+a.toString():a.toString())+(o<10?"0"+o.toString():o.toString())+(i<10?"0"+i.toString():i.toString())+(d<10?"0"+d.toString():d.toString()),s=window.location.protocol+"//"+window.location.host,u={ACCOUNT:A.account||"",AUTO_SETTLE_FLAG:"0",CARD_STORAGE_ENABLE:"1",CURRENCY:"EUR",HPP_LISTENER_URL:s,HPP_POST_DIMENSIONS:s,HPP_POST_RESPONSE:s,HPP_VERSION:"2",MERCHANT_ID:A.merchantId||"",MERCHANT_RESPONSE_URL:s,ORDER_ID:t,PAYER_EXIST:!0===A.customerExists?"1":"0",TIMESTAMP:c,VALIDATE_CARD_ONLY:!1===A.validateOnly?"0":"1"},A.customerExists&&(u.PAYER_REF=A.customerReference),z(u).then(function(e){return H(e),U(t)}).then(function(){return t}))];case 1:return l=e.sent(),[3,3];case 2:return p=e.sent(),[2,Promise.reject(p)];case 3:return(f=document.getElementById("global-payments-rxp-"+l))?(m=f.contentWindow)?(v=h="",b["card-expiration"]&&-1!==b["card-expiration"].indexOf(" / ")&&(y=b["card-expiration"].split(" / "),h=y[0]||"",v=(y[1]||"").substr(2,2)),g={action:"populate-form-fields",payload:{pas_cccvc:b["card-cvv"],pas_ccmonth:h,pas_ccname:b["card-holder-name"],pas_ccnum:b["card-number"].replace(" ",""),pas_ccyear:v}},m.postMessage(JSON.stringify(g),"*"),[2,new Promise(function(t){I.receive(function(e){(void 0!==e.action||void 0!==e.SHA1HASH&&e.ORDER_ID===btoa(l))&&t(e)})})]):[2,Promise.reject("Source iframe loaded incorrectly")]:[2,Promise.reject("Source iframe missing")]}var t,r,n,a,o,i,d,c,s,u})})},validateData:function(e){var t=[];return e["card-number"]||t.push({code:"INVALID_CARD_NUMBER",message:"The card number is invalid."}),e["card-cvv"]||t.push({code:"INVALID_CARD_SECURITY_CODE",message:"The card security code is invalid."}),e["card-expiration"]||t.push({code:"INVALID_CARD_EXPIRATION",message:"The card expiration is invalid."}),e["card-holder-name"]||t.push({code:"INVALID_CARD_HOLDER_NAME",message:"The card holder name is invalid."}),t}},J="https://api.heartlandportico.com",Y="https://cert.api2.heartlandportico.com",$={tokenization:function(e){return e?J+"/SecureSubmit.v1/api/token":Y+"/Hps.Exchange.PosGateway.Hpf.v1/api/token"}},G={normalizeResponse:function(e){if(e.error&&e.reasons)return{error:e.error,reasons:e.reasons};if(e.error){var t=[];switch(e.error.param){case"card.number":t.push({code:"INVALID_CARD_NUMBER",message:e.error.message})}return{error:!0,reasons:t}}var r={paymentReference:e.token_value};return e.card&&e.card.number&&(r.details={cardNumber:e.card.number}),r},tokenize:function(i){return _(void 0,void 0,void 0,function(){var t,r,n,a,o;return T(this,function(e){switch(e.label){case 0:t=L({api_key:A.publicApiKey}),r={object:"token",token_type:"supt"},i["card-number"]&&(r.card=r.card||{},r.card.number=i["card-number"].replace(" ","")),i["card-cvv"]&&(r.card=r.card||{},r.card.cvc=i["card-cvv"]),i["card-expiration"]&&-1!==i["card-expiration"].indexOf(" / ")&&(n=i["card-expiration"].split(" / "),r.card=r.card||{},r.card.exp_month=n[0]||"",r.card.exp_year=n[1]||""),i["card-track"]&&(r.card=r.card||{},r.card.track_method="swipe",r.card.track=i["card-track"]),i["account-number"]&&(r.ach=r.ach||{},r.ach.account_number=i["account-number"]),i["routing-number"]&&(r.ach=r.ach||{},r.ach.routing_number=i["routing-number"]),e.label=1;case 1:return e.trys.push([1,3,,4]),a={"Content-Type":"application/json"},[4,fetch(t,{body:JSON.stringify(r),credentials:"omit",headers:"undefined"!=typeof Headers?new Headers(a):a,method:"POST"})];case 2:return[2,e.sent().json()];case 3:return[2,{error:!0,reasons:[{code:(o=e.sent()).name,message:o.message}]}];case 4:return[2]}})})},validateData:function(e){var t=[];return e["card-number"]||e["card-track"]||e["account-number"]||(e["card-number"]?e["account-number"]||t.push({code:"INVALID_ACCOUNT_NUMBER",message:"The account number is invalid"}):t.push({code:"INVALID_CARD_NUMBER",message:"The card number is invalid."})),e["account-number"]&&!e["routing-number"]&&t.push({code:"INVALID_ROUTING_NUMBER",message:"The routing number is invalid"}),t}},W={globalpayments:Object.freeze({supports:{apm:{androidPay:!0,applePay:!0},consumerAuthentication:!0,eCheck:!1,gift:!1,tokenization:{cardNotPresent:!0,cardPresent:!1,eCheck:!1,gift:!1}},urls:q,getEnv:function(){return A.env||"production"},actions:V,requiredSettings:["merchantId","account","env"]}),heartland:Object.freeze({supports:{apm:{androidPay:!1,applePay:!0},consumerAuthentication:!0,eCheck:!0,gift:!0,tokenization:{cardNotPresent:!0,cardPresent:!0,eCheck:!0,gift:!0}},urls:$,actions:G,requiredSettings:["publicApiKey"],getEnv:function(){var e=A.publicApiKey||"",t="production";if(!e)return t;var r=e.split("_");if(!r[1])return t;switch(r[1]){case"cert":return"sandbox";case"prod":default:return t}}})},K=function(e){for(var t=e.length,r=0,n=0;n<t;n++){var a=e[n];A.hasOwnProperty(a)&&void 0!==A[a]&&r++}return r===t},X=function(){for(var e in W)if(W.hasOwnProperty(e)){var t=W[e];if(K(t.requiredSettings))return t}};function Q(e,t){var r={};for(var n in e||(e={}),e)e.hasOwnProperty(n)&&(r[n]=e[n]);for(var n in t)t.hasOwnProperty(n)&&(r[n]=t[n]);return r}function Z(e,t){var r=document.createElement("style"),n=document.getElementsByTagName("head");if(t){if(document.getElementById(t))return;r.id=t}r.type="text/css",r.styleSheet?r.styleSheet.cssText=e:r.appendChild(document.createTextNode(e)),n&&n[0]&&n[0].appendChild(r)}function ee(e){var t,r,n,a,o="",i=function(e){var t=[];for(var r in e)e.hasOwnProperty(r)&&("string"==typeof e[r]||te(e[r]))&&t.push(r);return t}(e),d=function(e){var t=[];for(var r in e)e.hasOwnProperty(r)&&"string"!=typeof e[r]&&!te(e[r])&&t.push(r);return t}(e);if(i){var c=i.length;for(t=0;t<c;t++)if(te(a=e[n=i[t]])){var s=a.length;for(r=0;r<s;r++)o+=n+":"+a[r]+";"}else o+=n+":"+a+";"}if(d){var u=d.length;for(t=0;t<u;t++)o+=(n=d[t])+"{"+ee(a=e[n])+"}"}return o}function te(e){return"[object Array]"===Object.prototype.toString.call(e)}var re,ne=function(){var e="https://api2-c.heartlandportico.com/SecureSubmit.v1/token/gp-1.0.2/",t=X();return t?e="sandbox"===t.getEnv(A)?"https://hps.github.io/token/gp-1.0.2/":e:e},ae=ne()+"images/",oe={"#secure-payment-field":{"-o-transition":"border-color ease-in-out .15s,box-shadow ease-in-out .15s","-webkit-box-shadow":"inset 0 1px 1px rgba(0,0,0,.075)","-webkit-transition":"border-color ease-in-out .15s,-webkit-box-shadow ease-in-out .15s","background-color":"#fff",border:"1px solid #ccc","border-radius":"0px","box-shadow":"inset 0 1px 1px rgba(0,0,0,.075)","box-sizing":"border-box",color:"#555",display:"block","font-family":"sans-serif","font-size":"14px",height:"50px","line-height":"1.42857143",margin:"0 .5em 0 0","max-width":"100%",outline:"0",padding:"6px 12px",transition:"border-color ease-in-out .15s,box-shadow ease-in-out .15s","vertical-align":"baseline",width:"100% "},"#secure-payment-field:focus":{border:"1px solid #3989e3","box-shadow":"none",height:"50px",outline:"none"},"#secure-payment-field[type=button]":{"-moz-user-select":"none","-ms-touch-action":"manipulation","-ms-user-select":"none","-webkit-user-select":"none","background-color":"#36b46e","background-image":"none",border:"0px solid transparent","box-sizing":"border-box",color:"#fff",cursor:"pointer",display:"inline-block","font-family":"sans-serif","font-size":"14px","font-weight":"400","line-height":"1.42857143","margin-bottom":"0",padding:"6px 12px","text-align":"center","text-transform":"uppercase","touch-action":"manipulation","user-select":"none","vertical-align":"middle","white-space":"nowrap"},"#secure-payment-field[type=button]:focus":{"background-color":"#258851",color:"#ffffff",outline:"none"},"#secure-payment-field[type=button]:hover":{"background-color":"#258851"},".card-cvv":{background:"transparent url("+ae+"cvv.png) no-repeat right","background-size":"63px 40px"},".card-cvv.card-type-amex":{background:"transparent url("+ae+"cvv-amex.png) no-repeat right","background-size":"63px 40px"},".card-number":{background:"transparent url("+ae+"logo-unknown@2x.png) no-repeat right","background-size":"55px 35px"},".card-number.invalid.card-type-amex":{background:"transparent url("+ae+"logo-amex@2x.png) no-repeat right","background-position-y":"-44px","background-size":"50px 90px"},".card-number.invalid.card-type-discover":{background:"transparent url("+ae+"logo-discover@2x.png) no-repeat right","background-position-y":"-44px","background-size":"85px 90px"},".card-number.invalid.card-type-jcb":{background:"transparent url("+ae+"logo-jcb@2x.png) no-repeat right","background-position-y":"-44px","background-size":"55px 94px"},".card-number.invalid.card-type-mastercard":{background:"transparent url("+ae+"logo-mastercard@2x.png) no-repeat right","background-position-y":"-52px","background-size":"62px 105px"},".card-number.invalid.card-type-visa":{background:"transparent url("+ae+"logo-visa@2x.png) no-repeat right","background-position-y":"-44px","background-size":"83px 88px"},".card-number.valid.card-type-amex":{background:"transparent url("+ae+"logo-amex@2x.png) no-repeat right top","background-size":"50px 90px"},".card-number.valid.card-type-discover":{background:"transparent url("+ae+"logo-discover@2x.png) no-repeat right","background-position-y":"1px","background-size":"85px 90px"},".card-number.valid.card-type-jcb":{background:"transparent url("+ae+"logo-jcb@2x.png) no-repeat right top","background-position-y":"2px","background-size":"55px 94px"},".card-number.valid.card-type-mastercard":{background:"transparent url("+ae+"logo-mastercard@2x.png) no-repeat right","background-position-y":"-1px","background-size":"62px 105px"},".card-number.valid.card-type-visa":{background:"transparent url("+ae+"logo-visa@2x.png) no-repeat right top","background-size":"82px 86px"},".card-number::-ms-clear":{display:"none"},"input[placeholder]":{"letter-spacing":"3px"}},ie={body:{"font-family":"sans-serif"},label:{color:"#555","font-size":"13px","font-weight":"bold","line-height":"1.5","text-transform":"uppercase"},"#ss-banner":{background:"transparent url("+ae+"shield-and-logos@2x.png) no-repeat left center","background-size":"280px 34px",height:"40px","margin-bottom":"7px"},div:{display:"block"},iframe:{width:"300px"},".form-row":{"margin-top":"10px"},".form-wrapper":{display:"block",margin:"10px auto",width:"300px"}};re="function"==typeof Array.prototype.indexOf?function(e,t){return e.indexOf(t)}:function(e,t){for(var r=e.length,n=0,a=-1,o=!1;n<r&&!o;)e[n]===t&&(a=n,o=!0),n++;return a};var de=function(){function e(){this.events={}}return e.prototype.on=function(e,t){"object"!=typeof this.events[e]&&(this.events[e]=[]),this.events[e].push(t)},e.prototype.off=function(e,t){var r;"object"==typeof this.events[e]&&-1<(r=re(this.events[e],t))&&this.events[e].splice(r,1)},e.prototype.emit=function(e){for(var t,r,n,a=[],o=1;o<arguments.length;o++)a[o-1]=arguments[o];if("object"==typeof this.events[e])for(n=(r=this.events[e].slice()).length,t=0;t<n;t++)r[t].apply(this,a)},e.prototype.once=function(t,r){this.on(t,function e(){this.off(t,e),r.apply(this,arguments)})},e}();function ce(e){var t;if(e&&!(e.replace(/^\s+|\s+$/gm,"").length<4)){for(var r in se)if(se.hasOwnProperty(r)&&(t=se[r])&&t.regex&&t.regex.test(e))break;return t}}var se=[{code:"visa",format:/(\d{1,4})/g,length:16,regex:/^4/},{code:"mastercard",format:/(\d{1,4})/g,length:16,regex:/^(5[1-5]|2[2-7])/},{code:"amex",format:/(\d{1,4})(\d{1,6})?(\d{1,5})?/,length:15,regex:/^3[47]/},{code:"diners",format:/(\d{1,4})(\d{1,6})?(\d{1,4})?/,length:14,regex:/^3[0689]/},{code:"discover",format:/(\d{1,4})/g,length:16,regex:/^6([045]|22)/},{code:"jcb",format:/(\d{1,4})/g,length:16,regex:/^35/},{code:"unknown",format:/(\d{1,4})/g,length:19,regex:/^[0-9]/}],ue=function(s){var e=X();if(!e)return Promise.reject({error:!0,reasons:[{code:"INVALID_CONFIGURATION",message:"no gateway available"}]});var t=e.actions.validateData(s);return 0<t.length?Promise.reject({error:!0,reasons:t}):new Promise(function(d,c){e.actions.tokenize(s).then(e.actions.normalizeResponse).then(function(e){if(e.error)c(e);else{if(e=e,s["card-number"]){var t=s["card-number"].replace(/\D/g,""),r=t.substr(0,6),n=t.substr(-4),a=ce(t);e.details=e.details||{},e.details.cardNumber=r+"*".repeat(t.length-10)+n,e.details.cardBin=r,e.details.cardLast4=n,e.details.cardType=a?a.code:"unknown",e.details.cardSecurityCode=!!s["card-cvv"]}if(s["card-expiration"]&&-1!==s["card-expiration"].indexOf(" / ")){var o=s["card-expiration"].split(" / ");e.details=e.details||{},e.details.expiryMonth=o[0]||"",e.details.expiryYear=o[1]||""}if(s["card-holder-name"]&&(e.details=e.details||{},e.details.cardholderName=e.details.cardholderName||s["card-holder-name"]),s["card-track"]){a=function(e,t,r){void 0===t&&(t=!1);var n="";if(t&&r&&"02"===r)n=e.split("=")[0];else{var a=e.split("%");a[1]&&(a=a[1].split("^"))[0]&&(n=a[0].toString().substr(1))}return ce(n)}(s["card-track"]);e.details=e.details||{},e.details.cardType=a?a.code:"unknown"}if(s["account-number"]){var i=s["account-number"].replace(/\D/g,"");n=i.substr(-4);e.details=e.details||{},e.details.accountNumber="*".repeat(i.length-4)+n,e.details.accountLast4=n}d(e)}}).catch(c)})},le=new de,pe=Object.freeze({bus:le,tokenize:ue,loadedFrames:P,options:A,postMessage:I}),fe=function(){function e(){}return e.prototype.format=function(e){var t=ce(e=e.replace(/\D/g,""));if(!t)return e;var r=e.match(t.format);return r?(t.format.global||r.shift(),r.join(" ").replace(/^\s+|\s+$/gm,"")):e},e}(),me=function(){function e(){}return e.prototype.format=function(e,t){void 0===t&&(t=!1);var r,n,a,o=e.match(/^\D*(\d{1,2})(\D+)?(\d{1,4})?/);return o?(r=o[1]||"",n=o[2]||"",0<(a=o[3]||"").length?n=" / ":2===r.length||0<n.length?n=" / ":1===r.length&&"0"!==r&&"1"!==r&&(n=" / "),1===r.length&&""!==n&&(r="0"+r),t&&2===a.length&&(a=(new Date).getFullYear().toString().slice(0,2)+a),r+n+a):""},e}(),he=function(){function e(){}return e.prototype.validate=function(e){if(!e)return!1;var t=ce(e=e.replace(/[-\s]/g,""));return!!t&&(function(e){var t,r=!0,n=0,a=0;if(!e)return!1;for(var o=e.split("").reverse(),i=o.length;n<i;n++)t=parseInt(o[n],10),(r=!r)&&(t*=2),9<t&&(t-=9),a+=t;return a%10==0}(e)&&e.length===t.length)},e}(),ve=function(){function e(){}return e.prototype.validate=function(e,t){return!!e&&(e=e.replace(/^\s+|\s+$/g,""),!!/^\d+$/.test(e)&&(void 0!==t&&!0===t?4===e.length:void 0!==t&&!1===t?3===e.length:3<=e.length&&e.length<=4))},e}(),ye=function(){function e(){}return e.prototype.validate=function(e){var t,r;if(!e)return!1;var n=e.split("/");if(t=n[0],r=n[1],!t||!r)return!1;if(t=t.replace(/^\s+|\s+$/g,""),r=r.replace(/^\s+|\s+$/g,""),!/^\d+$/.test(t))return!1;if(!/^\d+$/.test(r))return!1;2===r.length&&(r=(new Date).getFullYear().toString().slice(0,2)+r);var a=parseInt(t,10),o=parseInt(r,10);return 1<=a&&a<=12&&new Date(o,a,1)>new Date},e}(),ge=function(){function e(){}return e.listen=function(e,t,r){document.addEventListener?e.addEventListener(t,r,!1):e===document?document.documentElement.attachEvent("onpropertychange",function(e){e.propertyName===t&&r(e)}):e.attachEvent("on"+t,r)},e.trigger=function(e,t){if(document.createEvent){var r=document.createEvent("Event");r.initEvent(t,!0,!0),e.dispatchEvent(r)}else document.documentElement[t]++},e.ignore=function(t,r){document.removeEventListener?document.removeEventListener(t,r,!1):document.documentElement.detachEvent("onpropertychange",function(e){e.propertyName===t&&r(e)})},e}(),be=function(){function e(){}return e.addHandler=function(e,t,r){var n;(n="string"==typeof e?document.getElementById(e):e)&&(document.addEventListener?n.addEventListener(t,r,!1):ge.listen(n,t,r))},e.removeHandler=function(e,t,r){var n;(n="string"==typeof e?document.getElementById(e):e)&&(document.removeEventListener?n.removeEventListener(t,r,!1):ge.ignore(t,r))},e.trigger=function(e,t){if(document.createEvent){var r=document.createEvent("Event");r.initEvent(e,!0,!0),t.dispatchEvent(r)}else ge.trigger(t,e)},e}(),xe=function(){function r(){}return r.addType=function(e){for(var t=e.currentTarget?e.currentTarget:e.srcElement,r=ce(t.value),n=t.className.split(" "),a=n.length,o=0,i="";o<a;o++)(i=n[o])&&-1!==i.indexOf("card-type-")&&delete n[o];if(r){n.push("card-type-"+r.code);var d=t.getAttribute("data-id");d&&I.post({data:{cardType:r.code},id:d,type:"ui:iframe-field:card-type"},"parent")}t.className=n.join(" ").replace(/^\s+|\s+$/gm,"")},r.formatNumber=function(e){var t=e.currentTarget?e.currentTarget:e.srcElement,r=t.value;if(0!==r.length){var n=(new fe).format(r);if(t.value=n,t.setSelectionRange){var a=t.selectionStart||0;r.length<n.length&&(a+=n.length-r.length)," "===r.charAt(a)&&" "===n.charAt(a-1)&&(a+=1),t.setSelectionRange(a,a)}}},r.formatExpiration=function(e){var t=e.currentTarget?e.currentTarget:e.srcElement,r=t.value;-1!==[46,8].indexOf(e.keyCode)||35<=e.keyCode&&e.keyCode<=39||(t.value=(new me).format(r,"blur"===e.type))},r.restrictLength=function(r){return function(e){var t=(e.currentTarget?e.currentTarget:e.srcElement).value;-1!==[46,8,9,27,13,110].indexOf(e.keyCode)||65===e.keyCode&&!0===e.ctrlKey||35<=e.keyCode&&e.keyCode<=39||t.length>=r&&(e.preventDefault?e.preventDefault():e.returnValue=!1)}},r.restrictCardNumberLength=function(e){var t=(e.currentTarget?e.currentTarget:e.srcElement).value,r=ce(t);-1!==[46,8,9,27,13,110].indexOf(e.keyCode)||65===e.keyCode&&!0===e.ctrlKey||35<=e.keyCode&&e.keyCode<=39||t.replace(/\D/g,"").length>=(r?r.length:19)&&(e.preventDefault?e.preventDefault():e.returnValue=!1)},r.restrictNumeric=function(e){-1!==[46,8,9,27,13,110].indexOf(e.keyCode)||65===e.keyCode&&!0===e.ctrlKey||35<=e.keyCode&&e.keyCode<=39||229===e.keyCode||(e.shiftKey||e.keyCode<48||57<e.keyCode)&&(e.keyCode<96||105<e.keyCode)&&(e.preventDefault?e.preventDefault():e.returnValue=!1)},r.deleteProperly=function(e){var t=e.currentTarget?e.currentTarget:e.srcElement,r=t.value;if(t.setSelectionRange){var n=t.selectionStart||0;-1!==[46,8].indexOf(e.keyCode)&&" "===r.charAt(n-1)&&t.setSelectionRange(n-1,n-1)}},r.validateNumber=function(e){for(var t,r=e.currentTarget?e.currentTarget:e.srcElement,n=r.value.replace(/[-\s]/g,""),a=ce(n),o=r.className.split(" "),i=o.length,d=0;d<i;d++)-1!==o[d].indexOf("valid")&&delete o[d];(a&&n.length<a.length&&o.push("possibly-valid"),(new he).validate(n))?(o.push("valid"),(t=r.getAttribute("data-id"))&&I.post({data:{valid:!0},id:t,type:"ui:iframe-field:card-number-test"},"parent")):(o.push("invalid"),(t=r.getAttribute("data-id"))&&I.post({data:{valid:!1},id:t,type:"ui:iframe-field:card-number-test"},"parent"));r.className=o.join(" ").replace(/^\s+|\s+$/gm,"")},r.validateCvv=function(e){for(var t=e.currentTarget?e.currentTarget:e.srcElement,r=t.value,n=t.className.split(" "),a=n.length,o="",i="unknown",d=0;d<a;d++)-1!==(o=n[d]).indexOf("valid")&&delete n[d],-1!==o.indexOf("card-type-")&&(i=o.replace("card-type-",""));var c,s="amex"===i,u=s?4:3;(r.length<u&&n.push("possibly-valid"),(new ve).validate(r,"unknown"===i?void 0:s))?(n.push("valid"),(c=t.getAttribute("data-id"))&&I.post({data:{valid:!0},id:c,type:"ui:iframe-field:card-cvv-test"},"parent")):(n.push("invalid"),(c=t.getAttribute("data-id"))&&I.post({data:{valid:!1},id:c,type:"ui:iframe-field:card-cvv-test"},"parent"));t.className=n.join(" ").replace(/^\s+|\s+$/gm,"")},r.validateExpiration=function(e){for(var t=e.currentTarget?e.currentTarget:e.srcElement,r=t.value,n=t.className.split(" "),a=n.length,o=0;o<a;o++)-1!==n[o].indexOf("valid")&&delete n[o];var i,d=r.split(" / "),c=d[0],s=d[1];((!c||!s||c.length<2||s.length<4)&&n.push("possibly-valid"),(new ye).validate(r))?(n.push("valid"),(i=t.getAttribute("data-id"))&&I.post({data:{valid:!0},id:i,type:"ui:iframe-field:card-expiration-test"},"parent")):(n.push("invalid"),(i=t.getAttribute("data-id"))&&I.post({data:{valid:!1},id:i,type:"ui:iframe-field:card-expiration-test"},"parent"));t.className=n.join(" ").replace(/^\s+|\s+$/gm,"")},r.attachNumberEvents=function(e){var t=document.querySelector(e);t&&(be.addHandler(t,"keydown",r.restrictNumeric),be.addHandler(t,"keydown",r.restrictCardNumberLength),be.addHandler(t,"keydown",r.deleteProperly),be.addHandler(t,"keyup",r.formatNumber),be.addHandler(t,"input",r.formatNumber),be.addHandler(t,"input",r.validateNumber),be.addHandler(t,"input",r.addType))},r.attachExpirationEvents=function(e){var t=document.querySelector(e);t&&(be.addHandler(t,"keydown",r.restrictNumeric),be.addHandler(t,"keydown",r.restrictLength(9)),be.addHandler(t,"keyup",r.formatExpiration),be.addHandler(t,"blur",r.formatExpiration),be.addHandler(t,"input",r.validateExpiration),be.addHandler(t,"blur",r.validateExpiration))},r.attachCvvEvents=function(e){var t=document.querySelector(e);t&&(be.addHandler(t,"keydown",r.restrictNumeric),be.addHandler(t,"keydown",r.restrictLength(4)),be.addHandler(t,"input",r.validateCvv))},r}();Array.prototype.indexOf||(Array.prototype.indexOf=function(e,t){for(var r=t||0,n=(void 0).length;r<n;r++)if((void 0)[r]===e)return r;return-1});function we(e){return e.replace(/&/g,"&amp;").replace(/[\uD800-\uDBFF][\uDC00-\uDFFF]/g,function(e){return"&#"+(1024*(e.charCodeAt(0)-55296)+(e.charCodeAt(1)-56320)+65536)+";"}).replace(/([^\#-~| |!])/g,function(e){return"&#"+e.charCodeAt(0)+";"}).replace(/</g,"&lt;").replace(/>/g,"&gt;")}var Ee=function(a){function h(e,t,r){var n=a.call(this)||this;return n.id=btoa(F()),n.type="submit"===e||"card-track"===e?"button":"input",n.url=r,n.frame=n.makeFrame(e,n.id),n.frame.onload=function(){n.emit("load")},n.frame.src=r+"#"+btoa(JSON.stringify({id:n.id,targetOrigin:window.location.href,type:n.type})),n.container=document.querySelector(t),n.container?(n.container.appendChild(n.frame),n.on("dispose",function(){P[n.id]=void 0,n.container&&n.container.removeChild(n.frame)}),I.receive(function(e){if(e.id&&(!e.id||e.id===n.id)){var t=e.type.replace("ui:iframe-field:","");switch(t){case"register":I.post({data:A,id:n.id,type:"ui:iframe-field:update-options"},n.id);break;case"resize":n.frame.style.height=e.data.height+"px";break;case"pass-data":I.post({data:{type:e.data.type,value:e.data.value},id:e.data.target,type:"ui:iframe-field:accumulate-data"},e.data.target)}n.emit(t,e.data)}}),P[n.id]=n):(le.emit("error",{error:!0,reasons:[{code:"ERROR",message:"IframeField: target cannot be found with given selector"}]}),n)}return S(h,a),h.register=function(e){var t=window.location.hash.replace("#",""),r=JSON.parse(atob(t)),n=r.id;h.createField(n,e,r.type),h.addMessageListener(n,e,r.targetOrigin),I.post({data:{type:e},id:n,type:"ui:iframe-field:register"},"parent"),h.triggerResize(n)},h.createField=function(e,t,r){var n=document.createElement("button"===r?"button":"input");if(n.setAttribute("type","button"===r?"button":"tel"),n.id=j,n.className=t,n.setAttribute("data-id",e),"card-track"===t){var a="Read Card";n.appendChild(document.createTextNode(a))}else if("button"===r){a="Submit";n.appendChild(document.createTextNode(a))}var o=document.getElementById(j+"-wrapper");if(o)switch(o.insertBefore(n,o.firstChild),h.addFrameFocusEvent(),"card-track"===t?be.addHandler(n,"click",function(){!function(n){var e=document.getElementById(j+"-data");e&&e.parentNode&&e.parentNode.removeChild(e),(e=document.createElement("input")).id=j+"-data",e.type="text";var t=document.querySelector(".extra-div-2");if(!t)throw new Error("TODO");t.style.height="0px",t.style.width="0px",t.style.overflow="hidden",t.appendChild(e);var a=document.getElementById(j),o=a&&a.innerText?a.innerText:"Read Card";a&&a.firstChild&&a.replaceChild(document.createTextNode("Waiting..."),a.firstChild),e.focus(),I.post({id:n,type:"ui:iframe-field:waiting-for-data"},"parent"),be.addHandler(e,"keydown",function(e){if(13===e.keyCode){I.post({id:n,type:"ui:iframe-field:data-received"},"parent"),e.preventDefault();var t=document.getElementById(j+"-data"),r=t&&t.value?t.value:"";ue({"card-track":r}).then(function(e){a&&a.firstChild&&a.replaceChild(document.createTextNode(o),a.firstChild),t.blur(),I.post({data:e,id:n,type:"ui:iframe-field:token-success"},"parent")}).catch(function(e){a&&a.firstChild&&a.replaceChild(document.createTextNode(o),a.firstChild),t.blur(),I.post({data:e,id:n,type:"ui:iframe-field:token-error"},"parent")})}})}(e)}):"button"===r&&be.addHandler(n,"click",function(){I.post({id:e,type:"ui:iframe-field:click"},"parent")}),t){case"card-number":xe.attachNumberEvents("#"+n.id),n.name="cardNumber";break;case"card-expiration":xe.attachExpirationEvents("#"+n.id);break;case"card-cvv":xe.attachCvvEvents("#"+n.id)}},h.addFrameFocusEvent=function(){var t=document.getElementById(j);if(t){var e="focus",r=function(e){e.fromElement!==t&&(e.relatedTarget||t.focus())};document.onfocusin?be.addHandler(document,e+"in",r):be.addHandler(document,e,r)}},h.addMessageListener=function(f,m,e){P.parent={frame:parent,url:e},I.receive(function(e){var t,r,n,a,o,i,d,l,p,c,s;if(e.id&&(!e.id||e.id===f))switch(e.type.replace("ui:iframe-field:","")){case"accumulate-data":!function(t,e,r){if("card-number"===e||"account-number"===e){var n=window;if(n.dataContents=n.dataContents||{},n.dataContents[r.data.type]=r.data.value,n.dataReceivedFields||(n.dataReceivedFields=["submit"]),n.dataReceivedFields.push(r.data.type),JSON.stringify(n.dataFields.sort())===JSON.stringify(n.dataReceivedFields.sort())){var a=document.getElementById(j),o=a&&a.value?a.value:"";ue({"account-number":"account-number"===window.name&&o,"card-cvv":void 0!==n.dataContents["card-cvv"]&&n.dataContents["card-cvv"],"card-expiration":void 0!==n.dataContents["card-expiration"]&&n.dataContents["card-expiration"],"card-holder-name":void 0!==n.dataContents["card-holder-name"]&&n.dataContents["card-holder-name"],"card-number":"card-number"===window.name&&o,"routing-number":void 0!==n.dataContents["routing-number"]&&n.dataContents["routing-number"]}).then(function(e){n.dataContents=void 0,n.dataReceivedFields=void 0,I.post({data:e,id:t,type:"ui:iframe-field:token-success"},"parent")}).catch(function(e){n.dataContents=void 0,n.dataReceivedFields=void 0,I.post({data:e,id:t,type:"ui:iframe-field:token-error"},"parent")})}}}(f,m,e);break;case"add-stylesheet":Z(e.data.css),h.triggerResize(f);break;case"payment-request-complete":c=f,s=e,_(void 0,void 0,void 0,function(){return T(this,function(e){return window.globalPaymentResponse?window.globalPaymentResponse.complete(s.data.status).then(function(){I.post({id:c,type:"ui:iframe-field:payment-request-completed"},"parent")}).catch(function(e){I.post({data:{code:"ERROR",message:e.message},id:c,type:"ui:iframe-field:error"},"parent")}):I.post({data:{code:"ERROR",message:"Missing PaymentResponse object"},id:c,type:"ui:iframe-field:error"},"parent"),[2]})});break;case"payment-request-start":l=f,p=e,_(void 0,void 0,void 0,function(){var t,r,n,a,o,i,d,c,s,u;return T(this,function(e){switch(e.label){case 0:return e.trys.push([0,2,,3]),[4,new PaymentRequest(p.data.instruments,p.data.details,p.data.options).show()];case 1:return t=e.sent(),window.globalPaymentResponse=t,[3,3];case 2:return r=e.sent(),n="ERROR","Error"!==r.name&&(n=r.name.replace("Error","_Error").toUpperCase()),I.post({data:{code:n,message:r.message},id:l,type:"ui:iframe-field:token-error"},"parent"),[2];case 3:return e.trys.push([3,5,,6]),[4,ue({"card-cvv":t.details.cardSecurityCode||"","card-expiration":(t.details.expiryMonth||"")+" / "+(t.details.expiryYear||""),"card-holder-name":t.details.cardholderName||"","card-number":t.details.cardNumber||""})];case 4:return a=e.sent(),o=t.toJSON(),i=t.details.cardNumber.replace(/\D/g,""),d=i.substr(0,6),c=i.substr(-4),s=ce(i),o.details=o.details||{},o.details.cardNumber=d+"*".repeat(i.length-10)+c,o.details.cardBin=d,o.details.cardLast4=c,o.details.cardType=s?s.code:"unknown",o.details.cardSecurityCode=!!t.details.cardSecurityCode,a.details=o.details,a.methodName=o.methodName,a.payerEmail=o.payerEmail,a.payerName=o.payerName,a.payerPhone=o.payerPhone,a.requestId=o.requestId,a.shippingAddress=o.shippingAddress,a.shippingOption=o.shippingOption,I.post({data:a,id:l,type:"ui:iframe-field:token-success"},"parent"),[3,6];case 5:return u=e.sent(),t.complete("fail"),I.post({data:u,id:l,type:"ui:iframe-field:token-error"},"parent"),[3,6];case 6:return[2]}})});break;case"request-data":!function(e,t,r){window.dataReceivedFields||(window.dataReceivedFields=["submit"]);var n=document.getElementById(j),a=n&&n.value?n.value:"";"card-number"!==t&&"account-number"!==t||(window.dataFields=r.data.fields,a=""),I.post({data:{target:r.data.target,type:t,value:a},id:e,type:"ui:iframe-field:pass-data"},"parent")}(f,m,e);break;case"set-card-type":!function(e){var t=document.getElementById(j);if(t){for(var r=t.className.split(" "),n=r.length,a=0,o="";a<n;a++)(o=r[a])&&-1!==o.indexOf("card-type-")&&delete r[a];e&&r.push("card-type-"+e),t.className=r.join(" ")}}(e.data.cardType);break;case"set-focus":(d=document.getElementById(j))&&d.focus();break;case"set-placeholder":o=e.data.placeholder,(i=document.getElementById(j))&&("•••• •••• •••• ••••"===o||"•••••••••"===o||"••••"===o||"•••"===o||"···· ···· ···· ····"===o?i.setAttribute("placeholder",o):i.setAttribute("placeholder",we(o))),h.triggerResize(f);break;case"set-text":n=e.data.text,(a=document.getElementById(j))&&(a.textContent=we(n)),h.triggerResize(f);break;case"set-value":t=e.data.value,(r=document.getElementById(j))&&r.setAttribute("value",we(t)),h.triggerResize(f);break;case"update-options":for(var u in e.data)e.data.hasOwnProperty(u)&&(A[u]=e.data[u])}})},h.triggerResize=function(e){I.post({data:{height:document.body.offsetHeight+1},id:e,type:"ui:iframe-field:resize"},"parent")},h.prototype.addStylesheet=function(e){var t=ee(e);I.post({data:{css:t},id:this.id,type:"ui:iframe-field:add-stylesheet"},this.id)},h.prototype.setFocus=function(){I.post({id:this.id,type:"ui:iframe-field:set-focus"},this.id)},h.prototype.setPlaceholder=function(e){I.post({data:{placeholder:e},id:this.id,type:"ui:iframe-field:set-placeholder"},this.id)},h.prototype.setText=function(e){I.post({data:{text:e},id:this.id,type:"ui:iframe-field:set-text"},this.id)},h.prototype.setValue=function(e){I.post({data:{value:e},id:this.id,type:"ui:iframe-field:set-value"},this.id)},h.prototype.makeFrame=function(e,t){var r=document.createElement("iframe");return r.id="secure-payment-field-"+e+"-"+t,r.name=e,r.style.border="0",r.frameBorder="0",r.scrolling="no",r.setAttribute("allowtransparency","true"),r.allowPaymentRequest=!0,r},h}(de),Ce={blank:{},default:oe},ke={blank:{},default:ie},Oe=["card-number","card-expiration","card-cvv","card-holder-name","card-track","account-number","routing-number","submit"],Ne=function(){function e(e,t){this.totalNumberOfFields=0,this.frames={},this.fields=e,this.styles=t,this.createFrames()}return e.prototype.on=function(e,t,r){if("string"==typeof t&&r){if(Ae(this.frames,e),!(o=this.frames[e]))return;return o.on(t,r),this}for(var n in Oe)if(Oe.hasOwnProperty(n)){var a=Oe[n];if(this.frames.hasOwnProperty(a)){var o;if(Ae(this.frames,a),!(o=this.frames[a]))return;o.on(e,t)}}return this},e.prototype.addStylesheet=function(e){for(var t in Oe)if(Oe.hasOwnProperty(t)){var r=Oe[t];if(this.frames.hasOwnProperty(r)){Ae(this.frames,r);var n=this.frames[r];if(!n)return;n.addStylesheet(e)}}return this},e.prototype.ready=function(e){var t=this,r=0;for(var n in Oe)if(Oe.hasOwnProperty(n)){var a=Oe[n];if(this.frames.hasOwnProperty(a)){Ae(this.frames,a);var o=this.frames[a];if(!o)return;o.on("register",function(){++r===t.totalNumberOfFields&&e(t.frames)})}}},e.prototype.dispose=function(){for(var e in Oe)if(Oe.hasOwnProperty(e)){var t=Oe[e];if(this.frames.hasOwnProperty(t)){var r=this.frames[t];if(!r)return;r.emit("dispose")}}},e.prototype.createFrames=function(){for(var r=this,e=function(e){if(!n.fields[e])return"continue";var t=n.frames[e]=new Ee(e,n.fields[e].target||"",ne()+"field.html");if(n.totalNumberOfFields++,void 0===t)return"continue";t.on("register",function(){r.fields[e].placeholder&&t.setPlaceholder(r.fields[e].placeholder||""),r.fields[e].text&&t.setText(r.fields[e].text||""),r.fields[e].value&&t.setValue(r.fields[e].value||""),r.styles&&t.addStylesheet(r.styles)})},n=this,t=0,a=Oe;t<a.length;t++){e(a[t])}void 0!==this.frames.submit&&this.frames.submit.on("click",function(){var e=r.frames["card-number"]||r.frames["account-number"];e&&r.requestDataFromAll(e)});var o=this.frames["card-number"],i=this.frames["card-cvv"];o&&i&&o.on("card-type",function(e){I.post({data:e,id:i.id,type:"ui:iframe-field:set-card-type"},i.id)})},e.prototype.requestDataFromAll=function(e){for(var t=[],r=0,n=Oe;r<n.length;r++){var a=n[r];this.frames[a]&&t.push(a)}for(var o=0,i=t;o<i.length;o++){if("submit"!==(a=i[o])){var d=this.frames[a];d&&I.post({data:{fields:t,target:e.id},id:d.id,type:"ui:iframe-field:request-data"},d.id)}}},e}();function Ae(e,t){if(-1===Oe.indexOf(t))throw new Error("Supplied field type is invalid");if(!e[t])throw new Error("No field with the type `"+t+"` is currently available")}var Re={labels:{"card-cvv":"Card CVV:","card-expiration":"Card Expiration:","card-holder-name":"Card Holder Name:","card-number":"Card Number:"},placeholders:{"card-cvv":"•••","card-expiration":"MM / YYYY","card-holder-name":"Jane Smith","card-number":"•••• •••• •••• ••••"},prefix:"credit-card-",style:"default",values:{"card-track":"Read Card",submit:"Submit"}};var Se=Object.freeze({defaultOptions:Re,form:function(e,t){if(void 0===t&&(t={}),"string"==typeof e){if(!(i=document.querySelector(e)))throw new Error("Credit card form target does not exist");e=i}var r=X();r&&"production"!==r.getEnv(A)&&N(e),t=Q(Q({},Re),t);var n=["card-holder-name","card-number","card-expiration","card-cvv","submit"],a={};for(var o in n)if(n.hasOwnProperty(o)){var i,d=n[o];if(t.labels&&t.labels[d]){var c=document.createElement("label");c.setAttribute("for",t.prefix+d),c.appendChild(document.createTextNode(t.labels[d])),e.appendChild(c)}(i=document.createElement("div")).id=t.prefix+d,e.appendChild(i),a[d]={},a[d].target="#"+t.prefix+d,t.placeholders&&t.placeholders[d]&&(a[d].placeholder=t.placeholders[d]),t.values&&t.values[d]&&(a[d].value=t.values[d])}return t.style&&Z(ee(ke[t.style]),"secure-payment-styles-"+t.style),new Ne(a,t.style?Ce[t.style]:{})},trackReaderForm:function(e,t){if(void 0===t&&(t={}),"string"==typeof e){if(!(i=document.querySelector(e)))throw new Error("Credit card track reader form target does not exist");e=i}var r=X();r&&"production"!==r.getEnv(A)&&N(e),(t=Q(Q({},Re),t)).prefix="track-reader-";var n=["card-track"],a={};for(var o in n)if(n.hasOwnProperty(o)){var i,d=n[o];if(t.labels&&t.labels[d]){var c=document.createElement("label");c.setAttribute("for",t.prefix+d),c.appendChild(document.createTextNode(t.labels[d])),e.appendChild(c)}(i=document.createElement("div")).id=t.prefix+d,e.appendChild(i),a[d]={},a[d].target="#"+t.prefix+d,t.placeholders&&t.placeholders[d]&&(a[d].placeholder=t.placeholders[d]),t.values&&t.values[d]&&(a[d].value=t.values[d])}return t.style&&Z(ee(ke[t.style]),"secure-payment-styles-"+t.style),new Ne(a,t.style?Ce[t.style]:{})}}),_e={labels:{"account-number":"Account Number:","account-type":"Account Type:","check-type":"Check Type:","routing-number":"Routing Number:"},placeholders:{"account-number":"•••••••••","routing-number":"•••••••••"},prefix:"echeck-",style:"default",values:{submit:"Submit"}};var Te=Object.freeze({defaultOptions:_e,form:function(e,t){if(void 0===t&&(t={}),"string"==typeof e){if(!(i=document.querySelector(e)))throw new Error("ACH/eCheck form target does not exist");e=i}var r=X();r&&"production"!==r.getEnv(A)&&N(e),t=Q(Q({},_e),t);var n=["account-number","routing-number","account-type","check-type","submit"],a={};for(var o in n)if(n.hasOwnProperty(o)){var i,d=n[o];if(t.labels&&t.labels[d]){var c=document.createElement("label");c.setAttribute("for",t.prefix+d),c.appendChild(document.createTextNode(t.labels[d])),e.appendChild(c)}if((i=document.createElement("div")).id=t.prefix+d,e.appendChild(i),"account-type"!==d)if("check-type"!==d)a[d]={},a[d].target="#"+t.prefix+d,t.placeholders&&t.placeholders[d]&&(a[d].placeholder=t.placeholders[d]),t.values&&t.values[d]&&(a[d].value=t.values[d]);else{(l=document.createElement("select")).name="check-type",(p=document.createElement("option")).appendChild(document.createTextNode("-- Check Type --")),p.disabled=!0,p.selected=!0,l.appendChild(p);var s=document.createElement("option");s.appendChild(document.createTextNode("Checking")),l.appendChild(s);var u=document.createElement("option");u.appendChild(document.createTextNode("Savings")),l.appendChild(u),i.appendChild(l)}else{var l,p;(l=document.createElement("select")).name="account-type",(p=document.createElement("option")).appendChild(document.createTextNode("-- Account Type --")),p.disabled=!0,p.selected=!0,l.appendChild(p);var f=document.createElement("option");f.appendChild(document.createTextNode("Personal")),l.appendChild(f);var m=document.createElement("option");m.appendChild(document.createTextNode("Business")),l.appendChild(m),i.appendChild(l)}}return t.style&&Z(ee(ke[t.style])),new Ne(a,t.style?Ce[t.style]:{})}}),Pe={labels:{"card-number":"Card Number:",pin:"PIN:"},placeholders:{"card-number":"•••• •••• •••• ••••",pin:"••••"},prefix:"gift-and-loyalty-",style:"default",values:{submit:"Submit"}};var Ie=Object.freeze({defaultOptions:Pe,form:function(e,t){if(void 0===t&&(t={}),"string"==typeof e){if(!(i=document.querySelector(e)))throw new Error("Gift and loyalty form target does not exist");e=i}var r=X();r&&"production"!==r.getEnv(A)&&N(e),t=Q(Q({},Pe),t);var n=["card-number","pin","submit"],a={};for(var o in n)if(n.hasOwnProperty(o)){var i,d=n[o];if(t.labels&&t.labels[d]){var c=document.createElement("label");c.setAttribute("for",t.prefix+d),c.appendChild(document.createTextNode(t.labels[d])),e.appendChild(c)}if((i=document.createElement("div")).id=t.prefix+d,e.appendChild(i),"pin"!==d)a[d]={},a[d].target="#"+t.prefix+d,t.placeholders&&t.placeholders[d]&&(a[d].placeholder=t.placeholders[d]),t.values&&t.values[d]&&(a[d].value=t.values[d]);else{var s=document.createElement("input");s.name="pin",s.type="tel",i.appendChild(s)}}return t.style&&Z(ee(ke[t.style])),new Ne(a,t.style?Ce[t.style]:{})}});var De=function(r){function e(e){var t=r.call(this)||this;return t.iframe=e,t}return S(e,r),e.prototype.on=function(e,t){this.iframe.on(e,t)},e}(de);var je=function(e){e.remove?e.remove():e.parentNode&&e.parentNode.removeChild&&e.parentNode.removeChild(e)},Fe=Object.freeze({complete:function(e){var t=P;for(var r in t)t.hasOwnProperty(r)&&I.post({data:{status:e},id:r,type:"ui:iframe-field:payment-request-complete"},r)},setup:function(e,t,r,n,a){void 0===a&&(a=!1);var o=document.querySelector(e);if(!o)return le.emit("error",{error:!0,reasons:[{code:"INVALID_CONFIGURATION",message:"Invalid target element"}]});if("undefined"==typeof PaymentRequest)return le.emit("error",{error:!0,reasons:[{code:"ERROR",message:"PaymentRequest API not available"}]});var i=document.createElement("div");i.id="global-pay-payment-request",i.style.display="none";var d=o.parentElement;if(!d)return le.emit("error",{error:!0,reasons:[{code:"INVALID_CONFIGURATION",message:"Target element has no parent"}]});d.appendChild(i),o.style.display=null;var c=new Ee("payment-request","#"+i.id,ne()+"field.html");r=r||[{supportedMethods:["basic-card"]}],t=t||{},n=n||{};var s=new De(c),u=function(){return I.post({data:{details:t,instruments:r,options:n},id:c.id,type:"ui:iframe-field:payment-request-start"},c.id)};return a?s.on("register",function(){u()}):be.addHandler(o,"click",function(e){return e.preventDefault(),u(),!1}),c.on("token-success",function(e){a&&je(i),s.emit("token-success",e)}),c.on("token-error",function(e){a&&je(i),s.emit("token-error",e)}),c.on("payment-request-closed",function(){a&&je(i),s.emit("error",{error:!0,reasons:[{code:"PAYMENT_UI_CLOSED",message:"Payment UI closed"}]})}),c.on("error",function(e){a&&je(i),s.emit("error",{error:!0,reasons:[e]})}),s}});return{configure:function(e){for(var t in e)e.hasOwnProperty(t)&&(A[t]=e[t]);var r=X();r&&r.actions.setup&&r.actions.setup()},creditCard:Se,eCheck:Te,events:be,giftAndLoyalty:Ie,internal:pe,on:function(e,t){return le.on(e,t)},paymentRequest:Fe,ui:Object.freeze({form:function(e){return new Ne(e.fields,e.styles||{})},IframeField:Ee})}}();
//# sourceMappingURL=globalpayments.min.js.map
