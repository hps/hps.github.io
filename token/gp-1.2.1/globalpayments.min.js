var GlobalPayments=function(){"use strict";var e="function"==typeof fetch?fetch.bind():function(e,t){return t=t||{},new Promise(function(r,n){var a=new XMLHttpRequest;for(var o in a.open(t.method||"get",e,!0),t.headers)a.setRequestHeader(o,t.headers[o]);function i(){var e,t=[],r=[],n={};return a.getAllResponseHeaders().replace(/^(.*?):[^\S\n]*([\s\S]*?)$/gm,function(a,o,i){t.push(o=o.toLowerCase()),r.push([o,i]),e=n[o],n[o]=e?e+","+i:i}),{ok:2==(a.status/100|0),status:a.status,statusText:a.statusText,url:a.responseURL,clone:i,text:function(){return Promise.resolve(a.responseText)},json:function(){return Promise.resolve(a.responseText).then(JSON.parse)},blob:function(){return Promise.resolve(new Blob([a.response]))},headers:{keys:function(){return t},entries:function(){return r},get:function(e){return n[e.toLowerCase()]},has:function(e){return e.toLowerCase()in n}}}}a.withCredentials="include"==t.credentials,a.onload=function(){r(i())},a.onerror=n,a.send(t.body||null)})};window.fetch||(window.fetch=e.default||e),Array.prototype.forEach||(Array.prototype.forEach=function(e){for(var t=0;t<this.length;t++)e(this[t],t,this)});for(var t=function(e){for(var t,r=function(e){var t=e.length;if(t%4>0)throw new Error("Invalid string. Length must be a multiple of 4");var r=e.indexOf("=");-1===r&&(r=t);return[r,r===t?0:4-r%4]}(e),n=r[0],i=r[1],d=new o(function(e,t,r){return 3*(t+r)/4-r}(0,n,i)),c=0,s=i>0?n-4:n,u=0;u<s;u+=4)t=a[e.charCodeAt(u)]<<18|a[e.charCodeAt(u+1)]<<12|a[e.charCodeAt(u+2)]<<6|a[e.charCodeAt(u+3)],d[c++]=t>>16&255,d[c++]=t>>8&255,d[c++]=255&t;2===i&&(t=a[e.charCodeAt(u)]<<2|a[e.charCodeAt(u+1)]>>4,d[c++]=255&t);1===i&&(t=a[e.charCodeAt(u)]<<10|a[e.charCodeAt(u+1)]<<4|a[e.charCodeAt(u+2)]>>2,d[c++]=t>>8&255,d[c++]=255&t);return d},r=function(e){for(var t,r=e.length,a=r%3,o=[],i=0,d=r-a;i<d;i+=16383)o.push(s(e,i,i+16383>d?d:i+16383));1===a?(t=e[r-1],o.push(n[t>>2]+n[t<<4&63]+"==")):2===a&&(t=(e[r-2]<<8)+e[r-1],o.push(n[t>>10]+n[t>>4&63]+n[t<<2&63]+"="));return o.join("")},n=[],a=[],o="undefined"!=typeof Uint8Array?Uint8Array:Array,i="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",d=0,c=i.length;d<c;++d)n[d]=i[d],a[i.charCodeAt(d)]=d;function s(e,t,r){for(var a,o,i=[],d=t;d<r;d+=3)a=(e[d]<<16&16711680)+(e[d+1]<<8&65280)+(255&e[d+2]),i.push(n[(o=a)>>18&63]+n[o>>12&63]+n[o>>6&63]+n[63&o]);return i.join("")}a["-".charCodeAt(0)]=62,a["_".charCodeAt(0)]=63,window.btoa=window.btoa||function(e){var t,n=e.length,a=new("undefined"!=typeof Uint8Array?Uint8Array:Array)(n);for(t=0;t<n;t++)a[t]=e.charCodeAt(t);return r(a)},window.atob=window.atob||function(e){var r,n=t(e),a=n.length,o="";for(r=0;r<a;r++)o+=String.fromCharCode(n[r]);return o};var u,l={};!function(){function e(e){return e<10?"0"+e:e}if("function"!=typeof Date.prototype.toJSON){Date.prototype.toJSON=function(t){return isFinite(this.valueOf())?this.getUTCFullYear()+"-"+e(this.getUTCMonth()+1)+"-"+e(this.getUTCDate())+"T"+e(this.getUTCHours())+":"+e(this.getUTCMinutes())+":"+e(this.getUTCSeconds())+"Z":""};var t=String.prototype;Number.prototype.JSON=t.JSON=Boolean.prototype.toJSON=function(e){return this.valueOf()}}var r,n,a,o=/[\u0000\u00ad\u0600-\u0604\u070f\u17b4\u17b5\u200c-\u200f\u2028-\u202f\u2060-\u206f\ufeff\ufff0-\uffff]/g,i=/[\\\"\x00-\x1f\x7f-\x9f\u00ad\u0600-\u0604\u070f\u17b4\u17b5\u200c-\u200f\u2028-\u202f\u2060-\u206f\ufeff\ufff0-\uffff]/g,d={"\b":"\\b","\t":"\\t","\n":"\\n","\f":"\\f","\r":"\\r",'"':'\\"',"\\":"\\\\"};function c(e){return i.lastIndex=0,i.test(e)?'"'+e.replace(i,function(e){var t=d[e];return"string"==typeof t?t:"\\u"+("0000"+e.charCodeAt(0).toString(16)).slice(-4)})+'"':'"'+e+'"'}"function"!=typeof l.stringify&&(l.stringify=function(e,t,o){var i;if(r="",n="","number"==typeof o)for(i=0;i<o;i+=1)n+=" ";else"string"==typeof o&&(n=o);if(a=t,t&&"function"!=typeof t&&("object"!=typeof t||"number"!=typeof t.length))throw new Error("JSON.stringify");return function e(t,o){var i,d,s,u,l,p=r,f=o[t];switch(f&&"object"==typeof f&&"function"==typeof f.toJSON&&(f=f.toJSON(t)),"function"==typeof a&&(f=a.call(o,t,f)),typeof f){case"string":return c(f);case"number":return isFinite(f)?String(f):"null";case"boolean":case"null":return String(f);case"object":if(!f)return"null";if(r+=n,l=[],"[object Array]"===Object.prototype.toString.apply(f,[])){for(u=f.length,i=0;i<u;i+=1)l[i]=e(i.toString(),f)||"null";return s=0===l.length?"[]":r?"[\n"+r+l.join(",\n"+r)+"\n"+p+"]":"["+l.join(",")+"]",r=p,s}if(a&&"object"==typeof a)for(u=a.length,i=0;i<u;i+=1)"string"==typeof a[i]&&(s=e(d=a[i],f))&&l.push(c(d)+(r?": ":":")+s);else for(d in f)Object.prototype.hasOwnProperty.call(f,d)&&(s=e(d,f))&&l.push(c(d)+(r?": ":":")+s);return s=0===l.length?"{}":r?"{\n"+r+l.join(",\n"+r)+"\n"+p+"}":"{"+l.join(",")+"}",r=p,s}}("",{"":e})}),"function"!=typeof l.parse&&(l.parse=function(e,t){var r;if(e=String(e),o.lastIndex=0,o.test(e)&&(e=e.replace(o,function(e){return"\\u"+("0000"+e.charCodeAt(0).toString(16)).slice(-4)})),/^[\],:{}\s]*$/.test(e.replace(/\\(?:["\\\/bfnrt]|u[0-9a-fA-F]{4})/g,"@").replace(/"[^"\\\n\r]*"|true|false|null|-?\d+(?:\.\d*)?(?:[eE][+\-]?\d+)?/g,"]").replace(/(?:^|:|,)(?:\s*\[)+/g,"")))return r=new Function("return ("+e+")")(),"function"==typeof t?function e(r,n){var a,o,i=r[n];if(i&&"object"==typeof i)for(a in i)Object.prototype.hasOwnProperty.call(i,a)&&(o=e(i,a),i[a]=o);return t.call(r,n,i)}({"":r},""):r;throw new SyntaxError("JSON.parse")})}(),window.JSON=window.JSON||l,Object.freeze||(Object.freeze=function(e){if(Object(e)!==e)throw new TypeError("Object.freeze can only be called on Objects.");return e});try{Object.freeze(function(){})}catch(e){Object.freeze=(u=Object.freeze,function(e){return"function"==typeof e?e:u(e)})}Object.prototype.hasOwnProperty||(Object.prototype.hasOwnProperty=function(e){return void 0!==this[e]}),Object.getOwnPropertyNames||(Object.getOwnPropertyNames=function(e){var t=[];for(var r in e)void 0!==e.hasOwnProperty&&e.hasOwnProperty(r)&&t.push(r);return t});var p=setTimeout;function f(){}function m(e){if(!(this instanceof m))throw new TypeError("Promises must be constructed via new");if("function"!=typeof e)throw new TypeError("not a function");this._state=0,this._handled=!1,this._value=void 0,this._deferreds=[],x(e,this)}function h(e,t){for(;3===e._state;)e=e._value;0!==e._state?(e._handled=!0,m._immediateFn(function(){var r=1===e._state?t.onFulfilled:t.onRejected;if(null!==r){var n;try{n=r(e._value)}catch(e){return void y(t.promise,e)}v(t.promise,n)}else(1===e._state?v:y)(t.promise,e._value)})):e._deferreds.push(t)}function v(e,t){try{if(t===e)throw new TypeError("A promise cannot be resolved with itself.");if(t&&("object"==typeof t||"function"==typeof t)){var r=t.then;if(t instanceof m)return e._state=3,e._value=t,void g(e);if("function"==typeof r)return void x((n=r,a=t,function(){n.apply(a,arguments)}),e)}e._state=1,e._value=t,g(e)}catch(t){y(e,t)}var n,a}function y(e,t){e._state=2,e._value=t,g(e)}function g(e){2===e._state&&0===e._deferreds.length&&m._immediateFn(function(){e._handled||m._unhandledRejectionFn(e._value)});for(var t=0,r=e._deferreds.length;t<r;t++)h(e,e._deferreds[t]);e._deferreds=null}function b(e,t,r){this.onFulfilled="function"==typeof e?e:null,this.onRejected="function"==typeof t?t:null,this.promise=r}function x(e,t){var r=!1;try{e(function(e){r||(r=!0,v(t,e))},function(e){r||(r=!0,y(t,e))})}catch(e){if(r)return;r=!0,y(t,e)}}m.prototype.catch=function(e){return this.then(null,e)},m.prototype.then=function(e,t){var r=new this.constructor(f);return h(this,new b(e,t,r)),r},m.prototype.finally=function(e){var t=this.constructor;return this.then(function(r){return t.resolve(e()).then(function(){return r})},function(r){return t.resolve(e()).then(function(){return t.reject(r)})})},m.all=function(e){return new m(function(t,r){if(!e||void 0===e.length)throw new TypeError("Promise.all accepts an array");var n=Array.prototype.slice.call(e);if(0===n.length)return t([]);var a=n.length;function o(e,i){try{if(i&&("object"==typeof i||"function"==typeof i)){var d=i.then;if("function"==typeof d)return void d.call(i,function(t){o(e,t)},r)}n[e]=i,0==--a&&t(n)}catch(e){r(e)}}for(var i=0;i<n.length;i++)o(i,n[i])})},m.resolve=function(e){return e&&"object"==typeof e&&e.constructor===m?e:new m(function(t){t(e)})},m.reject=function(e){return new m(function(t,r){r(e)})},m.race=function(e){return new m(function(t,r){for(var n=0,a=e.length;n<a;n++)e[n].then(t,r)})},m._immediateFn="function"==typeof setImmediate&&function(e){setImmediate(e)}||function(e){p(e,0)},m._unhandledRejectionFn=function(e){"undefined"!=typeof console&&console};var w=m;function E(e,t){var r=document.createElement("div"),n=document.createTextNode("This page is currently in sandbox/test mode. Do not use real/active card numbers.");if(r.appendChild(n),r.className="sandbox-warning",r.style.display="block",r.style.width="100%",r.style.marginBottom="5px",r.style.color="#fff",r.style.backgroundColor="#770000",r.style.padding="8px 5px",r.style.fontFamily="Verdana",r.style.fontWeight="100",r.style.fontSize="12px",r.style.textAlign="center",r.style.boxSizing="border-box","string"==typeof e){var a=document.querySelector(e);if(!a)throw new Error("Credit card form target does not exist");e=a}e&&(t?e.insertBefore(r,t):e.insertBefore(r,e.firstChild))}window.Promise=window.Promise||w,String.prototype.repeat||(String.prototype.repeat=function(e){for(var t="",r=0;r<e;r++)t+=this;return t});var C={},k=function(e,t){return(k=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r])})(e,t)};function N(e,t){function r(){this.constructor=e}k(e,t),e.prototype=null===t?Object.create(t):(r.prototype=t.prototype,new r)}function O(e,t,r,n){return new(r||(r=Promise))(function(a,o){function i(e){try{c(n.next(e))}catch(e){o(e)}}function d(e){try{c(n.throw(e))}catch(e){o(e)}}function c(e){e.done?a(e.value):new r(function(t){t(e.value)}).then(i,d)}c((n=n.apply(e,t||[])).next())})}function A(e,t){var r,n,a,o,i={label:0,sent:function(){if(1&a[0])throw a[1];return a[1]},trys:[],ops:[]};return o={next:d(0),throw:d(1),return:d(2)},"function"==typeof Symbol&&(o[Symbol.iterator]=function(){return this}),o;function d(o){return function(d){return function(o){if(r)throw new TypeError("Generator is already executing.");for(;i;)try{if(r=1,n&&(a=2&o[0]?n.return:o[0]?n.throw||((a=n.return)&&a.call(n),0):n.next)&&!(a=a.call(n,o[1])).done)return a;switch(n=0,a&&(o=[2&o[0],a.value]),o[0]){case 0:case 1:a=o;break;case 4:return i.label++,{value:o[1],done:!1};case 5:i.label++,n=o[1],o=[0];continue;case 7:o=i.ops.pop(),i.trys.pop();continue;default:if(!(a=(a=i.trys).length>0&&a[a.length-1])&&(6===o[0]||2===o[0])){i=0;continue}if(3===o[0]&&(!a||o[1]>a[0]&&o[1]<a[3])){i.label=o[1];break}if(6===o[0]&&i.label<a[1]){i.label=a[1],a=o;break}if(a&&i.label<a[2]){i.label=a[2],i.ops.push(o);break}a[2]&&i.ops.pop(),i.trys.pop();continue}o=t.call(e,i)}catch(e){o=[6,e],n=0}finally{r=a=0}if(5&o[0])throw o[1];return{value:o[0]?o[1]:void 0,done:!0}}([o,d])}}}var R={},S=new(function(){function e(){}return e.prototype.post=function(e,t){if(e.source=e.source||{},e.source.name=window.name||"parent",R){var r=R[t];if(r){var n=r.frame,a=r.url;try{void 0!==r.targetNode&&(n=r.targetNode)}catch(e){}var o="parent"===t?parent:n.contentWindow||n;void 0!==o.postMessage&&o.postMessage(JSON.stringify(e),a)}}},e.prototype.receive=function(e){return new Promise(function(t){var r=function(r){try{var n=JSON.parse(r.data);e?e.call(e,n):t(n)}catch(e){}};window.addEventListener?window.addEventListener("message",r,!1):window.attachEvent("onmessage",r)})},e}()),_=!1,T="secure-payment-field",P=function(){var e=function(){return(65536*(1+Math.random())|0).toString(16).substring(1)};return""+e()+e()+"-"+e()+"-"+e()+"-"+e()+"-"+e()+e()+e()+")"},I=function(e){var t=btoa(P()).substring(0,22),r=new Date,n=r.getUTCMonth()+1,a=r.getUTCDate(),o=r.getUTCHours(),i=r.getUTCMinutes(),d=r.getUTCSeconds(),c=r.getUTCFullYear().toString()+(n<10?"0"+n.toString():n.toString()).toString()+(a<10?"0"+a.toString():a.toString())+(o<10?"0"+o.toString():o.toString())+(i<10?"0"+i.toString():i.toString())+(d<10?"0"+d.toString():d.toString()),s=window.location.protocol+"//"+window.location.host,u={ACCOUNT:C.account||"",AUTO_SETTLE_FLAG:"0",CARD_STORAGE_ENABLE:"1",CURRENCY:"EUR",HPP_LISTENER_URL:s,HPP_POST_DIMENSIONS:s,HPP_POST_RESPONSE:s,HPP_VERSION:"2",MERCHANT_ID:C.merchantId||"",MERCHANT_RESPONSE_URL:s,ORDER_ID:t,PAYER_EXIST:!0===C.customerExists?"1":"0",TIMESTAMP:c,VALIDATE_CARD_ONLY:!1===C.validateOnly?"0":"1"};return C.customerExists&&(u.PAYER_REF=C.customerReference),D(u).then(function(r){return j(e,r),F(t)}).then(function(){return t})},D=function(e){var t=document.getElementById(T);return t?(S.post({data:e,id:t.getAttribute("data-id"),type:"gateway:globalpayments:hash"},"parent"),new Promise(function(e){S.receive(function(t){"gateway:globalpayments:hash-result"===t.type&&e(t.data)})})):Promise.reject({error:!0,reasons:[{code:"ERROR",message:"Missing field"}]})},j=function(e,t){var r,n,a=(r=t.ORDER_ID,(n=document.createElement("iframe")).setAttribute("name","global-payments-rxp-"+r),n.setAttribute("id","global-payments-rxp-"+r),n.setAttribute("height","0"),n.setAttribute("width","0"),n.style.display="none",n.style.opacity="0",n),o=document.createElement("form");for(var i in o.method="POST",o.action=e,t)if(Object.prototype.hasOwnProperty.call(t,i)){var d=document.createElement("input");d.type="hidden",d.name=i,d.value=t[i],o.appendChild(d)}if(document.body.appendChild(a),!a.contentWindow)throw new Error("Source iframe loaded incorrectly");void 0!==a.contentWindow.document.body?a.contentWindow.document.body.appendChild(o):a.contentWindow.document.appendChild(o),o.submit()},F=function(e){return new Promise(function(t,r){var n=setTimeout(function(){r({error:!0,reasons:[{code:"TIMEOUT",message:"HPP setup timeout"}]})},3e4);S.receive(function(a){clearTimeout(n),"hpp-listener-loaded"===(a.action||"")&&(a.payload?t(e):r({error:!0,reasons:[{code:"ERROR",message:"HPP setup failure"}]}))})})},L="https://pay.realexpayments.com",z="https://pay.sandbox.realexpayments.com",H={tokenization:function(e){return(e?L:z)+"/pay"}},U={normalizeResponse:function(e){if(e.error&&e.reasons)return{error:e.error,reasons:e.reasons};if(e.action){var t=[];switch(e.action){case"action-error":t.push({code:"INVALID_REQUEST",message:e.payload});break;case"hpp-api-timeout-error":t.push({code:"API_ERROR",message:e.payload});break;default:for(var r in e.payload)if(e.payload.hasOwnProperty(r)){var n=e.payload[r],a="";switch(n.errorCode){case"INVALID_CARDNUMBER":a="INVALID_CARD_NUMBER";break;case"INVALID_EXPIRY_DATE":a="INVALID_CARD_EXPIRATION";break;case"INVALID_SECURITY_CODE":a="INVALID_CARD_SECURITY_CODE";break;case"INVALID_CARDHOLDER_NAME":a="INVALID_CARD_HOLDER_NAME"}t.push({code:a,message:n.errorMessage})}}return{error:!0,reasons:t}}return{customerReference:atob(e.SAVED_PAYER_REF),details:{cardholderName:atob(e.SAVED_PMT_NAME),orderId:atob(e.ORDER_ID)},paymentReference:atob(e.SAVED_PMT_REF),requestId:atob(e.PASREF)}},setup:function(){return O(void 0,void 0,void 0,function(){var e=this;return A(this,function(t){return _?[2]:(_=!0,S.receive(function(t){return O(e,void 0,void 0,function(){var e;return A(this,function(r){switch(r.label){case 0:return"gateway:globalpayments:hash"===t.type&&C.hash?[4,C.hash(t.data)]:[3,2];case 1:e=r.sent(),S.post({data:e,id:t.id,type:"gateway:globalpayments:hash-result"},t.id),r.label=2;case 2:return[2]}})})}),[2])})})},tokenize:function(e,t){return O(void 0,void 0,void 0,function(){var r,n,a,o,i,d,c,s;return A(this,function(u){switch(u.label){case 0:return u.trys.push([0,2,,3]),[4,I(e)];case 1:return r=u.sent(),[3,3];case 2:return n=u.sent(),[2,Promise.reject(n)];case 3:return(a=document.getElementById("global-payments-rxp-"+r))?(o=a.contentWindow)?(i="",d="",t["card-expiration"]&&-1!==t["card-expiration"].indexOf(" / ")&&(c=t["card-expiration"].split(" / "),i=c[0]||"",d=(c[1]||"").substr(2,2)),s={action:"populate-form-fields",payload:{pas_cccvc:t["card-cvv"],pas_ccmonth:i,pas_ccname:t["card-holder-name"],pas_ccnum:t["card-number"].replace(" ",""),pas_ccyear:d}},o.postMessage(JSON.stringify(s),"*"),[2,new Promise(function(e){S.receive(function(t){(void 0!==t.action||void 0!==t.SHA1HASH&&t.ORDER_ID===btoa(r))&&e(t)})})]):[2,Promise.reject("Source iframe loaded incorrectly")]:[2,Promise.reject("Source iframe missing")]}})})},validateData:function(e){var t=[];return e["card-number"]||t.push({code:"INVALID_CARD_NUMBER",message:"The card number is invalid."}),e["card-cvv"]||t.push({code:"INVALID_CARD_SECURITY_CODE",message:"The card security code is invalid."}),e["card-expiration"]||t.push({code:"INVALID_CARD_EXPIRATION",message:"The card expiration is invalid."}),e["card-holder-name"]||t.push({code:"INVALID_CARD_HOLDER_NAME",message:"The card holder name is invalid."}),t}},M="https://api.heartlandportico.com",q="https://cert.api2.heartlandportico.com",B={tokenization:function(e){return e?M+"/SecureSubmit.v1/api/token":q+"/Hps.Exchange.PosGateway.Hpf.v1/api/token"}},V={normalizeResponse:function(e){if(e.error&&e.reasons)return{error:e.error,reasons:e.reasons};if(e.error){var t=[];switch(e.error.param){case"card.number":t.push({code:"INVALID_CARD_NUMBER",message:e.error.message})}return{error:!0,reasons:t}}var r={paymentReference:e.token_value};return e.card&&e.card.number&&(r.details={cardNumber:e.card.number}),r},tokenize:function(e,t){return O(void 0,void 0,void 0,function(){var r,n,a,o;return A(this,function(i){switch(i.label){case 0:r={object:"token",token_type:"supt"},t["card-number"]&&(r.card=r.card||{},r.card.number=t["card-number"].replace(" ","")),t["card-cvv"]&&(r.card=r.card||{},r.card.cvc=t["card-cvv"]),t["card-expiration"]&&-1!==t["card-expiration"].indexOf(" / ")&&(n=t["card-expiration"].split(" / "),r.card=r.card||{},r.card.exp_month=n[0]||"",r.card.exp_year=n[1]||""),t["card-track"]&&(r.card=r.card||{},r.card.track_method="swipe",r.card.track=t["card-track"]),t["account-number"]&&(r.ach=r.ach||{},r.ach.account_number=t["account-number"]),t["routing-number"]&&(r.ach=r.ach||{},r.ach.routing_number=t["routing-number"]),i.label=1;case 1:return i.trys.push([1,3,,4]),a={"Content-Type":"application/json"},[4,fetch(e,{body:JSON.stringify(r),credentials:"omit",headers:"undefined"!=typeof Headers?new Headers(a):a,method:"POST"})];case 2:return[2,i.sent().json()];case 3:return[2,{error:!0,reasons:[{code:(o=i.sent()).name,message:o.message}]}];case 4:return[2]}})})},validateData:function(e){var t=[];return e["card-number"]||e["card-track"]||e["account-number"]||(e["card-number"]?e["account-number"]||t.push({code:"INVALID_ACCOUNT_NUMBER",message:"The account number is invalid"}):t.push({code:"INVALID_CARD_NUMBER",message:"The card number is invalid."})),e["account-number"]&&!e["routing-number"]&&t.push({code:"INVALID_ROUTING_NUMBER",message:"The routing number is invalid"}),t}},J={globalpayments:Object.freeze({supports:{apm:{androidPay:!0,applePay:!0},consumerAuthentication:!0,eCheck:!1,gift:!1,tokenization:{cardNotPresent:!0,cardPresent:!1,eCheck:!1,gift:!1}},urls:H,getEnv:function(){return C.env||"production"},actions:U,requiredSettings:["merchantId","account","env"]}),heartland:Object.freeze({supports:{apm:{androidPay:!1,applePay:!0},consumerAuthentication:!0,eCheck:!0,gift:!0,tokenization:{cardNotPresent:!0,cardPresent:!0,eCheck:!0,gift:!0}},urls:B,actions:V,requiredSettings:["publicApiKey"],getEnv:function(){var e=C.publicApiKey||"",t="production";if(!e)return t;var r=e.split("_");if(!r[1])return t;switch(r[1]){case"cert":return"sandbox";case"prod":default:return t}}})},Y=function(e){for(var t=e.length,r=0,n=0;n<t;n++){var a=e[n];C.hasOwnProperty(a)&&void 0!==C[a]&&r++}return r===t},$=function(){for(var e in J)if(J.hasOwnProperty(e)){var t=J[e];if(Y(t.requiredSettings))return t}};function G(e,t){var r={};for(var n in e||(e={}),e)e.hasOwnProperty(n)&&(r[n]=e[n]);for(var n in t)t.hasOwnProperty(n)&&(r[n]=t[n]);return r}function K(e,t){var r=document.createElement("style"),n=document.getElementsByTagName("head");if(t){if(document.getElementById(t))return;r.id=t}r.type="text/css",r.styleSheet?r.styleSheet.cssText=e:r.appendChild(document.createTextNode(e)),n&&n[0]&&n[0].appendChild(r)}function W(e){var t,r,n,a,o="",i=function(e){var t=[];for(var r in e)e.hasOwnProperty(r)&&("string"==typeof e[r]||X(e[r]))&&t.push(r);return t}(e),d=function(e){var t=[];for(var r in e)e.hasOwnProperty(r)&&"string"!=typeof e[r]&&!X(e[r])&&t.push(r);return t}(e);if(i){var c=i.length;for(t=0;t<c;t++)if(X(a=e[n=i[t]])){var s=a.length;for(r=0;r<s;r++)o+=n+":"+a[r]+";"}else o+=n+":"+a+";"}if(d){var u=d.length;for(t=0;t<u;t++)o+=(n=d[t])+"{"+W(a=e[n])+"}"}return o}function X(e){return"[object Array]"===Object.prototype.toString.call(e)}var Q,Z=function(){var e="https://api2.heartlandportico.com/SecureSubmit.v1/token/gp-1.2.1/",t=$();return t?e="sandbox"===t.getEnv(C)?"https://hps.github.io/token/gp-1.2.1/":e:e},ee=Z()+"images/",te={"#secure-payment-field":{"-o-transition":"border-color ease-in-out .15s,box-shadow ease-in-out .15s","-webkit-box-shadow":"inset 0 1px 1px rgba(0,0,0,.075)","-webkit-transition":"border-color ease-in-out .15s,-webkit-box-shadow ease-in-out .15s","background-color":"#fff",border:"1px solid #ccc","border-radius":"0px","box-shadow":"inset 0 1px 1px rgba(0,0,0,.075)","box-sizing":"border-box",color:"#555",display:"block","font-family":"sans-serif","font-size":"14px",height:"50px","line-height":"1.42857143",margin:"0 .5em 0 0","max-width":"100%",outline:"0",padding:"6px 12px",transition:"border-color ease-in-out .15s,box-shadow ease-in-out .15s","vertical-align":"baseline",width:"100% "},"#secure-payment-field:focus":{border:"1px solid #3989e3","box-shadow":"none",height:"50px",outline:"none"},"#secure-payment-field[type=button]":{"-moz-user-select":"none","-ms-touch-action":"manipulation","-ms-user-select":"none","-webkit-user-select":"none","background-color":"#36b46e","background-image":"none",border:"0px solid transparent","box-sizing":"border-box",color:"#fff",cursor:"pointer",display:"inline-block","font-family":"sans-serif","font-size":"14px","font-weight":"400","line-height":"1.42857143","margin-bottom":"0",padding:"6px 12px","text-align":"center","text-transform":"uppercase","touch-action":"manipulation","user-select":"none","vertical-align":"middle","white-space":"nowrap"},"#secure-payment-field[type=button]:focus":{"background-color":"#258851",color:"#ffffff",outline:"none"},"#secure-payment-field[type=button]:hover":{"background-color":"#258851"},".card-cvv":{background:"transparent url("+ee+"cvv.png) no-repeat right","background-size":"63px 40px"},".card-cvv.card-type-amex":{background:"transparent url("+ee+"cvv-amex.png) no-repeat right","background-size":"63px 40px"},".card-number":{background:"transparent url("+ee+"logo-unknown@2x.png) no-repeat right","background-size":"55px 35px"},".card-number.invalid.card-type-amex":{background:"transparent url("+ee+"logo-amex@2x.png) no-repeat right","background-position-y":"-44px","background-size":"50px 90px"},".card-number.invalid.card-type-discover":{background:"transparent url("+ee+"logo-discover@2x.png) no-repeat right","background-position-y":"-44px","background-size":"85px 90px"},".card-number.invalid.card-type-jcb":{background:"transparent url("+ee+"logo-jcb@2x.png) no-repeat right","background-position-y":"-44px","background-size":"55px 94px"},".card-number.invalid.card-type-mastercard":{background:"transparent url("+ee+"logo-mastercard@2x.png) no-repeat right","background-position-y":"-52px","background-size":"62px 105px"},".card-number.invalid.card-type-visa":{background:"transparent url("+ee+"logo-visa@2x.png) no-repeat right","background-position-y":"-44px","background-size":"83px 88px"},".card-number.valid.card-type-amex":{background:"transparent url("+ee+"logo-amex@2x.png) no-repeat right top","background-size":"50px 90px"},".card-number.valid.card-type-discover":{background:"transparent url("+ee+"logo-discover@2x.png) no-repeat right","background-position-y":"1px","background-size":"85px 90px"},".card-number.valid.card-type-jcb":{background:"transparent url("+ee+"logo-jcb@2x.png) no-repeat right top","background-position-y":"2px","background-size":"55px 94px"},".card-number.valid.card-type-mastercard":{background:"transparent url("+ee+"logo-mastercard@2x.png) no-repeat right","background-position-y":"-1px","background-size":"62px 105px"},".card-number.valid.card-type-visa":{background:"transparent url("+ee+"logo-visa@2x.png) no-repeat right top","background-size":"82px 86px"},".card-number::-ms-clear":{display:"none"},"input[placeholder]":{"letter-spacing":"3px"}},re={".secure-payment-form":{"font-family":"sans-serif"},".secure-payment-form label":{color:"#555","font-size":"13px","font-weight":"bold","line-height":"1.5","text-transform":"uppercase"},".secure-payment-form #ss-banner":{background:"transparent url("+ee+"shield-and-logos@2x.png) no-repeat left center","background-size":"280px 34px",height:"40px","margin-bottom":"7px"},".secure-payment-form div":{display:"block"},".secure-payment-form iframe":{width:"300px"},".secure-payment-form .form-row":{"margin-top":"10px"},".secure-payment-form .form-wrapper":{display:"block",margin:"10px auto",width:"300px"}};Q="function"==typeof Array.prototype.indexOf?function(e,t){return e.indexOf(t)}:function(e,t){for(var r=e.length,n=0,a=-1,o=!1;n<r&&!o;)e[n]===t&&(a=n,o=!0),n++;return a};var ne=function(){function e(){this.events={}}return e.prototype.on=function(e,t){"object"!=typeof this.events[e]&&(this.events[e]=[]),this.events[e].push(t)},e.prototype.off=function(e,t){var r;"object"==typeof this.events[e]&&(r=Q(this.events[e],t))>-1&&this.events[e].splice(r,1)},e.prototype.emit=function(e){for(var t,r,n,a=[],o=1;o<arguments.length;o++)a[o-1]=arguments[o];if("object"==typeof this.events[e])for(n=(r=this.events[e].slice()).length,t=0;t<n;t++)r[t].apply(this,a)},e.prototype.once=function(e,t){var r=this;this.on(e,function n(){r.off(e,n),t.apply(r,arguments)})},e}();function ae(e){var t;if(e&&!(e.replace(/^\s+|\s+$/gm,"").length<4)){for(var r in oe)if(oe.hasOwnProperty(r)&&(t=oe[r])&&t.regex&&t.regex.test(e))break;return t}}var oe=[{code:"visa",format:/(\d{1,4})/g,length:16,regex:/^4/},{code:"mastercard",format:/(\d{1,4})/g,length:16,regex:/^(5[1-5]|2[2-7])/},{code:"amex",format:/(\d{1,4})(\d{1,6})?(\d{1,5})?/,length:15,regex:/^3[47]/},{code:"diners",format:/(\d{1,4})(\d{1,6})?(\d{1,4})?/,length:14,regex:/^3[0689]/},{code:"discover",format:/(\d{1,4})/g,length:16,regex:/^6([045]|22)/},{code:"jcb",format:/(\d{1,4})/g,length:16,regex:/^35/},{code:"unknown",format:/(\d{1,4})/g,length:19,regex:/^[0-9]/}],ie=function(e){var t=$();if(!t)return Promise.reject({error:!0,reasons:[{code:"INVALID_CONFIGURATION",message:"no gateway available"}]});var r=t.actions.validateData(e);return r.length>0?Promise.reject({error:!0,reasons:r}):new Promise(function(r,n){var a;-1!==t.requiredSettings.indexOf("publicApiKey")&&(a={api_key:C.publicApiKey}),t.actions.tokenize(function(e){var t=$();if(!t)return"";var r=t.urls.tokenization("production"===t.getEnv(C));if(!e)return r;var n="?";for(var a in e)e.hasOwnProperty(a)&&e[a]&&(n+=a+"="+encodeURIComponent(e[a])+"&");return r+n}(a),e).then(t.actions.normalizeResponse).then(function(t){if(t.error)n(t);else{if(t=t,e["card-number"]){var a=e["card-number"].replace(/\D/g,""),o=a.substr(0,6),i=a.substr(-4),d=ae(a);t.details=t.details||{},t.details.cardNumber=o+"*".repeat(a.length-10)+i,t.details.cardBin=o,t.details.cardLast4=i,t.details.cardType=d?d.code:"unknown",t.details.cardSecurityCode=!!e["card-cvv"]}if(e["card-expiration"]&&-1!==e["card-expiration"].indexOf(" / ")){var c=e["card-expiration"].split(" / ");t.details=t.details||{},t.details.expiryMonth=c[0]||"",t.details.expiryYear=c[1]||""}if(e["card-holder-name"]&&(t.details=t.details||{},t.details.cardholderName=t.details.cardholderName||e["card-holder-name"]),e["card-track"]){d=function(e,t,r){void 0===t&&(t=!1);var n="";if(t&&r&&"02"===r)n=e.split("=")[0];else{var a=e.split("%");a[1]&&(a=a[1].split("^"))[0]&&(n=a[0].toString().substr(1))}return ae(n)}(e["card-track"]);t.details=t.details||{},t.details.cardType=d?d.code:"unknown"}if(e["account-number"]){var s=e["account-number"].replace(/\D/g,"");i=s.substr(-4);t.details=t.details||{},t.details.accountNumber="*".repeat(s.length-4)+i,t.details.accountLast4=i}r(t)}}).catch(n)})},de=new ne,ce=Object.freeze({bus:de,tokenize:ie,loadedFrames:R,options:C,postMessage:S}),se=function(){function e(){}return e.prototype.format=function(e){var t=ae(e=e.replace(/\D/g,""));if(!t)return e;var r=e.match(t.format);return r?(t.format.global||r.shift(),r.join(" ").replace(/^\s+|\s+$/gm,"")):e},e}(),ue=function(){function e(){}return e.prototype.format=function(e,t){void 0===t&&(t=!1);var r,n,a,o=e.match(/^\D*(\d{1,2})(\D+)?(\d{1,4})?/);return o?(r=o[1]||"",n=o[2]||"",(a=o[3]||"").length>0?n=" / ":2===r.length||n.length>0?n=" / ":1===r.length&&"0"!==r&&"1"!==r&&(n=" / "),1===r.length&&""!==n&&(r="0"+r),t&&2===a.length&&(a=(new Date).getFullYear().toString().slice(0,2)+a),r+n+a):""},e}(),le=function(){function e(){}return e.prototype.validate=function(e){if(!e)return!1;var t=ae(e=e.replace(/[-\s]/g,""));return!!t&&(function(e){var t,r=!0,n=0,a=0;if(!e)return!1;for(var o=e.split("").reverse(),i=o.length;n<i;n++)t=parseInt(o[n],10),(r=!r)&&(t*=2),t>9&&(t-=9),a+=t;return a%10==0}(e)&&e.length===t.length)},e}(),pe=function(){function e(){}return e.prototype.validate=function(e,t){return!!e&&(e=e.replace(/^\s+|\s+$/g,""),!!/^\d+$/.test(e)&&(void 0!==t&&!0===t?4===e.length:void 0!==t&&!1===t?3===e.length:3<=e.length&&e.length<=4))},e}(),fe=function(){function e(){}return e.prototype.validate=function(e){var t,r;if(!e)return!1;var n=e.split("/");if(t=n[0],r=n[1],!t||!r)return!1;if(t=t.replace(/^\s+|\s+$/g,""),r=r.replace(/^\s+|\s+$/g,""),!/^\d+$/.test(t))return!1;if(!/^\d+$/.test(r))return!1;2===r.length&&(r=(new Date).getFullYear().toString().slice(0,2)+r);var a=parseInt(t,10),o=parseInt(r,10);return 1<=a&&a<=12&&new Date(o,a,1)>new Date},e}(),me=function(){function e(){}return e.listen=function(e,t,r){document.addEventListener?e.addEventListener(t,r,!1):e===document?document.documentElement.attachEvent("onpropertychange",function(e){e.propertyName===t&&r(e)}):e.attachEvent("on"+t,r)},e.trigger=function(e,t){if(document.createEvent){var r=document.createEvent("Event");r.initEvent(t,!0,!0),e.dispatchEvent(r)}else document.documentElement[t]++},e.ignore=function(e,t){document.removeEventListener?document.removeEventListener(e,t,!1):document.documentElement.detachEvent("onpropertychange",function(r){r.propertyName===e&&t(r)})},e}(),he=function(){function e(){}return e.addHandler=function(e,t,r){var n;(n="string"==typeof e?document.getElementById(e):e)&&(document.addEventListener?n.addEventListener(t,r,!1):me.listen(n,t,r))},e.removeHandler=function(e,t,r){var n;(n="string"==typeof e?document.getElementById(e):e)&&(document.removeEventListener?n.removeEventListener(t,r,!1):me.ignore(t,r))},e.trigger=function(e,t){if(document.createEvent){var r=document.createEvent("Event");r.initEvent(e,!0,!0),t.dispatchEvent(r)}else me.trigger(t,e)},e}(),ve=function(){function e(){}return e.addType=function(e){for(var t=e.currentTarget?e.currentTarget:e.srcElement,r=ae(t.value),n=t.className.split(" "),a=n.length,o=0,i="";o<a;o++)(i=n[o])&&-1!==i.indexOf("card-type-")&&delete n[o];if(r){n.push("card-type-"+r.code);var d=t.getAttribute("data-id");d&&S.post({data:{cardType:r.code},id:d,type:"ui:iframe-field:card-type"},"parent")}t.className=n.join(" ").replace(/^\s+|\s+$/gm,"")},e.formatNumber=function(e){var t=e.currentTarget?e.currentTarget:e.srcElement,r=t.value;if(0!==r.length){var n=(new se).format(r);if(t.value=n,t.setSelectionRange){var a=t.selectionStart||0;r.length<n.length&&(a+=n.length-r.length)," "===r.charAt(a)&&" "===n.charAt(a-1)&&(a+=1),t.setSelectionRange(a,a)}}},e.formatExpiration=function(e){var t=e.currentTarget?e.currentTarget:e.srcElement,r=t.value;-1!==[46,8].indexOf(e.keyCode)||e.keyCode>=35&&e.keyCode<=39||(t.value=(new ue).format(r,"blur"===e.type))},e.restrictLength=function(e){return function(t){var r=(t.currentTarget?t.currentTarget:t.srcElement).value;-1!==[46,8,9,27,13,110].indexOf(t.keyCode)||65===t.keyCode&&!0===t.ctrlKey||t.keyCode>=35&&t.keyCode<=39||r.length>=e&&(t.preventDefault?t.preventDefault():t.returnValue=!1)}},e.restrictCardNumberLength=function(e){var t=(e.currentTarget?e.currentTarget:e.srcElement).value,r=ae(t);-1!==[46,8,9,27,13,110].indexOf(e.keyCode)||65===e.keyCode&&!0===e.ctrlKey||e.keyCode>=35&&e.keyCode<=39||t.replace(/\D/g,"").length>=(r?r.length:19)&&(e.preventDefault?e.preventDefault():e.returnValue=!1)},e.restrictNumeric=function(e){-1!==[46,8,9,27,13,110].indexOf(e.keyCode)||65===e.keyCode&&!0===e.ctrlKey||e.keyCode>=35&&e.keyCode<=39||229===e.keyCode||(e.shiftKey||e.keyCode<48||e.keyCode>57)&&(e.keyCode<96||e.keyCode>105)&&(e.preventDefault?e.preventDefault():e.returnValue=!1)},e.deleteProperly=function(e){var t=e.currentTarget?e.currentTarget:e.srcElement,r=t.value;if(t.setSelectionRange){var n=t.selectionStart||0;-1!==[46,8].indexOf(e.keyCode)&&" "===r.charAt(n-1)&&t.setSelectionRange(n-1,n-1)}},e.validateNumber=function(e){for(var t,r=e.currentTarget?e.currentTarget:e.srcElement,n=r.value.replace(/[-\s]/g,""),a=ae(n),o=r.className.split(" "),i=o.length,d=0;d<i;d++)-1!==o[d].indexOf("valid")&&delete o[d];(a&&n.length<a.length&&o.push("possibly-valid"),(new le).validate(n))?(o.push("valid"),(t=r.getAttribute("data-id"))&&S.post({data:{valid:!0},id:t,type:"ui:iframe-field:card-number-test"},"parent")):(o.push("invalid"),(t=r.getAttribute("data-id"))&&S.post({data:{valid:!1},id:t,type:"ui:iframe-field:card-number-test"},"parent"));r.className=o.join(" ").replace(/^\s+|\s+$/gm,"")},e.validateCvv=function(e){for(var t=e.currentTarget?e.currentTarget:e.srcElement,r=t.value,n=t.className.split(" "),a=n.length,o="",i="unknown",d=0;d<a;d++)-1!==(o=n[d]).indexOf("valid")&&delete n[d],-1!==o.indexOf("card-type-")&&(i=o.replace("card-type-",""));var c,s="amex"===i,u=s?4:3;(r.length<u&&n.push("possibly-valid"),(new pe).validate(r,"unknown"===i?void 0:s))?(n.push("valid"),(c=t.getAttribute("data-id"))&&S.post({data:{valid:!0},id:c,type:"ui:iframe-field:card-cvv-test"},"parent")):(n.push("invalid"),(c=t.getAttribute("data-id"))&&S.post({data:{valid:!1},id:c,type:"ui:iframe-field:card-cvv-test"},"parent"));t.className=n.join(" ").replace(/^\s+|\s+$/gm,"")},e.validateExpiration=function(e){for(var t=e.currentTarget?e.currentTarget:e.srcElement,r=t.value,n=t.className.split(" "),a=n.length,o=0;o<a;o++)-1!==n[o].indexOf("valid")&&delete n[o];var i,d=r.split(" / "),c=d[0],s=d[1];((!c||!s||c.length<2||s.length<4)&&n.push("possibly-valid"),(new fe).validate(r))?(n.push("valid"),(i=t.getAttribute("data-id"))&&S.post({data:{valid:!0},id:i,type:"ui:iframe-field:card-expiration-test"},"parent")):(n.push("invalid"),(i=t.getAttribute("data-id"))&&S.post({data:{valid:!1},id:i,type:"ui:iframe-field:card-expiration-test"},"parent"));t.className=n.join(" ").replace(/^\s+|\s+$/gm,"")},e.attachNumberEvents=function(t){var r=document.querySelector(t);r&&(he.addHandler(r,"keydown",e.restrictNumeric),he.addHandler(r,"keydown",e.restrictCardNumberLength),he.addHandler(r,"keydown",e.deleteProperly),he.addHandler(r,"keyup",e.formatNumber),he.addHandler(r,"input",e.formatNumber),he.addHandler(r,"input",e.validateNumber),he.addHandler(r,"input",e.addType))},e.attachExpirationEvents=function(t){var r=document.querySelector(t);r&&(he.addHandler(r,"keydown",e.restrictNumeric),he.addHandler(r,"keydown",e.restrictLength(9)),he.addHandler(r,"keyup",e.formatExpiration),he.addHandler(r,"blur",e.formatExpiration),he.addHandler(r,"input",e.validateExpiration),he.addHandler(r,"blur",e.validateExpiration))},e.attachCvvEvents=function(t){var r=document.querySelector(t);r&&(he.addHandler(r,"keydown",e.restrictNumeric),he.addHandler(r,"keydown",e.restrictLength(4)),he.addHandler(r,"input",e.validateCvv))},e}();Array.prototype.indexOf||(Array.prototype.indexOf=function(e,t){for(var r=t||0,n=this.length;r<n;r++)if(this[r]===e)return r;return-1});function ye(e){return e.replace(/&/g,"&amp;").replace(/[\uD800-\uDBFF][\uDC00-\uDFFF]/g,function(e){return"&#"+(1024*(e.charCodeAt(0)-55296)+(e.charCodeAt(1)-56320)+65536)+";"}).replace(/([^\#-~| |!])/g,function(e){return"&#"+e.charCodeAt(0)+";"}).replace(/</g,"&lt;").replace(/>/g,"&gt;")}var ge=function(e){function t(t,r,n){var a=e.call(this)||this;return a.id=btoa(P()),a.type="submit"===t||"card-track"===t?"button":"input",a.url=n,a.frame=a.makeFrame(t,a.id),a.frame.onload=function(){a.emit("load")},a.frame.src=n+"#"+btoa(JSON.stringify({id:a.id,targetOrigin:window.location.href,type:a.type})),a.container=document.querySelector(r),a.container?(a.container.appendChild(a.frame),a.on("dispose",function(){R[a.id]=void 0,a.container&&a.container.removeChild(a.frame)}),S.receive(function(e){if(e.id&&(!e.id||e.id===a.id)){var t=e.type.replace("ui:iframe-field:","");switch(t){case"register":S.post({data:C,id:a.id,type:"ui:iframe-field:update-options"},a.id);break;case"resize":a.frame.style.height=e.data.height+"px";break;case"pass-data":S.post({data:{type:e.data.type,value:e.data.value},id:e.data.target,type:"ui:iframe-field:accumulate-data"},e.data.target)}a.emit(t,e.data)}}),R[a.id]=a,a):(de.emit("error",{error:!0,reasons:[{code:"ERROR",message:"IframeField: target cannot be found with given selector"}]}),a)}return N(t,e),t.register=function(e){var r=window.location.hash.replace("#",""),n=JSON.parse(atob(r)),a=n.id;t.createField(a,e,n.type),t.addMessageListener(a,e,n.targetOrigin),S.post({data:{type:e},id:a,type:"ui:iframe-field:register"},"parent"),t.triggerResize(a),he.addHandler(document.body,"touchstart",function(){})},t.createField=function(e,r,n){var a=document.createElement("button"===n?"button":"input");if(a.setAttribute("type","button"===n?"button":"tel"),a.id=T,a.className=r,a.setAttribute("data-id",e),"card-track"===r){var o="Read Card";a.appendChild(document.createTextNode(o))}else if("button"===n){o="Submit";a.appendChild(document.createTextNode(o))}var i=document.getElementById(T+"-wrapper");if(i)switch(i.insertBefore(a,i.firstChild),t.addFrameFocusEvent(),"card-track"===r?he.addHandler(a,"click",function(){!function(e){var t=document.getElementById(T+"-data");t&&t.parentNode&&t.parentNode.removeChild(t),(t=document.createElement("input")).id=T+"-data",t.type="text";var r=document.querySelector(".extra-div-2");if(!r)throw new Error("TODO");r.style.height="0px",r.style.width="0px",r.style.overflow="hidden",r.appendChild(t);var n=document.getElementById(T),a=n&&n.innerText?n.innerText:"Read Card";n&&n.firstChild&&n.replaceChild(document.createTextNode("Waiting..."),n.firstChild),t.focus(),S.post({id:e,type:"ui:iframe-field:waiting-for-data"},"parent"),he.addHandler(t,"keydown",function(t){if(13===t.keyCode){S.post({id:e,type:"ui:iframe-field:data-received"},"parent"),t.preventDefault();var r=document.getElementById(T+"-data"),o=r&&r.value?r.value:"";ie({"card-track":o}).then(function(t){n&&n.firstChild&&n.replaceChild(document.createTextNode(a),n.firstChild),r.blur(),S.post({data:t,id:e,type:"ui:iframe-field:token-success"},"parent")}).catch(function(t){n&&n.firstChild&&n.replaceChild(document.createTextNode(a),n.firstChild),r.blur(),S.post({data:t,id:e,type:"ui:iframe-field:token-error"},"parent")})}})}(e)}):"button"===n&&he.addHandler(a,"click",function(){S.post({id:e,type:"ui:iframe-field:click"},"parent")}),r){case"card-number":ve.attachNumberEvents("#"+a.id),a.name="cardNumber";break;case"card-expiration":ve.attachExpirationEvents("#"+a.id);break;case"card-cvv":ve.attachCvvEvents("#"+a.id)}},t.addFrameFocusEvent=function(){var e=document.getElementById(T);if(e){var t=function(t){t.fromElement!==e&&(t.relatedTarget||e.focus())};document.onfocusin?he.addHandler(document,"focusin",t):he.addHandler(document,"focus",t)}},t.addMessageListener=function(e,r,n){R.parent={frame:parent,url:n},S.receive(function(n){var a;if(n.id&&(!n.id||n.id===e))switch(n.type.replace("ui:iframe-field:","")){case"accumulate-data":!function(e,t,r){if("card-number"===t||"account-number"===t){var n=window;if(n.dataContents=n.dataContents||{},n.dataContents[r.data.type]=r.data.value,n.dataReceivedFields||(n.dataReceivedFields=["submit"]),n.dataReceivedFields.push(r.data.type),JSON.stringify(n.dataFields.sort())===JSON.stringify(n.dataReceivedFields.sort())){var a=document.getElementById(T),o=a&&a.value?a.value:"";ie({"account-number":"account-number"===window.name&&o,"card-cvv":void 0!==n.dataContents["card-cvv"]&&n.dataContents["card-cvv"],"card-expiration":void 0!==n.dataContents["card-expiration"]&&n.dataContents["card-expiration"],"card-holder-name":void 0!==n.dataContents["card-holder-name"]&&n.dataContents["card-holder-name"],"card-number":"card-number"===window.name&&o,"routing-number":void 0!==n.dataContents["routing-number"]&&n.dataContents["routing-number"]}).then(function(t){n.dataContents=void 0,n.dataReceivedFields=void 0,S.post({data:t,id:e,type:"ui:iframe-field:token-success"},"parent")}).catch(function(t){n.dataContents=void 0,n.dataReceivedFields=void 0,S.post({data:t,id:e,type:"ui:iframe-field:token-error"},"parent")})}}}(e,r,n);break;case"add-stylesheet":K(n.data.css),t.triggerResize(e);break;case"payment-request-complete":!function(e,t){O(void 0,void 0,void 0,function(){return A(this,function(r){return window.globalPaymentResponse?(window.globalPaymentResponse.complete(t.data.status).then(function(){S.post({id:e,type:"ui:iframe-field:payment-request-completed"},"parent")}).catch(function(t){S.post({data:{code:"ERROR",message:t.message},id:e,type:"ui:iframe-field:error"},"parent")}),[2]):(S.post({data:{code:"ERROR",message:"Missing PaymentResponse object"},id:e,type:"ui:iframe-field:error"},"parent"),[2])})})}(e,n);break;case"payment-request-start":!function(e,t){O(void 0,void 0,void 0,function(){var r,n,a,o,i,d,c,s,u,l;return A(this,function(p){switch(p.label){case 0:return p.trys.push([0,2,,3]),[4,new PaymentRequest(t.data.instruments,t.data.details,t.data.options).show()];case 1:return r=p.sent(),window.globalPaymentResponse=r,[3,3];case 2:return n=p.sent(),a="ERROR","Error"!==n.name&&(a=n.name.replace("Error","_Error").toUpperCase()),S.post({data:{code:a,message:n.message},id:e,type:"ui:iframe-field:token-error"},"parent"),[2];case 3:return p.trys.push([3,5,,6]),[4,ie({"card-cvv":r.details.cardSecurityCode||"","card-expiration":(r.details.expiryMonth||"")+" / "+(r.details.expiryYear||""),"card-holder-name":r.details.cardholderName||"","card-number":r.details.cardNumber||""})];case 4:return o=p.sent(),i=r.toJSON(),d=r.details.cardNumber.replace(/\D/g,""),c=d.substr(0,6),s=d.substr(-4),u=ae(d),i.details=i.details||{},i.details.cardNumber=c+"*".repeat(d.length-10)+s,i.details.cardBin=c,i.details.cardLast4=s,i.details.cardType=u?u.code:"unknown",i.details.cardSecurityCode=!!r.details.cardSecurityCode,o.details=i.details,o.methodName=i.methodName,o.payerEmail=i.payerEmail,o.payerName=i.payerName,o.payerPhone=i.payerPhone,o.requestId=i.requestId,o.shippingAddress=i.shippingAddress,o.shippingOption=i.shippingOption,S.post({data:o,id:e,type:"ui:iframe-field:token-success"},"parent"),[3,6];case 5:return l=p.sent(),r.complete("fail"),S.post({data:l,id:e,type:"ui:iframe-field:token-error"},"parent"),[3,6];case 6:return[2]}})})}(e,n);break;case"request-data":!function(e,t,r){window.dataReceivedFields||(window.dataReceivedFields=["submit"]);var n=document.getElementById(T),a=n&&n.value?n.value:"";"card-number"!==t&&"account-number"!==t||(window.dataFields=r.data.fields,a=""),S.post({data:{target:r.data.target,type:t,value:a},id:e,type:"ui:iframe-field:pass-data"},"parent")}(e,r,n);break;case"set-card-type":!function(e){var t=document.getElementById(T);if(t){for(var r=t.className.split(" "),n=r.length,a=0,o="";a<n;a++)(o=r[a])&&-1!==o.indexOf("card-type-")&&delete r[a];e&&r.push("card-type-"+e),t.className=r.join(" ")}}(n.data.cardType);break;case"set-focus":(a=document.getElementById(T))&&a.focus();break;case"set-placeholder":!function(e){var t=document.getElementById(T);t&&("•••• •••• •••• ••••"===e||"•••••••••"===e||"••••"===e||"•••"===e||"···· ···· ···· ····"===e?t.setAttribute("placeholder",e):t.setAttribute("placeholder",ye(e)))}(n.data.placeholder),t.triggerResize(e);break;case"set-text":!function(e){var t=document.getElementById(T);t&&(t.textContent=ye(e))}(n.data.text),t.triggerResize(e);break;case"set-value":!function(e){var t=document.getElementById(T);t&&t.setAttribute("value",ye(e))}(n.data.value),t.triggerResize(e);break;case"update-options":for(var o in n.data)n.data.hasOwnProperty(o)&&(C[o]=n.data[o])}})},t.triggerResize=function(e){S.post({data:{height:document.body.offsetHeight+1},id:e,type:"ui:iframe-field:resize"},"parent")},t.prototype.addStylesheet=function(e){var t=W(e);S.post({data:{css:t},id:this.id,type:"ui:iframe-field:add-stylesheet"},this.id)},t.prototype.setFocus=function(){S.post({id:this.id,type:"ui:iframe-field:set-focus"},this.id)},t.prototype.setPlaceholder=function(e){S.post({data:{placeholder:e},id:this.id,type:"ui:iframe-field:set-placeholder"},this.id)},t.prototype.setText=function(e){S.post({data:{text:e},id:this.id,type:"ui:iframe-field:set-text"},this.id)},t.prototype.setValue=function(e){S.post({data:{value:e},id:this.id,type:"ui:iframe-field:set-value"},this.id)},t.prototype.makeFrame=function(e,t){var r=document.createElement("iframe");return r.id="secure-payment-field-"+e+"-"+t,r.name=e,r.style.border="0",r.frameBorder="0",r.scrolling="no",r.setAttribute("allowtransparency","true"),r.allowPaymentRequest=!0,r},t}(ne),be={blank:{},default:te},xe={blank:{},default:re},we=["card-number","card-expiration","card-cvv","card-holder-name","card-track","account-number","routing-number","submit"],Ee=function(){function e(e,t){this.totalNumberOfFields=0,this.frames={},this.fields=e,this.styles=t,this.createFrames()}return e.prototype.on=function(e,t,r){if("string"==typeof t&&r){if(Ce(this.frames,e),!(o=this.frames[e]))return;return o.on(t,r),this}for(var n in we)if(we.hasOwnProperty(n)){var a=we[n];if(this.frames.hasOwnProperty(a)){var o;if(Ce(this.frames,a),!(o=this.frames[a]))return;o.on(e,t)}}return this},e.prototype.addStylesheet=function(e){for(var t in we)if(we.hasOwnProperty(t)){var r=we[t];if(this.frames.hasOwnProperty(r)){Ce(this.frames,r);var n=this.frames[r];if(!n)return;n.addStylesheet(e)}}return this},e.prototype.ready=function(e){var t=this,r=0;for(var n in we)if(we.hasOwnProperty(n)){var a=we[n];if(this.frames.hasOwnProperty(a)){Ce(this.frames,a);var o=this.frames[a];if(!o)return;o.on("register",function(){++r===t.totalNumberOfFields&&e(t.frames)})}}},e.prototype.dispose=function(){for(var e in we)if(we.hasOwnProperty(e)){var t=we[e];if(this.frames.hasOwnProperty(t)){var r=this.frames[t];if(!r)return;r.emit("dispose")}}},e.prototype.createFrames=function(){for(var e=this,t=function(t){if(!r.fields[t])return"continue";var n=r.frames[t]=new ge(t,r.fields[t].target||"",Z()+"field.html");if(r.totalNumberOfFields++,void 0===n)return"continue";n.on("register",function(){e.fields[t].placeholder&&n.setPlaceholder(e.fields[t].placeholder||""),e.fields[t].text&&n.setText(e.fields[t].text||""),e.fields[t].value&&n.setValue(e.fields[t].value||""),e.styles&&n.addStylesheet(e.styles)})},r=this,n=0,a=we;n<a.length;n++){t(a[n])}void 0!==this.frames.submit&&this.frames.submit.on("click",function(){var t=e.frames["card-number"]||e.frames["account-number"];t&&e.requestDataFromAll(t)});var o=this.frames["card-number"],i=this.frames["card-cvv"];o&&i&&o.on("card-type",function(e){S.post({data:e,id:i.id,type:"ui:iframe-field:set-card-type"},i.id)})},e.prototype.requestDataFromAll=function(e){for(var t=[],r=0,n=we;r<n.length;r++){var a=n[r];this.frames[a]&&t.push(a)}for(var o=0,i=t;o<i.length;o++){if("submit"!==(a=i[o])){var d=this.frames[a];d&&S.post({data:{fields:t,target:e.id},id:d.id,type:"ui:iframe-field:request-data"},d.id)}}},e}();function Ce(e,t){if(-1===we.indexOf(t))throw new Error("Supplied field type is invalid");if(!e[t])throw new Error("No field with the type `"+t+"` is currently available")}var ke={labels:{"card-cvv":"Card CVV:","card-expiration":"Card Expiration:","card-holder-name":"Card Holder Name:","card-number":"Card Number:"},placeholders:{"card-cvv":"•••","card-expiration":"MM / YYYY","card-holder-name":"Jane Smith","card-number":"•••• •••• •••• ••••"},prefix:"credit-card-",style:"default",values:{"card-track":"Read Card",submit:"Submit"}};var Ne=Object.freeze({defaultOptions:ke,form:function(e,t){if(void 0===t&&(t={}),"string"==typeof e){if(!(i=document.querySelector(e)))throw new Error("Credit card form target does not exist");e=i}e.className=e.className+" secure-payment-form";var r=$();r&&"production"!==r.getEnv(C)&&E(e),t=G(G({},ke),t);var n=["card-holder-name","card-number","card-expiration","card-cvv","submit"],a={};for(var o in n)if(n.hasOwnProperty(o)){var i,d=n[o];if(t.labels&&t.labels[d]){var c=document.createElement("label");c.setAttribute("for",t.prefix+d),c.appendChild(document.createTextNode(t.labels[d])),e.appendChild(c)}(i=document.createElement("div")).id=t.prefix+d,e.appendChild(i),a[d]={},a[d].target="#"+t.prefix+d,t.placeholders&&t.placeholders[d]&&(a[d].placeholder=t.placeholders[d]),t.values&&t.values[d]&&(a[d].value=t.values[d])}return t.style&&K(W(xe[t.style]),"secure-payment-styles-"+t.style),new Ee(a,t.style?be[t.style]:{})},trackReaderForm:function(e,t){if(void 0===t&&(t={}),"string"==typeof e){if(!(i=document.querySelector(e)))throw new Error("Credit card track reader form target does not exist");e=i}e.className=e.className+" secure-payment-form";var r=$();r&&"production"!==r.getEnv(C)&&E(e),(t=G(G({},ke),t)).prefix="track-reader-";var n=["card-track"],a={};for(var o in n)if(n.hasOwnProperty(o)){var i,d=n[o];if(t.labels&&t.labels[d]){var c=document.createElement("label");c.setAttribute("for",t.prefix+d),c.appendChild(document.createTextNode(t.labels[d])),e.appendChild(c)}(i=document.createElement("div")).id=t.prefix+d,e.appendChild(i),a[d]={},a[d].target="#"+t.prefix+d,t.placeholders&&t.placeholders[d]&&(a[d].placeholder=t.placeholders[d]),t.values&&t.values[d]&&(a[d].value=t.values[d])}return t.style&&K(W(xe[t.style]),"secure-payment-styles-"+t.style),new Ee(a,t.style?be[t.style]:{})}}),Oe={labels:{"account-number":"Account Number:","account-type":"Account Type:","check-type":"Check Type:","routing-number":"Routing Number:"},placeholders:{"account-number":"•••••••••","routing-number":"•••••••••"},prefix:"echeck-",style:"default",values:{submit:"Submit"}};var Ae=Object.freeze({defaultOptions:Oe,form:function(e,t){if(void 0===t&&(t={}),"string"==typeof e){if(!(i=document.querySelector(e)))throw new Error("ACH/eCheck form target does not exist");e=i}e.className=e.className+" secure-payment-form";var r=$();r&&"production"!==r.getEnv(C)&&E(e),t=G(G({},Oe),t);var n=["account-number","routing-number","account-type","check-type","submit"],a={};for(var o in n)if(n.hasOwnProperty(o)){var i,d=n[o];if(t.labels&&t.labels[d]){var c=document.createElement("label");c.setAttribute("for",t.prefix+d),c.appendChild(document.createTextNode(t.labels[d])),e.appendChild(c)}if((i=document.createElement("div")).id=t.prefix+d,e.appendChild(i),"account-type"!==d)if("check-type"!==d)a[d]={},a[d].target="#"+t.prefix+d,t.placeholders&&t.placeholders[d]&&(a[d].placeholder=t.placeholders[d]),t.values&&t.values[d]&&(a[d].value=t.values[d]);else{(l=document.createElement("select")).name="check-type",(p=document.createElement("option")).appendChild(document.createTextNode("-- Check Type --")),p.disabled=!0,p.selected=!0,l.appendChild(p);var s=document.createElement("option");s.appendChild(document.createTextNode("Checking")),l.appendChild(s);var u=document.createElement("option");u.appendChild(document.createTextNode("Savings")),l.appendChild(u),i.appendChild(l)}else{var l,p;(l=document.createElement("select")).name="account-type",(p=document.createElement("option")).appendChild(document.createTextNode("-- Account Type --")),p.disabled=!0,p.selected=!0,l.appendChild(p);var f=document.createElement("option");f.appendChild(document.createTextNode("Personal")),l.appendChild(f);var m=document.createElement("option");m.appendChild(document.createTextNode("Business")),l.appendChild(m),i.appendChild(l)}}return t.style&&K(W(xe[t.style])),new Ee(a,t.style?be[t.style]:{})}}),Re={labels:{"card-number":"Card Number:",pin:"PIN:"},placeholders:{"card-number":"•••• •••• •••• ••••",pin:"••••"},prefix:"gift-and-loyalty-",style:"default",values:{submit:"Submit"}};var Se=Object.freeze({defaultOptions:Re,form:function(e,t){if(void 0===t&&(t={}),"string"==typeof e){if(!(i=document.querySelector(e)))throw new Error("Gift and loyalty form target does not exist");e=i}e.className=e.className+" secure-payment-form";var r=$();r&&"production"!==r.getEnv(C)&&E(e),t=G(G({},Re),t);var n=["card-number","pin","submit"],a={};for(var o in n)if(n.hasOwnProperty(o)){var i,d=n[o];if(t.labels&&t.labels[d]){var c=document.createElement("label");c.setAttribute("for",t.prefix+d),c.appendChild(document.createTextNode(t.labels[d])),e.appendChild(c)}if((i=document.createElement("div")).id=t.prefix+d,e.appendChild(i),"pin"!==d)a[d]={},a[d].target="#"+t.prefix+d,t.placeholders&&t.placeholders[d]&&(a[d].placeholder=t.placeholders[d]),t.values&&t.values[d]&&(a[d].value=t.values[d]);else{var s=document.createElement("input");s.name="pin",s.type="tel",i.appendChild(s)}}return t.style&&K(W(xe[t.style])),new Ee(a,t.style?be[t.style]:{})}});var _e="global-pay-payment-request",Te=function(e){function t(t){var r=e.call(this)||this;return r.iframe=t,r}return N(t,e),t.prototype.on=function(e,t){this.iframe.on(e,t)},t}(ne);var Pe=function(e){e.remove?e.remove():e.parentNode&&e.parentNode.removeChild&&e.parentNode.removeChild(e)},Ie=Object.freeze({complete:function(e){var t=R;for(var r in t)t.hasOwnProperty(r)&&S.post({data:{status:e},id:r,type:"ui:iframe-field:payment-request-complete"},r)},setup:function(e,t,r,n,a){void 0===a&&(a=!1);var o=document.querySelector(e);if(!o)return de.emit("error",{error:!0,reasons:[{code:"INVALID_CONFIGURATION",message:"Invalid target element"}]});if("undefined"==typeof PaymentRequest)return de.emit("error",{error:!0,reasons:[{code:"ERROR",message:"PaymentRequest API not available"}]});var i=document.createElement("div");i.id=_e,i.style.display="none";var d=o.parentElement;if(!d)return de.emit("error",{error:!0,reasons:[{code:"INVALID_CONFIGURATION",message:"Target element has no parent"}]});d.appendChild(i),o.style.display=null;var c=new ge("payment-request","#"+i.id,Z()+"field.html");r=r||[{supportedMethods:["basic-card"]}],t=t||{},n=n||{};var s=new Te(c),u=function(){return S.post({data:{details:t,instruments:r,options:n},id:c.id,type:"ui:iframe-field:payment-request-start"},c.id)};return a?s.on("register",function(){u()}):he.addHandler(o,"click",function(e){return e.preventDefault(),u(),!1}),c.on("token-success",function(e){a&&Pe(i),s.emit("token-success",e)}),c.on("token-error",function(e){a&&Pe(i),s.emit("token-error",e)}),c.on("payment-request-closed",function(){a&&Pe(i),s.emit("error",{error:!0,reasons:[{code:"PAYMENT_UI_CLOSED",message:"Payment UI closed"}]})}),c.on("error",function(e){a&&Pe(i),s.emit("error",{error:!0,reasons:[e]})}),s}});return{configure:function(e){for(var t in e)e.hasOwnProperty(t)&&(C[t]=e[t]);var r=$();r&&r.actions.setup&&r.actions.setup()},creditCard:Ne,eCheck:Ae,events:he,giftAndLoyalty:Se,internal:ce,on:function(e,t){return de.on(e,t)},paymentRequest:Ie,ui:Object.freeze({form:function(e){return new Ee(e.fields,e.styles||{})},IframeField:ge})}}();
//# sourceMappingURL=globalpayments.min.js.map
