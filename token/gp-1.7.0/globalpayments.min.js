!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?module.exports=t():"function"==typeof define&&define.amd?define(t):(e="undefined"!=typeof globalThis?globalThis:e||self).GlobalPayments=t()}(this,(function(){"use strict";var e="function"==typeof fetch?fetch.bind():function(e,t){return t=t||{},new Promise((function(r,n){var a=new XMLHttpRequest;for(var o in a.open(t.method||"get",e,!0),t.headers)a.setRequestHeader(o,t.headers[o]);function i(){var e,t=[],r=[],n={};return a.getAllResponseHeaders().replace(/^(.*?):[^\S\n]*([\s\S]*?)$/gm,(function(a,o,i){t.push(o=o.toLowerCase()),r.push([o,i]),e=n[o],n[o]=e?e+","+i:i})),{ok:2==(a.status/100|0),status:a.status,statusText:a.statusText,url:a.responseURL,clone:i,text:function(){return Promise.resolve(a.responseText)},json:function(){return Promise.resolve(a.responseText).then(JSON.parse)},blob:function(){return Promise.resolve(new Blob([a.response]))},headers:{keys:function(){return t},entries:function(){return r},get:function(e){return n[e.toLowerCase()]},has:function(e){return e.toLowerCase()in n}}}}a.withCredentials="include"==t.credentials,a.onload=function(){r(i())},a.onerror=n,a.send(t.body||null)}))};function t(e){if(e.__esModule)return e;var t=Object.defineProperty({},"__esModule",{value:!0});return Object.keys(e).forEach((function(r){var n=Object.getOwnPropertyDescriptor(e,r);Object.defineProperty(t,r,n.get?n:{enumerable:!0,get:function(){return e[r]}})})),t}var r=t(Object.freeze({__proto__:null,default:e}));window.fetch||(window.fetch=r.default||r),Array.prototype.forEach||(Array.prototype.forEach=function(e){for(var t=0;t<this.length;t++)e(this[t],t,this)});for(var n=function(e){var t,r,n=function(e){var t=e.length;if(t%4>0)throw new Error("Invalid string. Length must be a multiple of 4");var r=e.indexOf("=");-1===r&&(r=t);return[r,r===t?0:4-r%4]}(e),a=n[0],o=n[1],s=new c(function(e,t,r){return 3*(t+r)/4-r}(0,a,o)),d=0,u=o>0?a-4:a;for(r=0;r<u;r+=4)t=i[e.charCodeAt(r)]<<18|i[e.charCodeAt(r+1)]<<12|i[e.charCodeAt(r+2)]<<6|i[e.charCodeAt(r+3)],s[d++]=t>>16&255,s[d++]=t>>8&255,s[d++]=255&t;2===o&&(t=i[e.charCodeAt(r)]<<2|i[e.charCodeAt(r+1)]>>4,s[d++]=255&t);1===o&&(t=i[e.charCodeAt(r)]<<10|i[e.charCodeAt(r+1)]<<4|i[e.charCodeAt(r+2)]>>2,s[d++]=t>>8&255,s[d++]=255&t);return s},a=function(e){for(var t,r=e.length,n=r%3,a=[],i=16383,c=0,s=r-n;c<s;c+=i)a.push(l(e,c,c+i>s?s:c+i));1===n?(t=e[r-1],a.push(o[t>>2]+o[t<<4&63]+"==")):2===n&&(t=(e[r-2]<<8)+e[r-1],a.push(o[t>>10]+o[t>>4&63]+o[t<<2&63]+"="));return a.join("")},o=[],i=[],c="undefined"!=typeof Uint8Array?Uint8Array:Array,s="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",d=0,u=s.length;d<u;++d)o[d]=s[d],i[s.charCodeAt(d)]=d;function l(e,t,r){for(var n,a,i=[],c=t;c<r;c+=3)n=(e[c]<<16&16711680)+(e[c+1]<<8&65280)+(255&e[c+2]),i.push(o[(a=n)>>18&63]+o[a>>12&63]+o[a>>6&63]+o[63&a]);return i.join("")}i["-".charCodeAt(0)]=62,i["_".charCodeAt(0)]=63,window.btoa=window.btoa||function(e){var t,r=e.length,n=new("undefined"!=typeof Uint8Array?Uint8Array:Array)(r);for(t=0;t<r;t++)n[t]=e.charCodeAt(t);return a(n)},window.atob=window.atob||function(e){var t,r=n(e),a=r.length,o="";for(t=0;t<a;t++)o+=String.fromCharCode(r[t]);return o};var p,f={};!function(){function e(e){return e<10?"0"+e:e}if("function"!=typeof Date.prototype.toJSON){Date.prototype.toJSON=function(t){return isFinite(this.valueOf())?this.getUTCFullYear()+"-"+e(this.getUTCMonth()+1)+"-"+e(this.getUTCDate())+"T"+e(this.getUTCHours())+":"+e(this.getUTCMinutes())+":"+e(this.getUTCSeconds())+"Z":""};var t=String.prototype;Number.prototype.JSON=t.JSON=Boolean.prototype.toJSON=function(e){return this.valueOf()}}var r,n,a,o=/[\u0000\u00ad\u0600-\u0604\u070f\u17b4\u17b5\u200c-\u200f\u2028-\u202f\u2060-\u206f\ufeff\ufff0-\uffff]/g,i=/[\\\"\x00-\x1f\x7f-\x9f\u00ad\u0600-\u0604\u070f\u17b4\u17b5\u200c-\u200f\u2028-\u202f\u2060-\u206f\ufeff\ufff0-\uffff]/g,c={"\b":"\\b","\t":"\\t","\n":"\\n","\f":"\\f","\r":"\\r",'"':'\\"',"\\":"\\\\"};function s(e){return i.lastIndex=0,i.test(e)?'"'+e.replace(i,(function(e){var t=c[e];return"string"==typeof t?t:"\\u"+("0000"+e.charCodeAt(0).toString(16)).slice(-4)}))+'"':'"'+e+'"'}function d(e,t){var o,i,c,u,l,p=r,f=t[e];switch(f&&"object"==typeof f&&"function"==typeof f.toJSON&&(f=f.toJSON(e)),"function"==typeof a&&(f=a.call(t,e,f)),typeof f){case"string":return s(f);case"number":return isFinite(f)?String(f):"null";case"boolean":case"null":return String(f);case"object":if(!f)return"null";if(r+=n,l=[],"[object Array]"===Object.prototype.toString.apply(f,[])){for(u=f.length,o=0;o<u;o+=1)l[o]=d(o.toString(),f)||"null";return c=0===l.length?"[]":r?"[\n"+r+l.join(",\n"+r)+"\n"+p+"]":"["+l.join(",")+"]",r=p,c}if(a&&"object"==typeof a)for(u=a.length,o=0;o<u;o+=1)"string"==typeof a[o]&&(c=d(i=a[o],f))&&l.push(s(i)+(r?": ":":")+c);else for(i in f)Object.prototype.hasOwnProperty.call(f,i)&&(c=d(i,f))&&l.push(s(i)+(r?": ":":")+c);return c=0===l.length?"{}":r?"{\n"+r+l.join(",\n"+r)+"\n"+p+"}":"{"+l.join(",")+"}",r=p,c}}"function"!=typeof f.stringify&&(f.stringify=function(e,t,o){var i;if(r="",n="","number"==typeof o)for(i=0;i<o;i+=1)n+=" ";else"string"==typeof o&&(n=o);if(a=t,t&&"function"!=typeof t&&("object"!=typeof t||"number"!=typeof t.length))throw new Error("JSON.stringify");return d("",{"":e})}),"function"!=typeof f.parse&&(f.parse=function(e,t){var r;if(e=String(e),o.lastIndex=0,o.test(e)&&(e=e.replace(o,(function(e){return"\\u"+("0000"+e.charCodeAt(0).toString(16)).slice(-4)}))),/^[\],:{}\s]*$/.test(e.replace(/\\(?:["\\\/bfnrt]|u[0-9a-fA-F]{4})/g,"@").replace(/"[^"\\\n\r]*"|true|false|null|-?\d+(?:\.\d*)?(?:[eE][+\-]?\d+)?/g,"]").replace(/(?:^|:|,)(?:\s*\[)+/g,"")))return r=new Function("return ("+e+")")(),"function"==typeof t?function e(r,n){var a,o,i=r[n];if(i&&"object"==typeof i)for(a in i)Object.prototype.hasOwnProperty.call(i,a)&&(o=e(i,a),i[a]=o);return t.call(r,n,i)}({"":r},""):r;throw new SyntaxError("JSON.parse")})}(),window.JSON=window.JSON||f,Object.freeze||(Object.freeze=function(e){if(Object(e)!==e)throw new TypeError("Object.freeze can only be called on Objects.");return e});try{Object.freeze((function(){}))}catch(e){Object.freeze=(p=Object.freeze,function(e){return"function"==typeof e?e:p(e)})}Object.prototype.hasOwnProperty||(Object.prototype.hasOwnProperty=function(e){return void 0!==this[e]}),Object.getOwnPropertyNames||(Object.getOwnPropertyNames=function(e){var t=[];for(var r in e)void 0!==e.hasOwnProperty&&e.hasOwnProperty(r)&&t.push(r);return t});var m=setTimeout;function h(){}function v(e){if(!(this instanceof v))throw new TypeError("Promises must be constructed via new");if("function"!=typeof e)throw new TypeError("not a function");this._state=0,this._handled=!1,this._value=void 0,this._deferreds=[],k(e,this)}function g(e,t){for(;3===e._state;)e=e._value;0!==e._state?(e._handled=!0,v._immediateFn((function(){var r=1===e._state?t.onFulfilled:t.onRejected;if(null!==r){var n;try{n=r(e._value)}catch(e){return void b(t.promise,e)}y(t.promise,n)}else(1===e._state?y:b)(t.promise,e._value)}))):e._deferreds.push(t)}function y(e,t){try{if(t===e)throw new TypeError("A promise cannot be resolved with itself.");if(t&&("object"==typeof t||"function"==typeof t)){var r=t.then;if(t instanceof v)return e._state=3,e._value=t,void x(e);if("function"==typeof r)return void k((n=r,a=t,function(){n.apply(a,arguments)}),e)}e._state=1,e._value=t,x(e)}catch(t){b(e,t)}var n,a}function b(e,t){e._state=2,e._value=t,x(e)}function x(e){2===e._state&&0===e._deferreds.length&&v._immediateFn((function(){e._handled||v._unhandledRejectionFn(e._value)}));for(var t=0,r=e._deferreds.length;t<r;t++)g(e,e._deferreds[t]);e._deferreds=null}function w(e,t,r){this.onFulfilled="function"==typeof e?e:null,this.onRejected="function"==typeof t?t:null,this.promise=r}function k(e,t){var r=!1;try{e((function(e){r||(r=!0,y(t,e))}),(function(e){r||(r=!0,b(t,e))}))}catch(e){if(r)return;r=!0,b(t,e)}}v.prototype.catch=function(e){return this.then(null,e)},v.prototype.then=function(e,t){var r=new this.constructor(h);return g(this,new w(e,t,r)),r},v.prototype.finally=function(e){var t=this.constructor;return this.then((function(r){return t.resolve(e()).then((function(){return r}))}),(function(r){return t.resolve(e()).then((function(){return t.reject(r)}))}))},v.all=function(e){return new v((function(t,r){if(!e||void 0===e.length)throw new TypeError("Promise.all accepts an array");var n=Array.prototype.slice.call(e);if(0===n.length)return t([]);var a=n.length;function o(e,i){try{if(i&&("object"==typeof i||"function"==typeof i)){var c=i.then;if("function"==typeof c)return void c.call(i,(function(t){o(e,t)}),r)}n[e]=i,0==--a&&t(n)}catch(e){r(e)}}for(var i=0;i<n.length;i++)o(i,n[i])}))},v.resolve=function(e){return e&&"object"==typeof e&&e.constructor===v?e:new v((function(t){t(e)}))},v.reject=function(e){return new v((function(t,r){r(e)}))},v.race=function(e){return new v((function(t,r){for(var n=0,a=e.length;n<a;n++)e[n].then(t,r)}))},v._immediateFn="function"==typeof setImmediate&&function(e){setImmediate(e)}||function(e){m(e,0)},v._unhandledRejectionFn=function(e){"undefined"!=typeof console&&console};var E=v,C=Object.freeze(Object.assign(Object.create(null),E,{default:E}));function _(e,t){var r=document.createElement("div"),n=document.createTextNode("This page is currently in sandbox/test mode. Do not use real/active card numbers.");if(r.appendChild(n),r.className="sandbox-warning",r.style.display="block",r.style.width="100%",r.style.marginBottom="5px",r.style.color="#fff",r.style.backgroundColor="#770000",r.style.padding="8px 5px",r.style.fontFamily="Verdana",r.style.fontWeight="100",r.style.fontSize="12px",r.style.textAlign="center",r.style.boxSizing="border-box","string"==typeof e){var a=document.querySelector(e);if(!a)throw new Error("Credit card form target does not exist");e=a}e&&(t?e.insertBefore(r,t):e.insertBefore(r,e.firstChild))}window.Promise=window.Promise||C,String.prototype.repeat||(String.prototype.repeat=function(e){for(var t="",r=0;r<e;r++)t+=this;return t});var N={},A=function(e,t){return(A=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r])})(e,t)};function O(e,t){function r(){this.constructor=e}A(e,t),e.prototype=null===t?Object.create(t):(r.prototype=t.prototype,new r)}function R(e,t,r,n){return new(r||(r=Promise))((function(a,o){function i(e){try{s(n.next(e))}catch(e){o(e)}}function c(e){try{s(n.throw(e))}catch(e){o(e)}}function s(e){var t;e.done?a(e.value):(t=e.value,t instanceof r?t:new r((function(e){e(t)}))).then(i,c)}s((n=n.apply(e,t||[])).next())}))}function I(e,t){var r,n,a,o,i={label:0,sent:function(){if(1&a[0])throw a[1];return a[1]},trys:[],ops:[]};return o={next:c(0),throw:c(1),return:c(2)},"function"==typeof Symbol&&(o[Symbol.iterator]=function(){return this}),o;function c(o){return function(c){return function(o){if(r)throw new TypeError("Generator is already executing.");for(;i;)try{if(r=1,n&&(a=2&o[0]?n.return:o[0]?n.throw||((a=n.return)&&a.call(n),0):n.next)&&!(a=a.call(n,o[1])).done)return a;switch(n=0,a&&(o=[2&o[0],a.value]),o[0]){case 0:case 1:a=o;break;case 4:return i.label++,{value:o[1],done:!1};case 5:i.label++,n=o[1],o=[0];continue;case 7:o=i.ops.pop(),i.trys.pop();continue;default:if(!(a=i.trys,(a=a.length>0&&a[a.length-1])||6!==o[0]&&2!==o[0])){i=0;continue}if(3===o[0]&&(!a||o[1]>a[0]&&o[1]<a[3])){i.label=o[1];break}if(6===o[0]&&i.label<a[1]){i.label=a[1],a=o;break}if(a&&i.label<a[2]){i.label=a[2],i.ops.push(o);break}a[2]&&i.ops.pop(),i.trys.pop();continue}o=t.call(e,i)}catch(e){o=[6,e],n=0}finally{r=a=0}if(5&o[0])throw o[1];return{value:o[0]?o[1]:void 0,done:!0}}([o,c])}}}var T="2",S="1",P="https://heartlandpaymentservices.net",D="https://staging.heartlandpaymentservices.net",j={tokenization:function(e){return(e?P:D)+"/QuickPayService/QuickPayService.svc/GetToken"}},z={normalizeResponse:function(e){return e.error&&e.reasons?{error:e.error,reasons:e.reasons}:e.GetTokenResult&&e.GetTokenResult.IsSuccessful?{details:{},paymentReference:e.GetTokenResult.Token}:{error:!0,reasons:[{code:"INVALID_REQUEST",message:(e.GetTokenResult||{}).ErrorMessage||"Unexpected error"}]}},tokenize:function(e,t,r){return R(void 0,void 0,void 0,(function(){var t,n,a;return I(this,(function(o){switch(o.label){case 0:t={merchantName:N.merchantName},r["card-number"]?(t.tokenData=r["card-number"].replace(/\s/g,""),t.type=S):r["account-number"]&&(t.tokenData=r["account-number"]+"|"+r["routing-number"],t.type=T),o.label=1;case 1:return o.trys.push([1,3,,4]),n={"Content-Type":"application/json"},[4,fetch(e,{body:JSON.stringify(t),credentials:"omit",headers:"undefined"!=typeof Headers?new Headers(n):n,method:"POST"})];case 2:return[2,o.sent().json()];case 3:return[2,{error:!0,reasons:[{code:(a=o.sent()).name,message:a.message}]}];case 4:return[2]}}))}))},validateData:function(e){var t=[];return e["card-number"]||e["card-track"]||e["account-number"]||(e["card-number"]?e["account-number"]||t.push({code:"INVALID_ACCOUNT_NUMBER",message:"The account number is invalid"}):t.push({code:"INVALID_CARD_NUMBER",message:"The card number is invalid."})),e["account-number"]&&!e["routing-number"]&&t.push({code:"INVALID_ROUTING_NUMBER",message:"The routing number is invalid"}),t}},L=Object.freeze({__proto__:null,supports:{tokenization:{cardNotPresent:!0,eCheck:!0}},urls:j,actions:z,requiredSettings:["merchantName"],getEnv:function(){return N.env||"production"}}),F="https://ecommerce.merchantware.net",H="https://ecommerce.merchantware.net",U={tokenization:function(e){return(e?F:H)+"/v1/api/tokens"}},q={normalizeResponse:function(e){if(e.error&&e.reasons)return{error:e.error,reasons:e.reasons};if(e.errors){var t=[];for(var r in e.errors)if(e.errors.hasOwnProperty(r)){var n=e.errors[r],a="SERVER_REQUIRED"===n.code?"missing":"invalid",o="ERROR",i="An unknown error has occurred. Details: "+n.error_Code+" - "+n.reason;"cardnumber"===n.reason?(o="INVALID_CARD_NUMBER",i="The card number is "+a):"expirationdate"===n.reason?(o="INVALID_CARD_EXPIRATION",i="The card expiration date is "+a):"cvv"===n.reason&&(o="INVALID_CARD_SECURITY_CODE",i="The card security code is "+a),t.push({code:o,message:i})}return{error:!0,reasons:t}}return{paymentReference:e.token}},tokenize:function(e,t,r){return R(void 0,void 0,void 0,(function(){var t,n,a,o;return I(this,(function(i){switch(i.label){case 0:t={merchantApiKey:r.webApiKey},r["card-number"]&&(t.cardnumber=r["card-number"].replace(/\s/g,"")),r["card-cvv"]&&(t.cvv=r["card-cvv"]),r["card-expiration"]&&-1!==r["card-expiration"].indexOf(" / ")&&(n=r["card-expiration"].split(" / "),t.expirationmonth=n[0]||"",t.expirationyear=(n[1]||"").substr(2,2)),r["card-holder-name"]&&(t.cardholder=r["card-holder-name"]),i.label=1;case 1:return i.trys.push([1,3,,4]),a={"Content-Type":"application/json"},[4,fetch(e,{body:JSON.stringify(t),credentials:"omit",headers:"undefined"!=typeof Headers?new Headers(a):a,method:"POST"})];case 2:return[2,i.sent().json()];case 3:return[2,{error:!0,reasons:[{code:(o=i.sent()).name,message:o.message}]}];case 4:return[2]}}))}))},validateData:function(e){var t=[];return e["card-number"]||t.push({code:"INVALID_CARD_NUMBER",message:"The card number is invalid."}),e["card-cvv"]||t.push({code:"INVALID_CARD_SECURITY_CODE",message:"The card security code is invalid."}),e["card-expiration"]||t.push({code:"INVALID_CARD_EXPIRATION",message:"The card expiration is invalid."}),t}},M=Object.freeze({__proto__:null,supports:{apm:{applePay:!1,googlePay:!1},consumerAuthentication:!1,tokenization:{cardNotPresent:!0,cardPresent:!1,eCheck:!1,gift:!1}},urls:U,actions:q,requiredSettings:["webApiKey"],getEnv:function(){return N.env||"production"}}),V={},B=new(function(){function e(){}return e.prototype.post=function(e,t){if(e.source=e.source||{},e.source.name=window.name||"parent",V){var r=V[t];if(r){var n=r.frame,a=r.url;try{void 0!==r.targetNode&&(n=r.targetNode)}catch(e){}var o="parent"===t?parent:n.contentWindow||n;void 0!==o.postMessage&&o.postMessage(JSON.stringify(e),a)}}},e.prototype.receive=function(e){return new Promise((function(t){var r=function(r){try{var n=JSON.parse(r.data);e?e.call(e,n):t(n)}catch(e){}};window.addEventListener?window.addEventListener("message",r,!1):window.attachEvent("onmessage",r)}))},e}()),Y=!1,G="secure-payment-field",J=function(){var e=function(){return(65536*(1+Math.random())|0).toString(16).substring(1)};return""+e()+e()+"-"+e()+"-"+e()+"-"+e()+"-"+e()+e()+e()+")"},K=function(e){var t=btoa(J()).substring(0,22),r=new Date,n=r.getUTCMonth()+1,a=r.getUTCDate(),o=r.getUTCHours(),i=r.getUTCMinutes(),c=r.getUTCSeconds(),s=r.getUTCFullYear().toString()+(n<10?"0"+n.toString():n.toString()).toString()+(a<10?"0"+a.toString():a.toString())+(o<10?"0"+o.toString():o.toString())+(i<10?"0"+i.toString():i.toString())+(c<10?"0"+c.toString():c.toString()),d=window.location.protocol+"//"+window.location.host,u={ACCOUNT:N.account||"",AUTO_SETTLE_FLAG:"0",CARD_STORAGE_ENABLE:"1",CURRENCY:"EUR",HPP_LISTENER_URL:d,HPP_POST_DIMENSIONS:d,HPP_POST_RESPONSE:d,HPP_VERSION:"2",MERCHANT_ID:N.merchantId||"",MERCHANT_RESPONSE_URL:d,ORDER_ID:t,PAYER_EXIST:!0===N.customerExists?"1":"0",TIMESTAMP:s,VALIDATE_CARD_ONLY:!1===N.validateOnly?"0":"1"};return N.customerExists&&(u.PAYER_REF=N.customerReference),X(u).then((function(r){return $(e,r),W(t)})).then((function(){return t}))},X=function(e){var t=document.getElementById(G);return t?(B.post({data:e,id:t.getAttribute("data-id"),type:"gateway:globalpayments:hash"},"parent"),new Promise((function(e){B.receive((function(t){"gateway:globalpayments:hash-result"===t.type&&e(t.data)}))}))):Promise.reject({error:!0,reasons:[{code:"ERROR",message:"Missing field"}]})},$=function(e,t){var r,n,a=(r=t.ORDER_ID,(n=document.createElement("iframe")).setAttribute("name","global-payments-rxp-"+r),n.setAttribute("id","global-payments-rxp-"+r),n.setAttribute("height","0"),n.setAttribute("width","0"),n.style.display="none",n.style.opacity="0",n),o=document.createElement("form");for(var i in o.method="POST",o.action=e,t)if(Object.prototype.hasOwnProperty.call(t,i)){var c=document.createElement("input");c.type="hidden",c.name=i,c.value=t[i],o.appendChild(c)}if(document.body.appendChild(a),!a.contentWindow)throw new Error("Source iframe loaded incorrectly");void 0!==a.contentWindow.document.body?a.contentWindow.document.body.appendChild(o):a.contentWindow.document.appendChild(o),o.submit()},W=function(e){return new Promise((function(t,r){var n=setTimeout((function(){r({error:!0,reasons:[{code:"TIMEOUT",message:"HPP setup timeout"}]})}),3e4);B.receive((function(a){clearTimeout(n),"hpp-listener-loaded"===(a.action||"")&&(a.payload?t(e):r({error:!0,reasons:[{code:"ERROR",message:"HPP setup failure"}]}))}))}))},Q="https://pay.realexpayments.com",Z="https://pay.sandbox.realexpayments.com",ee={tokenization:function(e){return(e?Q:Z)+"/pay"}},te={normalizeResponse:function(e){if(e.error&&e.reasons)return{error:e.error,reasons:e.reasons};if(e.action){var t=[];switch(e.action){case"action-error":t.push({code:"INVALID_REQUEST",message:e.payload});break;case"hpp-api-timeout-error":t.push({code:"API_ERROR",message:e.payload});break;default:for(var r in e.payload)if(e.payload.hasOwnProperty(r)){var n=e.payload[r],a="";switch(n.errorCode){case"INVALID_CARDNUMBER":a="INVALID_CARD_NUMBER";break;case"INVALID_EXPIRY_DATE":a="INVALID_CARD_EXPIRATION";break;case"INVALID_SECURITY_CODE":a="INVALID_CARD_SECURITY_CODE";break;case"INVALID_CARDHOLDER_NAME":a="INVALID_CARD_HOLDER_NAME"}t.push({code:a,message:n.errorMessage})}}return{error:!0,reasons:t}}return{customerReference:atob(e.SAVED_PAYER_REF),details:{cardholderName:atob(e.SAVED_PMT_NAME),orderId:atob(e.ORDER_ID)},paymentReference:atob(e.SAVED_PMT_REF),requestId:atob(e.PASREF)}},setup:function(){return R(void 0,void 0,void 0,(function(){return I(this,(function(e){return Y||(Y=!0,B.receive((function(e){return R(void 0,void 0,void 0,(function(){var t;return I(this,(function(r){switch(r.label){case 0:return"gateway:globalpayments:hash"===e.type&&N.hash?[4,N.hash(e.data)]:[3,2];case 1:t=r.sent(),B.post({data:t,id:e.id,type:"gateway:globalpayments:hash-result"},e.id),r.label=2;case 2:return[2]}}))}))}))),[2]}))}))},tokenize:function(e,t,r){return R(void 0,void 0,void 0,(function(){var t,n,a,o,i,c,s,d;return I(this,(function(u){switch(u.label){case 0:return u.trys.push([0,2,,3]),[4,K(e)];case 1:return t=u.sent(),[3,3];case 2:return n=u.sent(),[2,Promise.reject(n)];case 3:return(a=document.getElementById("global-payments-rxp-"+t))?(o=a.contentWindow)?(i="",c="",r["card-expiration"]&&-1!==r["card-expiration"].indexOf(" / ")&&(s=r["card-expiration"].split(" / "),i=s[0]||"",c=(s[1]||"").substr(2,2)),d={action:"populate-form-fields",payload:{pas_cccvc:r["card-cvv"],pas_ccmonth:i,pas_ccname:r["card-holder-name"],pas_ccnum:r["card-number"].replace(/\s/g,""),pas_ccyear:c}},o.postMessage(JSON.stringify(d),"*"),[2,new Promise((function(e){B.receive((function(r){(void 0!==r.action||void 0!==r.SHA1HASH&&r.ORDER_ID===btoa(t))&&e(r)}))}))]):[2,Promise.reject("Source iframe loaded incorrectly")]:[2,Promise.reject("Source iframe missing")]}}))}))},validateData:function(e){var t=[];return e["card-number"]||t.push({code:"INVALID_CARD_NUMBER",message:"The card number is invalid."}),e["card-cvv"]||t.push({code:"INVALID_CARD_SECURITY_CODE",message:"The card security code is invalid."}),e["card-expiration"]||t.push({code:"INVALID_CARD_EXPIRATION",message:"The card expiration is invalid."}),e["card-holder-name"]||t.push({code:"INVALID_CARD_HOLDER_NAME",message:"The card holder name is invalid."}),t}},re="https://api.heartlandportico.com",ne="https://cert.api2.heartlandportico.com",ae={tokenization:function(e){return e?re+"/SecureSubmit.v1/api/token":ne+"/Hps.Exchange.PosGateway.Hpf.v1/api/token"}},oe={normalizeResponse:function(e){if(e.error&&e.reasons)return{error:e.error,reasons:e.reasons};if(e.error){var t=[];switch(e.error.param){case"card.number":t.push({code:"INVALID_CARD_NUMBER",message:e.error.message});break;case"card.exp_month":case"card.exp_year":t.push({code:"INVALID_CARD_EXPIRATION_DATE",message:e.error.message})}return{error:!0,reasons:t}}var r={details:{},paymentReference:e.token_value};return e.card&&e.card.number&&(r.details.cardNumber=e.card.number),e.is_fsahsa&&(r.details.isHsaFsa="Y"===e.is_fsahsa),e.surcharge_allowed&&(r.details.canSurcharge="Y"===e.surcharge_allowed),r},tokenize:function(e,t,r){return R(void 0,void 0,void 0,(function(){var t,n,a,o;return I(this,(function(i){switch(i.label){case 0:t={object:"token",token_type:"supt"},r["card-number"]&&(t.card=t.card||{},t.card.number=r["card-number"].replace(/\s/g,"")),r["card-cvv"]&&(t.card=t.card||{},t.card.cvc=r["card-cvv"]),r["card-expiration"]&&-1!==r["card-expiration"].indexOf(" / ")&&(n=r["card-expiration"].split(" / "),t.card=t.card||{},t.card.exp_month=n[0]||"",t.card.exp_year=n[1]||""),r["card-track"]&&(t.card=t.card||{},t.card.track_method="swipe",t.card.track=r["card-track"]),r["account-number"]&&(t.ach=t.ach||{},t.ach.account_number=r["account-number"]),r["routing-number"]&&(t.ach=t.ach||{},t.ach.routing_number=r["routing-number"]),r["bin-check-hsafsa"]&&(t.fsahsa_req="Y"),r["bin-check-surcharge"]&&(t.surchargeable_req="Y"),i.label=1;case 1:return i.trys.push([1,3,,4]),a={"Content-Type":"application/json"},[4,fetch(e,{body:JSON.stringify(t),credentials:"omit",headers:"undefined"!=typeof Headers?new Headers(a):a,method:"POST"})];case 2:return[2,i.sent().json()];case 3:return[2,{error:!0,reasons:[{code:(o=i.sent()).name,message:o.message}]}];case 4:return[2]}}))}))},validateData:function(e){var t=[];return e["card-number"]||e["card-track"]||e["account-number"]||(e["card-number"]?e["account-number"]||t.push({code:"INVALID_ACCOUNT_NUMBER",message:"The account number is invalid"}):t.push({code:"INVALID_CARD_NUMBER",message:"The card number is invalid."})),e["account-number"]&&!e["routing-number"]&&t.push({code:"INVALID_ROUTING_NUMBER",message:"The routing number is invalid"}),t}},ie="1.7.0",ce=function(){return N["X-GP-Environment"]||"local"},se={local:"https://api-sandbox.dev.paygateway.com",dev:"https://api.dev.paygateway.com",pqa:"https://api.dev.paygateway.com",qa:"https://api.qa.paygateway.com",test:"https://api.pit.paygateway.com",prod:"https://api.paygateway.com"},de={assetBaseUrl:function(e){var t=ie.split(".")[0]||ie[0];switch(ce()){case"local":return"http://localhost:8080/v"+t+"/";case"dev":return"https://js.dev.paygateway.com/secure_payment/v"+t+"/";case"pqa":return"https://js.pqa.paygateway.com/secure_payment/v"+t+"/";case"qa":return"https://js.qa.paygateway.com/secure_payment/v"+t+"/";case"test":return"https://js.test.paygateway.com/secure_payment/v"+t+"/";case"prod":return"https://js.paygateway.com/secure_payment/v"+t+"/";case"GP":default:return e}},tokenization:function(e){return se[ce()]+"/tokenization/temporary_tokens"}},ue={normalizeResponse:function(e){return e},tokenize:function(e,t,r){return R(void 0,void 0,void 0,(function(){var n,a,o,i,c;return I(this,(function(s){switch(s.label){case 0:n={},r["card-number"]&&(n.card=n.card||{},n.card.card_number=r["card-number"].replace(/\s+/g,"")),r["card-cvv"]&&(n.card=n.card||{},n.card.card_security_code=r["card-cvv"]),r["card-expiration"]&&-1!==r["card-expiration"].indexOf(" / ")&&(a=r["card-expiration"].split(" / "),n.card=n.card||{},n.card.expiry_month=a[0]||"",n.card.expiry_year=a[1].slice(-2)||""),r["card-track"]&&(n.card=n.card||{},n.card.track_method="swipe",n.card.track=r["card-track"]),r["account-number"]&&(n.ach=n.ach||{},n.ach.account_number=r["account-number"]),r["routing-number"]&&(n.ach=n.ach||{},n.ach.routing_number=r["routing-number"]),s.label=1;case 1:return s.trys.push([1,3,,4]),o="local"!==t?t:"dev",i={"Content-Type":"application/json","X-GP-Api-Key":N["X-GP-Api-Key"],"X-GP-Environment":""+o,"X-GP-Request-Id":"PFC-"+"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,(function(e){var t=Math.floor(16*Math.random());return("x"===e?t:3&t|8).toString(16)})),"X-GP-Version":"2019-08-22"},[4,fetch(e,{body:JSON.stringify(n),credentials:"omit",headers:"undefined"!=typeof Headers?new Headers(i):i,method:"POST"})];case 2:return[2,s.sent().json()];case 3:return[2,{error:!0,reasons:[{code:(c=s.sent()).name,message:c.message}]}];case 4:return[2]}}))}))},validateData:function(e){var t=[],r=e["card-number"].replace(/\s+/g,"");return(r.length<13||r.length>19)&&t.push({code:"invalid_input",detail:[{data_path:"/card/card_number",description:"Invalid data"}],message:"Invalid input data."}),t}},le="https://gateway.transit-pass.com",pe="https://stagegw.transnox.com",fe={tokenization:function(e){return N.tsepHost=e?le:pe,N.tsepHost+"/transit-tsep-web/jsView/"+N.deviceId+"?"+N.manifest}},me={normalizeResponse:function(e){return e.error&&e.reasons?{error:e.error,reasons:e.reasons}:-1!==["FAIL","FAILURE"].indexOf(e.status)?{error:!0,reasons:[{code:"ERROR",message:e.responseCode+": "+e.message}]}:{paymentReference:e.tsepToken,requestId:e.transactionId}},tokenize:function(e,t,r){return new Promise((function(t,n){var a="tsep-entry-script",o="tsep-cardNumDiv",i=setTimeout((function(){n({error:!0,reasons:[{code:"TIMEOUT",message:"TransIT setup timeout"}]})}),3e4),c=function(){clearTimeout(i),[o,a].forEach((function(e){var t=document.getElementById(e);t&&t.parentNode&&t.parentNode.removeChild(t)}))};try{window.tsepHandler=function(e,t){"ErrorEvent"===e&&(c(),n({error:!0,reasons:[{code:"ERROR",message:t.responseCode+": "+t.message}]}))};var s=document.createElement("div");s.hidden=!0,s.style.display="none",s.id=o,document.body.appendChild(s);var d=document.createElement("script");d.id=a,d.src=e,d.defer=!0,d.onload=function(e){window.onload&&window.onload(e)},document.body.appendChild(d);var u=setInterval((function(){if(document.getElementById(o.substr(0,o.length-3))&&window.cryptTsep){clearInterval(u);var e,a={"Content-Type":"application/json"};fetch(N.tsepHost+"/transit-tsep-web/generateTsepToken",{body:JSON.stringify((e={cvv2:r["card-cvv"],deviceID:window.getDeviceId(),manifest:window.getManifest(),uniqueKeyIdentifier:window.getKeyId()},r["card-number"]&&(e.encCardNumber=window.encryptTsepCard(r["card-number"].replace(/\s/g,""))),r["card-expiration"]&&-1!==r["card-expiration"].indexOf(" / ")&&(e.expirationDate=r["card-expiration"].replace(" / ","/")),e)),credentials:"omit",headers:"undefined"!=typeof Headers?new Headers(a):a,method:"POST"}).then((function(e){c(),t(e.json())})).catch((function(e){c(),n(e)}))}}),100)}catch(e){return n({error:!0,reasons:[{code:e.name,message:e.message}]})}}))},validateData:function(e){var t=[];return e["card-number"]||t.push({code:"INVALID_CARD_NUMBER",message:"The card number is invalid."}),e["card-cvv"]||t.push({code:"INVALID_CARD_SECURITY_CODE",message:"The card security code is invalid."}),e["card-expiration"]||t.push({code:"INVALID_CARD_EXPIRATION",message:"The card expiration is invalid."}),t}},he={billpay:L,genius:M,globalpayments:Object.freeze({__proto__:null,supports:{apm:{applePay:!0,googlePay:!1},consumerAuthentication:!0,tokenization:{cardNotPresent:!0,cardPresent:!1,eCheck:!1,gift:!1}},urls:ee,getEnv:function(){return N.env||"production"},actions:te,requiredSettings:["merchantId","account","env"]}),heartland:Object.freeze({__proto__:null,supports:{apm:{applePay:!0,googlePay:!1},binCheck:{hsaFsa:!0,surcharge:!0},consumerAuthentication:!0,tokenization:{cardNotPresent:!0,cardPresent:!0,eCheck:!0,gift:!0}},urls:ae,actions:oe,requiredSettings:["publicApiKey"],getEnv:function(){var e=N.publicApiKey||"",t="production";if(N.env&&"local"===N.env)return N.env;if(!e)return t;var r=e.split("_");if(!r[1])return t;switch(r[1]){case"cert":return"sandbox";case"prod":default:return t}}}),openedge:Object.freeze({__proto__:null,supports:{apm:{applePay:!0,googlePay:!1},consumerAuthentication:!0,tokenization:{cardNotPresent:!0,cardPresent:!0,eCheck:!0,gift:!0}},urls:de,actions:ue,requiredSettings:["X-GP-Api-Key","X-GP-Environment"],getEnv:ce}),transit:Object.freeze({__proto__:null,supports:{apm:{applePay:!1,googlePay:!1},consumerAuthentication:!1,tokenization:{cardNotPresent:!0,cardPresent:!1,eCheck:!1,gift:!1}},urls:fe,actions:me,requiredSettings:["deviceId","manifest"],getEnv:function(){return N.env||"production"}})},ve=function(e){for(var t=e.length,r=0,n=0;n<t;n++){var a=e[n];N.hasOwnProperty(a)&&void 0!==N[a]&&r++}return r===t},ge=function(){for(var e in he)if(he.hasOwnProperty(e)){var t=he[e];if(ve(t.requiredSettings))return t}};function ye(e,t){var r={};for(var n in e||(e={}),e)e.hasOwnProperty(n)&&(r[n]=e[n]);for(var n in t)t.hasOwnProperty(n)&&(r[n]=t[n]);return r}function be(e,t){var r=document.createElement("style"),n=document.getElementsByTagName("head");if(t){if(document.getElementById(t))return;r.id=t}r.type="text/css",r.styleSheet?r.styleSheet.cssText=e:r.appendChild(document.createTextNode(e)),n&&n[0]&&n[0].appendChild(r)}function xe(e){var t,r,n,a,o="",i=function(e){var t=[];for(var r in e)e.hasOwnProperty(r)&&("string"==typeof e[r]||we(e[r]))&&t.push(r);return t}(e),c=function(e){var t=[];for(var r in e)e.hasOwnProperty(r)&&"string"!=typeof e[r]&&!we(e[r])&&t.push(r);return t}(e);if(i){var s=i.length;for(t=0;t<s;t++)if(we(a=e[n=i[t]])){var d=a.length;for(r=0;r<d;r++)o+=n+":"+a[r]+";"}else o+=n+":"+a+";"}if(c){var u=c.length;for(t=0;t<u;t++)o+=(n=c[t])+"{"+xe(a=e[n])+"}"}return o}function we(e){return"[object Array]"===Object.prototype.toString.call(e)}var ke,Ee=function(){var e="https://api2.heartlandportico.com/SecureSubmit.v1/token/gp-1.7.0/",t=ge();if(!t)return e;if(t.urls.assetBaseUrl)return t.urls.assetBaseUrl(e);switch(t.getEnv(N)){case"local":e="http://localhost:7777/dist/";break;case"sandbox":e="https://hps.github.io/token/gp-1.7.0/"}return e},Ce=Ee()+"images/",_e={"#secure-payment-field":{"-o-transition":"border-color ease-in-out .15s,box-shadow ease-in-out .15s","-webkit-box-shadow":"inset 0 1px 1px rgba(0,0,0,.075)","-webkit-transition":"border-color ease-in-out .15s,-webkit-box-shadow ease-in-out .15s","background-color":"#fff",border:"1px solid #ccc","border-radius":"0px","box-shadow":"inset 0 1px 1px rgba(0,0,0,.075)","box-sizing":"border-box",color:"#555",display:"block","font-family":"sans-serif","font-size":"14px",height:"50px","line-height":"1.42857143",margin:"0 .5em 0 0","max-width":"100%",outline:"0",padding:"6px 12px",transition:"border-color ease-in-out .15s,box-shadow ease-in-out .15s","vertical-align":"baseline",width:"100% "},"#secure-payment-field:focus":{border:"1px solid #3989e3","box-shadow":"none",height:"50px",outline:"none"},"#secure-payment-field[type=button]":{"-moz-user-select":"none","-ms-touch-action":"manipulation","-ms-user-select":"none","-webkit-user-select":"none","background-color":"#36b46e","background-image":"none",border:"0px solid transparent","box-sizing":"border-box",color:"#fff",cursor:"pointer",display:"inline-block","font-family":"sans-serif","font-size":"14px","font-weight":"400","line-height":"1.42857143","margin-bottom":"0",padding:"6px 12px","text-align":"center","text-transform":"uppercase","touch-action":"manipulation","user-select":"none","vertical-align":"middle","white-space":"nowrap"},"#secure-payment-field[type=button]:focus":{"background-color":"#258851",color:"#ffffff",outline:"none"},"#secure-payment-field[type=button]:hover":{"background-color":"#258851"},".card-cvv":{background:"transparent url("+Ce+"cvv.png) no-repeat right","background-size":"63px 40px"},".card-cvv.card-type-amex":{background:"transparent url("+Ce+"cvv-amex.png) no-repeat right","background-size":"63px 40px"},".card-number":{background:"transparent url("+Ce+"logo-unknown@2x.png) no-repeat right","background-size":"55px 35px"},".card-number.invalid.card-type-amex":{background:"transparent url("+Ce+"logo-amex@2x.png) no-repeat right","background-position-y":"-44px","background-size":"50px 90px"},".card-number.invalid.card-type-discover":{background:"transparent url("+Ce+"logo-discover@2x.png) no-repeat right","background-position-y":"-44px","background-size":"85px 90px"},".card-number.invalid.card-type-jcb":{background:"transparent url("+Ce+"logo-jcb@2x.png) no-repeat right","background-position-y":"-44px","background-size":"55px 94px"},".card-number.invalid.card-type-mastercard":{background:"transparent url("+Ce+"logo-mastercard@2x.png) no-repeat right","background-position-y":"-52px","background-size":"62px 105px"},".card-number.invalid.card-type-visa":{background:"transparent url("+Ce+"logo-visa@2x.png) no-repeat right","background-position-y":"-44px","background-size":"83px 88px"},".card-number.valid.card-type-amex":{background:"transparent url("+Ce+"logo-amex@2x.png) no-repeat right top","background-size":"50px 90px"},".card-number.valid.card-type-discover":{background:"transparent url("+Ce+"logo-discover@2x.png) no-repeat right","background-position-y":"1px","background-size":"85px 90px"},".card-number.valid.card-type-jcb":{background:"transparent url("+Ce+"logo-jcb@2x.png) no-repeat right top","background-position-y":"2px","background-size":"55px 94px"},".card-number.valid.card-type-mastercard":{background:"transparent url("+Ce+"logo-mastercard@2x.png) no-repeat right","background-position-y":"-1px","background-size":"62px 105px"},".card-number.valid.card-type-visa":{background:"transparent url("+Ce+"logo-visa@2x.png) no-repeat right top","background-size":"82px 86px"},".card-number::-ms-clear":{display:"none"},"input[placeholder]":{"letter-spacing":"3px"}},Ne={".secure-payment-form":{"font-family":"sans-serif"},".secure-payment-form label":{color:"#555","font-size":"13px","font-weight":"bold","line-height":"1.5","text-transform":"uppercase"},".secure-payment-form #ss-banner":{background:"transparent url("+Ce+"shield-and-logos@2x.png) no-repeat left center","background-size":"280px 34px",height:"40px","margin-bottom":"7px"},".secure-payment-form div":{display:"block"},".secure-payment-form iframe":{width:"300px"},".secure-payment-form .form-row":{"margin-top":"10px"},".secure-payment-form .form-wrapper":{display:"block",margin:"10px auto",width:"300px"}},Ae=Ee()+"images",Oe={html:{"font-size":"62.5%"},body:{"font-size":"1.4rem"},"#secure-payment-field-wrapper":{postition:"relative"},"#secure-payment-field":{"-o-transition":"border-color ease-in-out .15s,box-shadow ease-in-out .15s","-webkit-box-shadow":"inset 0 1px 1px rgba(0,0,0,.075)","-webkit-transition":"border-color ease-in-out .15s,-webkit-box-shadow ease-in-out .15s","background-color":"#fff",border:"1px solid #cecece","border-radius":"2px","box-shadow":"none","box-sizing":"border-box",display:"block","font-family":"Roboto, sans-serif","font-size":"11px","font-smoothing":"antialiased",height:"35px",margin:"5px 0 10px 0","max-width":"100%",outline:"0",padding:"0 10px",transition:"border-color ease-in-out .15s,box-shadow ease-in-out .15s","vertical-align":"baseline",width:"100%"},"#secure-payment-field:focus":{border:"1px solid lightblue","box-shadow":"0 1px 3px 0 #cecece",outline:"none"},"#secure-payment-field[type=button]":{"text-align":"center","text-transform":"none","white-space":"nowrap"},"#secure-payment-field[type=button]:focus":{outline:"none"},".card-cvv":{background:"transparent url("+Ae+"/cvv.png) no-repeat right","background-size":"60px"},".card-cvv.card-type-amex":{background:"transparent url("+Ae+"/cvv-amex.png) no-repeat right","background-size":"60px"},".card-number":{background:"transparent url("+Ae+"/logo-unknown@2x.png) no-repeat right","background-size":"52px"},".card-number.invalid.card-type-amex":{background:"transparent url("+Ae+"/amex-invalid.svg) no-repeat right center","background-position-x":"98%","background-size":"38px"},".card-number.invalid.card-type-discover":{background:"transparent url("+Ae+"/discover-invalid.svg) no-repeat right center","background-position-x":"98%","background-size":"60px"},".card-number.invalid.card-type-jcb":{background:"transparent url("+Ae+"/jcb-invalid.svg) no-repeat right center","background-position-x":"98%","background-size":"38px"},".card-number.invalid.card-type-mastercard":{background:"transparent url("+Ae+"/mastercard-invalid.svg) no-repeat right center","background-position-x":"98%","background-size":"40px"},".card-number.invalid.card-type-visa":{background:"transparent url("+Ae+"/visa-invalid.svg) no-repeat center","background-position-x":"98%","background-size":"50px"},".card-number.valid.card-type-amex":{background:"transparent url("+Ae+"/amex.svg) no-repeat right center","background-position-x":"98%","background-size":"38px"},".card-number.valid.card-type-discover":{background:"transparent url("+Ae+"/discover.svg) no-repeat right center","background-position-x":"98%","background-size":"60px"},".card-number.valid.card-type-jcb":{background:"transparent url("+Ae+"/jcb.svg) no-repeat right center","background-position-x":"98%","background-size":"38px"},".card-number.valid.card-type-mastercard":{background:"transparent url("+Ae+"/mastercard.svg) no-repeat center","background-position-x":"98%","background-size":"40px"},".card-number.valid.card-type-visa":{background:"transparent url("+Ae+"/visa.svg) no-repeat right center","background-position-x":"98%","background-size":"50px"},".card-number::-ms-clear":{display:"none"},"input[placeholder]":{"letter-spacing":".5px"}},Re={".secure-payment-form":{"font-family":"sans-serif",width:"300px"},".secure-payment-form label":{color:"#555","font-size":"13px","font-weight":"bold","line-height":"1.5","text-transform":"uppercase"},".secure-payment-form #ss-banner":{background:"transparent url("+Ae+"/shield-and-logos@2x.png) no-repeat left center","background-size":"280px 34px",height:"40px","margin-bottom":"7px"},".secure-payment-form div":{display:"block"},".secure-payment-form iframe":{"min-height":"3.6rem"},".secure-payment-form .form-row":{"margin-top":"10px"},".secure-payment-form .form-wrapper":{display:"block",margin:"10px auto"},".secure-payment-form input":Oe["#secure-payment-field"],".secure-payment-form input:focus":Oe["#secure-payment-field:focus"]};ke="function"==typeof Array.prototype.indexOf?function(e,t){return e.indexOf(t)}:function(e,t){for(var r=e.length,n=0,a=-1,o=!1;n<r&&!o;)e[n]===t&&(a=n,o=!0),n++;return a};var Ie=function(){function e(){this.events={}}return e.prototype.on=function(e,t){"object"!=typeof this.events[e]&&(this.events[e]=[]),this.events[e].push(t)},e.prototype.off=function(e,t){var r;"object"==typeof this.events[e]&&(r=ke(this.events[e],t))>-1&&this.events[e].splice(r,1)},e.prototype.emit=function(e){for(var t,r,n,a=[],o=1;o<arguments.length;o++)a[o-1]=arguments[o];if("object"==typeof this.events[e])for(n=(r=this.events[e].slice()).length,t=0;t<n;t++)r[t].apply(this,a)},e.prototype.once=function(e,t){var r=this;this.on(e,(function n(){r.off(e,n),t.apply(r,arguments)}))},e}();function Te(e){var t;if(e&&!(e.replace(/^\s+|\s+$/gm,"").length<4)){for(var r in Se)if(Se.hasOwnProperty(r)&&(t=Se[r])&&t.regex&&t.regex.test(e))break;return t}}var Se=[{code:"visa",format:/(\d{1,4})/g,lengths:[16,18,19],regex:/^4/},{code:"mastercard",format:/(\d{1,4})/g,lengths:[16],regex:/^(5[1-5]|2[2-7])/},{code:"amex",format:/(\d{1,4})(\d{1,6})?(\d{1,5})?/,lengths:[15],regex:/^3[47]/},{code:"diners",format:/(\d{1,4})(\d{1,6})?(\d{1,4})?/,lengths:[14,16,19],regex:/^3[0689]/},{code:"discover",format:/(\d{1,4})/g,lengths:[16,19],regex:/^6([045]|22)/},{code:"jcb",format:/(\d{1,4})/g,lengths:[16,17,18,19],regex:/^35/},{code:"unknown",format:/(\d{1,4})/g,lengths:[19],regex:/^[0-9]/}],Pe=function(e){var t=ge();if(!t)return Promise.reject({error:!0,reasons:[{code:"INVALID_CONFIGURATION",message:"no gateway available"}]});var r=t.actions.validateData(e);return r.length>0?Promise.reject({error:!0,reasons:r}):(N.webApiKey&&(e.webApiKey=N.webApiKey),t.supports.binCheck&&t.supports.binCheck.hsaFsa&&N.binCheck&&N.binCheck.hsaFsa&&(e["bin-check-hsafsa"]=!0),t.supports.binCheck&&t.supports.binCheck.surcharge&&N.binCheck&&N.binCheck.surcharge&&(e["bin-check-surcharge"]=!0),new Promise((function(r,n){var a;-1!==t.requiredSettings.indexOf("publicApiKey")&&(a={api_key:N.publicApiKey}),t.actions.tokenize(function(e){var t=ge();if(!t)return"";var r=t.urls.tokenization("production"===t.getEnv(N));if(!e)return r;var n="?";for(var a in e)e.hasOwnProperty(a)&&e[a]&&(n+=a+"="+encodeURIComponent(e[a])+"&");return r+n}(a),N.env||"",e).then(t.actions.normalizeResponse).then((function(a){if(a.error)n(a);else if(a=a,-1===t.requiredSettings.indexOf("X-GP-Api-Key")){if(e["card-number"]){var o=e["card-number"].replace(/\D/g,""),i=o.substr(0,6),c=o.substr(-4),s=Te(o);a.details=a.details||{},a.details.cardNumber=i+"*".repeat(o.length-10)+c,a.details.cardBin=i,a.details.cardLast4=c,a.details.cardType=s?s.code:"unknown",a.details.cardSecurityCode=!!e["card-cvv"]}if(e["card-expiration"]&&-1!==e["card-expiration"].indexOf(" / ")){var d=e["card-expiration"].split(" / ");a.details=a.details||{},a.details.expiryMonth=d[0]||"",a.details.expiryYear=d[1]||""}if(e["card-holder-name"]&&(a.details=a.details||{},a.details.cardholderName=a.details.cardholderName||e["card-holder-name"]),e["card-track"]){s=function(e,t,r){void 0===t&&(t=!1);var n="";if(t&&r&&"02"===r)n=e.split("=")[0];else{var a=e.split("%");a[1]&&(a=a[1].split("^"))[0]&&(n=a[0].toString().substr(1))}return Te(n)}(e["card-track"]);a.details=a.details||{},a.details.cardType=s?s.code:"unknown"}if(e["account-number"]){var u=e["account-number"].replace(/\D/g,"");c=u.substr(-4);a.details=a.details||{},a.details.accountNumber="*".repeat(u.length-4)+c,a.details.accountLast4=c}r(a)}else r(a)})).catch(n)})))},De=new Ie,je=Object.freeze({__proto__:null,bus:De,tokenize:Pe,loadedFrames:V,options:N,postMessage:B}),ze=function(){function e(){}return e.prototype.format=function(e){var t=Te(e=e.replace(/\D/g,""));if(!t)return e;var r=e.match(t.format);return r?(t.format.global||r.shift(),r.join(" ").replace(/^\s+|\s+$/gm,"")):e},e}(),Le=function(){function e(){}return e.prototype.format=function(e,t){void 0===t&&(t=!1);var r,n,a,o=e.match(/^\D*(\d{1,2})(\D+)?(\d{1,4})?/);return o?(r=o[1]||"",n=o[2]||"",((a=o[3]||"").length>0||2===r.length||n.length>0||1===r.length&&"0"!==r&&"1"!==r)&&(n=" / "),1===r.length&&""!==n&&(r="0"+r),t&&2===a.length&&(a=(new Date).getFullYear().toString().slice(0,2)+a),r+n+a):""},e}(),Fe=function(){function e(){}return e.prototype.validate=function(e){if(!e)return!1;var t=Te(e=e.replace(/[-\s]/g,""));return!!t&&(function(e){var t,r=!0,n=0,a=0;if(!e)return!1;for(var o=e.split("").reverse(),i=o.length;n<i;n++)t=parseInt(o[n],10),(r=!r)&&(t*=2),t>9&&(t-=9),a+=t;return a%10==0}(e)&&-1!==t.lengths.indexOf(e.length))},e}(),He=function(){function e(){}return e.prototype.validate=function(e,t){return!!e&&(e=e.replace(/^\s+|\s+$/g,""),!!/^\d+$/.test(e)&&(void 0!==t&&!0===t?4===e.length:void 0!==t&&!1===t?3===e.length:3<=e.length&&e.length<=4))},e}(),Ue=function(){function e(){}return e.prototype.validate=function(e){var t,r;if(!e)return!1;var n=e.split("/");if(t=n[0],r=n[1],!t||!r)return!1;if(t=t.replace(/^\s+|\s+$/g,""),r=r.replace(/^\s+|\s+$/g,""),!/^\d+$/.test(t))return!1;if(!/^\d+$/.test(r))return!1;2===r.length&&(r=(new Date).getFullYear().toString().slice(0,2)+r);var a=parseInt(t,10),o=parseInt(r,10);return 1<=a&&a<=12&&new Date(o,a,1)>new Date},e}(),qe=function(){function e(){}return e.listen=function(e,t,r){void 0!==document.addEventListener?e.addEventListener(t,r,!1):e===document?document.documentElement.attachEvent("onpropertychange",(function(e){e.propertyName===t&&r(e)})):e.attachEvent("on"+t,r)},e.trigger=function(e,t){if(void 0!==document.createEvent){var r=document.createEvent("Event");r.initEvent(t,!0,!0),e.dispatchEvent(r)}else document.documentElement[t]++},e.ignore=function(e,t){void 0!==document.removeEventListener?document.removeEventListener(e,t,!1):document.documentElement.detachEvent("onpropertychange",(function(r){r.propertyName===e&&t(r)}))},e}(),Me=function(){function e(){}return e.addHandler=function(e,t,r){var n;(n="string"==typeof e?document.getElementById(e):e)&&(void 0!==document.addEventListener?n.addEventListener(t,r,!1):qe.listen(n,t,r))},e.removeHandler=function(e,t,r){var n;(n="string"==typeof e?document.getElementById(e):e)&&(void 0!==document.removeEventListener?n.removeEventListener(t,r,!1):qe.ignore(t,r))},e.trigger=function(e,t){if(document.createEvent){var r=document.createEvent("Event");r.initEvent(e,!0,!0),t.dispatchEvent(r)}else qe.trigger(t,e)},e}(),Ve=function(){function e(){}return e.addType=function(e){for(var t=e.currentTarget?e.currentTarget:e.srcElement,r=Te(t.value),n=t.className.split(" "),a=n.length,o=0,i="";o<a;o++)(i=n[o])&&-1!==i.indexOf("card-type-")&&delete n[o];if(r){n.push("card-type-"+r.code);var c=t.getAttribute("data-id");c&&B.post({data:{cardType:r.code},id:c,type:"ui:iframe-field:card-type"},"parent")}t.className=n.join(" ").replace(/^\s+|\s+$/gm,"")},e.formatNumber=function(e){var t=e.currentTarget?e.currentTarget:e.srcElement,r=t.value;if(0!==r.length){var n=(new ze).format(r);if(t.value=n,t.setSelectionRange){var a=t.selectionStart||0;r.length<n.length&&(a+=n.length-r.length)," "===r.charAt(a)&&" "===n.charAt(a-1)&&(a+=1),t.setSelectionRange(a,a)}}},e.formatExpiration=function(e){var t=e.currentTarget?e.currentTarget:e.srcElement,r=t.value;-1!==[46,8].indexOf(e.keyCode)||e.keyCode>=35&&e.keyCode<=39||(t.value=(new Le).format(r,"blur"===e.type))},e.restrictLength=function(e){return function(t){var r=(t.currentTarget?t.currentTarget:t.srcElement).value;-1!==[46,8,9,27,13,110].indexOf(t.keyCode)||65===t.keyCode&&!0===t.ctrlKey||t.keyCode>=35&&t.keyCode<=39||r.length>=e&&(t.preventDefault?t.preventDefault():t.returnValue=!1)}},e.restrictCardNumberLength=function(e){var t=(e.currentTarget?e.currentTarget:e.srcElement).value,r=Te(t);if(!(-1!==[46,8,9,27,13,110].indexOf(e.keyCode)||65===e.keyCode&&!0===e.ctrlKey||e.keyCode>=35&&e.keyCode<=39)){t.replace(/\D/g,"").length>=(r?r.lengths.reduce((function(e,t){return Math.max(e,t)})):19)&&(e.preventDefault?e.preventDefault():e.returnValue=!1)}},e.restrictNumeric=function(e){-1!==[46,8,9,27,13,110].indexOf(e.keyCode)||65===e.keyCode&&!0===e.ctrlKey||e.keyCode>=35&&e.keyCode<=39||229===e.keyCode||(e.shiftKey||e.keyCode<48||e.keyCode>57)&&(e.keyCode<96||e.keyCode>105)&&(e.preventDefault?e.preventDefault():e.returnValue=!1)},e.deleteProperly=function(e){var t=e.currentTarget?e.currentTarget:e.srcElement,r=t.value;if(t.setSelectionRange){var n=t.selectionStart||0;-1!==[46,8].indexOf(e.keyCode)&&" "===r.charAt(n-1)&&t.setSelectionRange(n-1,n-1)}},e.validateNumber=function(e){for(var t=e.currentTarget?e.currentTarget:e.srcElement,r=t.value.replace(/[-\s]/g,""),n=Te(r),a=t.className.split(" "),o=a.length,i=0;i<o;i++)-1!==a[i].indexOf("valid")&&delete a[i];if((new Fe).validate(r)){a.push("valid"),(c=t.getAttribute("data-id"))&&B.post({data:{valid:!0},id:c,type:"ui:iframe-field:card-number-test"},"parent")}else{var c;n&&r.length<n.lengths.reduce((function(e,t){return Math.max(e,t)}))&&a.push("possibly-valid"),a.push("invalid"),(c=t.getAttribute("data-id"))&&B.post({data:{valid:!1},id:c,type:"ui:iframe-field:card-number-test"},"parent")}t.className=a.join(" ").replace(/^\s+|\s+$/gm,"")},e.validateCvv=function(e){for(var t=e.currentTarget?e.currentTarget:e.srcElement,r=t.value,n=t.className.split(" "),a=n.length,o="",i="unknown",c=0;c<a;c++)-1!==(o=n[c]).indexOf("valid")&&delete n[c],-1!==o.indexOf("card-type-")&&(i=o.replace("card-type-",""));var s,d="amex"===i,u=d?4:3;(r.length<u&&n.push("possibly-valid"),(new He).validate(r,"unknown"===i?void 0:d))?(n.push("valid"),(s=t.getAttribute("data-id"))&&B.post({data:{valid:!0},id:s,type:"ui:iframe-field:card-cvv-test"},"parent")):(n.push("invalid"),(s=t.getAttribute("data-id"))&&B.post({data:{valid:!1},id:s,type:"ui:iframe-field:card-cvv-test"},"parent"));t.className=n.join(" ").replace(/^\s+|\s+$/gm,"")},e.validateExpiration=function(e){for(var t=e.currentTarget?e.currentTarget:e.srcElement,r=t.value,n=t.className.split(" "),a=n.length,o=0;o<a;o++)-1!==n[o].indexOf("valid")&&delete n[o];var i,c=r.split(" / "),s=c[0],d=c[1];((!s||!d||s.length<2||d.length<4)&&n.push("possibly-valid"),(new Ue).validate(r))?(n.push("valid"),(i=t.getAttribute("data-id"))&&B.post({data:{valid:!0},id:i,type:"ui:iframe-field:card-expiration-test"},"parent")):(n.push("invalid"),(i=t.getAttribute("data-id"))&&B.post({data:{valid:!1},id:i,type:"ui:iframe-field:card-expiration-test"},"parent"));t.className=n.join(" ").replace(/^\s+|\s+$/gm,"")},e.attachNumberEvents=function(t){var r=document.querySelector(t);r&&(Me.addHandler(r,"keydown",e.restrictNumeric),Me.addHandler(r,"keydown",e.restrictCardNumberLength),Me.addHandler(r,"keydown",e.deleteProperly),Me.addHandler(r,"keyup",e.formatNumber),Me.addHandler(r,"input",e.formatNumber),Me.addHandler(r,"input",e.validateNumber),Me.addHandler(r,"input",e.addType))},e.attachExpirationEvents=function(t){var r=document.querySelector(t);r&&(Me.addHandler(r,"keydown",e.restrictNumeric),Me.addHandler(r,"keydown",e.restrictLength(9)),Me.addHandler(r,"keyup",e.formatExpiration),Me.addHandler(r,"blur",e.formatExpiration),Me.addHandler(r,"input",e.validateExpiration),Me.addHandler(r,"blur",e.validateExpiration))},e.attachCvvEvents=function(t){var r=document.querySelector(t);r&&(Me.addHandler(r,"keydown",e.restrictNumeric),Me.addHandler(r,"keydown",e.restrictLength(4)),Me.addHandler(r,"input",e.validateCvv))},e}();Array.prototype.indexOf||(Array.prototype.indexOf=function(e,t){for(var r=t||0,n=this.length;r<n;r++)if(this[r]===e)return r;return-1});function Be(e){return e.replace(/&/g,"&amp;").replace(/[\uD800-\uDBFF][\uDC00-\uDFFF]/g,(function(e){return"&#"+(1024*(e.charCodeAt(0)-55296)+(e.charCodeAt(1)-56320)+65536)+";"})).replace(/([^\#-~| |!])/g,(function(e){return"&#"+e.charCodeAt(0)+";"})).replace(/</g,"&lt;").replace(/>/g,"&gt;")}var Ye={"card-cvv":"cc-csc","card-expiration":"cc-exp","card-number":"cc-number"},Ge=function(e){function t(t,r,n){var a=e.call(this)||this,o=r.target||"";return a.id=btoa(J()),a.type="submit"===t||"card-track"===t?"button":"input",a.url=n,a.frame=a.makeFrame(t,a.id,r),a.frame.onload=function(){a.emit("load")},a.frame.src=n+"#"+btoa(JSON.stringify({enableAutocomplete:N.enableAutocomplete,id:a.id,lang:N.language||"en",targetOrigin:window.location.href,type:a.type})),a.container=document.querySelector(o),a.container?(a.container.appendChild(a.frame),a.on("dispose",(function(){V[a.id]=void 0,a.container&&a.container.removeChild(a.frame)})),B.receive((function(e){if(e.id&&(!e.id||e.id===a.id)){var t=e.type.replace("ui:iframe-field:","");switch(t){case"register":B.post({data:N,id:a.id,type:"ui:iframe-field:update-options"},a.id);break;case"resize":a.frame.style.height=e.data.height+"px";break;case"pass-data":B.post({data:{type:e.data.type,value:e.data.value},id:e.data.target,type:"ui:iframe-field:accumulate-data"},e.data.target)}a.emit(t,e.data)}})),V[a.id]=a,a):(De.emit("error",{error:!0,reasons:[{code:"ERROR",message:"IframeField: target cannot be found with given selector"}]}),a)}return O(t,e),t.register=function(e){var r=window.location.hash.replace("#",""),n=JSON.parse(atob(r)),a=n.id,o=n.enableAutocomplete||!1;t.setHtmlLang(n.lang),t.createField(a,e,n.type,o),t.addMessageListener(a,e,n.targetOrigin),B.post({data:{type:e},id:a,type:"ui:iframe-field:register"},"parent"),t.triggerResize(a),Me.addHandler(document.body,"touchstart",(function(){}))},t.setHtmlLang=function(e){var t=document.querySelectorAll("html");if(t)for(var r=0;r<t.length;r++){t[r].lang=e}},t.createField=function(e,r,n,a){var o=document.createElement("button"===n?"button":"input");if(o.setAttribute("type","button"===n?"button":"card-holder-name"===r?"text":"tel"),o.id=G,o.className=r,o.setAttribute("data-id",e),!0===a&&Ye[r]&&o.setAttribute("autocomplete",Ye[r]),"card-track"===r){var i="Read Card";o.appendChild(document.createTextNode(i))}else if("button"===n){i="Submit";o.appendChild(document.createTextNode(i))}var c=document.createElement("label");c.id=G+"-label",c.setAttribute("for",G),c.className="offscreen";var s=document.getElementById(G+"-wrapper");if(s)switch(s.insertBefore(o,s.firstChild),s.insertBefore(c,s.firstChild),t.addFrameFocusEvent(),!0===a&&"card-number"===r&&(t.createAutocompleteField(s,e,"card-cvv","cardCsc","cc-csc"),t.createAutocompleteField(s,e,"card-expiration","cardExpiration","cc-exp"),t.createAutocompleteField(s,e,"card-holder-name","cardHolderName","cc-name")),"card-track"===r?Me.addHandler(o,"click",(function(){!function(e){var t=document.getElementById(G+"-data");t&&t.parentNode&&t.parentNode.removeChild(t),(t=document.createElement("input")).id=G+"-data",t.type="text";var r=document.querySelector(".extra-div-2");if(!r)throw new Error("TODO");r.style.height="0px",r.style.width="0px",r.style.overflow="hidden",r.appendChild(t);var n=document.getElementById(G),a=n&&n.innerText?n.innerText:"Read Card";n&&n.firstChild&&n.replaceChild(document.createTextNode("Waiting..."),n.firstChild),t.focus(),B.post({id:e,type:"ui:iframe-field:waiting-for-data"},"parent"),Me.addHandler(t,"keydown",(function(t){if(13===t.keyCode){B.post({id:e,type:"ui:iframe-field:data-received"},"parent"),t.preventDefault();var r=document.getElementById(G+"-data"),o=r&&r.value?r.value:"";Pe({"card-track":o}).then((function(t){n&&n.firstChild&&n.replaceChild(document.createTextNode(a),n.firstChild),r.blur(),B.post({data:t,id:e,type:"ui:iframe-field:token-success"},"parent")})).catch((function(t){n&&n.firstChild&&n.replaceChild(document.createTextNode(a),n.firstChild),r.blur(),B.post({data:t,id:e,type:"ui:iframe-field:token-error"},"parent")}))}}))}(e)})):"button"===n&&Me.addHandler(o,"click",(function(){B.post({id:e,type:"ui:iframe-field:click"},"parent")})),r){case"card-number":Ve.attachNumberEvents("#"+o.id),o.name="cardNumber";break;case"card-expiration":Ve.attachExpirationEvents("#"+o.id);break;case"card-cvv":Ve.attachCvvEvents("#"+o.id)}},t.createAutocompleteField=function(e,t,r,n,a){var o=document.createElement("input");o.name=n,o.className="autocomplete-hidden",o.tabIndex=-1,o.autocomplete=a,Me.addHandler(o,"input",(function(){var e=o&&o.value?o.value:"";"card-number"!==r&&"account-number"!==r||(e=""),B.post({data:{type:r,value:e},id:t,type:"ui:iframe-field:set-autocomplete-value"},"parent")})),e.appendChild(o)},t.addFrameFocusEvent=function(){var e=document.getElementById(G);if(e){var t="focus",r=function(t){t.fromElement!==e&&(t.relatedTarget||e.focus())};document.onfocusin?Me.addHandler(document,"focusin",r):Me.addHandler(document,t,r)}},t.addMessageListener=function(e,r,n){V.parent={frame:parent,url:n},B.receive((function(n){var a;if(n.id&&(!n.id||n.id===e))switch(n.type.replace("ui:iframe-field:","")){case"accumulate-data":!function(e,t,r){if("card-number"===t||"account-number"===t){var n=window;if(n.dataContents=n.dataContents||{},n.dataContents[r.data.type]=r.data.value,n.dataReceivedFields||(n.dataReceivedFields=["submit"]),n.dataReceivedFields.push(r.data.type),JSON.stringify(n.dataFields.sort())===JSON.stringify(n.dataReceivedFields.sort())){var a=document.getElementById(G),o=a&&a.value?a.value:"";Pe({"account-number":"account-number"===window.name&&o,"card-cvv":void 0!==n.dataContents["card-cvv"]&&n.dataContents["card-cvv"],"card-expiration":void 0!==n.dataContents["card-expiration"]&&n.dataContents["card-expiration"],"card-holder-name":void 0!==n.dataContents["card-holder-name"]&&n.dataContents["card-holder-name"],"card-number":"card-number"===window.name&&o,"routing-number":void 0!==n.dataContents["routing-number"]&&n.dataContents["routing-number"]}).then((function(t){n.dataContents=void 0,n.dataReceivedFields=void 0,B.post({data:t,id:e,type:"ui:iframe-field:token-success"},"parent")})).catch((function(t){n.dataContents=void 0,n.dataReceivedFields=void 0,B.post({data:t,id:e,type:"ui:iframe-field:token-error"},"parent")}))}}}(e,r,n);break;case"add-stylesheet":be(n.data.css),t.triggerResize(e);break;case"get-cvv":!function(e,t){var r=document.getElementById(G);if(r&&"card-cvv"===t&&r.value){var n=N.deviceId&&N.manifest,a=N.merchantName;B.post({data:n||a?r.value:null,id:e,type:"ui:iframe-field:get-cvv"},"parent")}}(e,r);break;case"payment-request-complete":!function(e,t){R(void 0,void 0,void 0,(function(){return I(this,(function(r){return window.globalPaymentResponse?(window.globalPaymentResponse.complete(t.data.status).then((function(){B.post({id:e,type:"ui:iframe-field:payment-request-completed"},"parent")})).catch((function(t){B.post({data:{code:"ERROR",message:t.message},id:e,type:"ui:iframe-field:error"},"parent")})),[2]):(B.post({data:{code:"ERROR",message:"Missing PaymentResponse object"},id:e,type:"ui:iframe-field:error"},"parent"),[2])}))}))}(e,n);break;case"payment-request-start":!function(e,t){R(void 0,void 0,void 0,(function(){var r,n,a,o,i,c,s,d,u,l;return I(this,(function(p){switch(p.label){case 0:return p.trys.push([0,2,,3]),[4,new PaymentRequest(t.data.instruments,t.data.details,t.data.options).show()];case 1:return r=p.sent(),window.globalPaymentResponse=r,[3,3];case 2:return n=p.sent(),a="ERROR","Error"!==n.name&&(a=n.name.replace("Error","_Error").toUpperCase()),B.post({data:{code:a,message:n.message},id:e,type:"ui:iframe-field:token-error"},"parent"),[2];case 3:return p.trys.push([3,5,,6]),[4,Pe({"card-cvv":r.details.cardSecurityCode||"","card-expiration":(r.details.expiryMonth||"")+" / "+(r.details.expiryYear||""),"card-holder-name":r.details.cardholderName||"","card-number":r.details.cardNumber||""})];case 4:return o=p.sent(),i=r.toJSON(),c=r.details.cardNumber.replace(/\D/g,""),s=c.substr(0,6),d=c.substr(-4),u=Te(c),i.details=i.details||{},i.details.cardNumber=s+"*".repeat(c.length-10)+d,i.details.cardBin=s,i.details.cardLast4=d,i.details.cardType=u?u.code:"unknown",i.details.cardSecurityCode=!!r.details.cardSecurityCode,o.details=i.details,o.methodName=i.methodName,o.payerEmail=i.payerEmail,o.payerName=i.payerName,o.payerPhone=i.payerPhone,o.requestId=i.requestId,o.shippingAddress=i.shippingAddress,o.shippingOption=i.shippingOption,B.post({data:o,id:e,type:"ui:iframe-field:token-success"},"parent"),[3,6];case 5:return l=p.sent(),r.complete("fail"),B.post({data:l,id:e,type:"ui:iframe-field:token-error"},"parent"),[3,6];case 6:return[2]}}))}))}(e,n);break;case"request-data":!function(e,t,r){window.dataReceivedFields||(window.dataReceivedFields=["submit"]);var n=document.getElementById(G),a=n&&n.value?n.value:"";"card-number"!==t&&"account-number"!==t||(window.dataFields=r.data.fields,a=""),B.post({data:{target:r.data.target,type:t,value:a},id:e,type:"ui:iframe-field:pass-data"},"parent")}(e,r,n);break;case"set-card-type":!function(e){var t=document.getElementById(G);if(t){for(var r=t.className.split(" "),n=r.length,a=0,o="";a<n;a++)(o=r[a])&&-1!==o.indexOf("card-type-")&&delete r[a];e&&r.push("card-type-"+e),t.className=r.join(" ")}}(n.data.cardType);break;case"set-focus":(a=document.getElementById(G))&&a.focus();break;case"set-placeholder":!function(e){var t=document.getElementById(G);t&&("   "===e||""===e||""===e||""===e||"   "===e?t.setAttribute("placeholder",e):t.setAttribute("placeholder",Be(e)))}(n.data.placeholder),t.triggerResize(e);break;case"set-text":!function(e){var t=document.getElementById(G);t&&(t.textContent=Be(e))}(n.data.text),t.triggerResize(e);break;case"set-value":!function(e){var t=document.getElementById(G);t&&(t.setAttribute("value",Be(e)),Me.trigger("keyup",t),Me.trigger("input",t))}(n.data.value),t.triggerResize(e);break;case"set-label":!function(e){var t=document.getElementById(G);t&&(t.setAttribute("aria-label",Be(e)),document.querySelectorAll("main").forEach((function(t){return t.setAttribute("aria-label",Be(e))})),document.querySelectorAll("#"+G+"-label").forEach((function(t){return t.textContent=Be(e)})))}(n.data.label),t.triggerResize(e);case"update-options":for(var o in n.data)n.data.hasOwnProperty(o)&&(N[o]=n.data[o])}}))},t.triggerResize=function(e){B.post({data:{height:document.body.offsetHeight+1},id:e,type:"ui:iframe-field:resize"},"parent")},t.prototype.addStylesheet=function(e){var t=xe(e);B.post({data:{css:t},id:this.id,type:"ui:iframe-field:add-stylesheet"},this.id)},t.prototype.getCvv=function(){var e=this;return B.post({id:this.id,type:"ui:iframe-field:get-cvv"},this.id),new Promise((function(t){B.receive((function(r){!r.id||r.id&&r.id!==e.id||("get-cvv"!==r.type.replace("ui:iframe-field:","")||t(r.data))}))}))},t.prototype.setFocus=function(){B.post({id:this.id,type:"ui:iframe-field:set-focus"},this.id)},t.prototype.setPlaceholder=function(e){B.post({data:{placeholder:e},id:this.id,type:"ui:iframe-field:set-placeholder"},this.id)},t.prototype.setText=function(e){B.post({data:{text:e},id:this.id,type:"ui:iframe-field:set-text"},this.id)},t.prototype.setValue=function(e){B.post({data:{value:e},id:this.id,type:"ui:iframe-field:set-value"},this.id)},t.prototype.setLabel=function(e){B.post({data:{label:e},id:this.id,type:"ui:iframe-field:set-label"},this.id)},t.prototype.setTitle=function(e){this.frame.title=e},t.prototype.makeFrame=function(e,t,r){var n=document.createElement("iframe");return n.id="secure-payment-field-"+e+"-"+t,n.name=e,(r.title||r.label)&&(n.title=r.title||r.label||""),n.style.border="0",n.frameBorder="0",n.scrolling="no",n.setAttribute("allowtransparency","true"),n.allowPaymentRequest=!0,n},t}(Ie),Je={blank:{},default:_e,simple:Oe},Ke={blank:{},default:Ne,simple:Re},Xe=["card-number","card-expiration","card-cvv","card-holder-name","card-track","account-number","routing-number","submit"],$e=function(){function e(e,t){this.totalNumberOfFields=0,this.frames={},this.fields=e,this.styles=t,this.createFrames()}return e.prototype.on=function(e,t,r){if("string"==typeof t&&r){if(We(this.frames,e),!(o=this.frames[e]))return;return o.on(t,r),this}for(var n in Xe)if(Xe.hasOwnProperty(n)){var a=Xe[n];if(this.frames.hasOwnProperty(a)){var o;if(We(this.frames,a),!(o=this.frames[a]))return;o.on(e,t)}}return this},e.prototype.addStylesheet=function(e){for(var t in Xe)if(Xe.hasOwnProperty(t)){var r=Xe[t];if(this.frames.hasOwnProperty(r)){We(this.frames,r);var n=this.frames[r];if(!n)return;n.addStylesheet(e)}}return this},e.prototype.ready=function(e){var t=this,r=0;for(var n in Xe)if(Xe.hasOwnProperty(n)){var a=Xe[n];if(this.frames.hasOwnProperty(a)){We(this.frames,a);var o=this.frames[a];if(!o)return;o.on("register",(function(){++r===t.totalNumberOfFields&&e(t.frames)}))}}},e.prototype.dispose=function(){for(var e in Xe)if(Xe.hasOwnProperty(e)){var t=Xe[e];if(this.frames.hasOwnProperty(t)){var r=this.frames[t];if(!r)return;r.emit("dispose")}}},e.prototype.createFrames=function(){for(var e=this,t=function(t){if(!r.fields[t])return"continue";var n=r.frames[t]=new Ge(t,r.fields[t],Ee()+"field.html");if(r.totalNumberOfFields++,void 0===n)return"continue";n.on("register",(function(){e.fields[t].placeholder&&n.setPlaceholder(e.fields[t].placeholder||""),e.fields[t].text&&n.setText(e.fields[t].text||""),e.fields[t].value&&n.setValue(e.fields[t].value||""),e.fields[t].label&&n.setLabel(e.fields[t].label||""),e.fields[t].title&&n.setTitle(e.fields[t].title||""),e.styles&&n.addStylesheet(e.styles)}))},r=this,n=0,a=Xe;n<a.length;n++){t(a[n])}void 0!==this.frames.submit&&this.frames.submit.on("click",(function(){var t=e.frames["card-number"]||e.frames["account-number"];t&&e.requestDataFromAll(t)}));var o=this.frames["card-number"],i=this.frames["card-cvv"];o&&o.on("set-autocomplete-value",(function(t){if(t){var r=e.frames[t.type];t.type&&t.value&&r&&r.setValue(t.value)}})),o&&i&&o.on("card-type",(function(e){B.post({data:e,id:i.id,type:"ui:iframe-field:set-card-type"},i.id)}))},e.prototype.requestDataFromAll=function(e){for(var t=[],r=0,n=Xe;r<n.length;r++){var a=n[r];this.frames[a]&&t.push(a)}for(var o=0,i=t;o<i.length;o++){if("submit"!==(a=i[o])){var c=this.frames[a];c&&B.post({data:{fields:t,target:e.id},id:c.id,type:"ui:iframe-field:request-data"},c.id)}}},e}();function We(e,t){if(-1===Xe.indexOf(t))throw new Error("Supplied field type is invalid");if(!e[t])throw new Error("No field with the type `"+t+"` is currently available")}var Qe={labels:{"card-cvv":"Card CVV","card-expiration":"Card Expiration","card-holder-name":"Card Holder Name","card-number":"Card Number"},placeholders:{"card-cvv":"","card-expiration":"MM / YYYY","card-holder-name":"Jane Smith","card-number":"   "},prefix:"credit-card-",style:"default",titles:{"card-cvv":"Card CVV Input","card-expiration":"Card Expiration Input","card-holder-name":"Card Holder Name Input","card-number":"Card Number Input",submit:"Form Submit Button Input"},values:{"card-track":"Read Card",submit:"Submit"}};var Ze=Object.freeze({__proto__:null,defaultOptions:Qe,form:function(e,t){if(void 0===t&&(t={}),"string"==typeof e){if(!(i=document.querySelector(e)))throw new Error("Credit card form target does not exist");e=i}e.className=e.className+" secure-payment-form";var r=ge();r&&"production"!==r.getEnv(N)&&_(e),t=ye(ye({},Qe),t);var n=["card-holder-name","card-number","card-expiration","card-cvv","submit"],a={};for(var o in n)if(n.hasOwnProperty(o)){var i,c=n[o];if(t.labels&&t.labels[c]){var s=document.createElement("label");s.setAttribute("for",t.prefix+c),s.appendChild(document.createTextNode(t.labels[c])),e.appendChild(s)}(i=document.createElement("div")).id=t.prefix+c,e.appendChild(i),a[c]={},a[c].target="#"+t.prefix+c,t.placeholders&&t.placeholders[c]&&(a[c].placeholder=t.placeholders[c]),t.values&&t.values[c]&&(a[c].value=t.values[c]),t.labels&&t.labels[c]&&(a[c].label=t.labels[c]),t.titles&&t.titles[c]&&(a[c].title=t.titles[c])}return t.style&&be(xe(Ke[t.style]),"secure-payment-styles-"+t.style),new $e(a,t.style?Je[t.style]:{})},trackReaderForm:function(e,t){if(void 0===t&&(t={}),"string"==typeof e){if(!(i=document.querySelector(e)))throw new Error("Credit card track reader form target does not exist");e=i}e.className=e.className+" secure-payment-form";var r=ge();r&&"production"!==r.getEnv(N)&&_(e),(t=ye(ye({},Qe),t)).prefix="track-reader-";var n=["card-track"],a={};for(var o in n)if(n.hasOwnProperty(o)){var i,c=n[o];if(t.labels&&t.labels[c]){var s=document.createElement("label");s.setAttribute("for",t.prefix+c),s.appendChild(document.createTextNode(t.labels[c])),e.appendChild(s)}(i=document.createElement("div")).id=t.prefix+c,e.appendChild(i),a[c]={},a[c].target="#"+t.prefix+c,t.placeholders&&t.placeholders[c]&&(a[c].placeholder=t.placeholders[c]),t.values&&t.values[c]&&(a[c].value=t.values[c])}return t.style&&be(xe(Ke[t.style]),"secure-payment-styles-"+t.style),new $e(a,t.style?Je[t.style]:{})}}),et={labels:{"account-number":"Account Number:","account-type":"Account Type:","check-type":"Check Type:","routing-number":"Routing Number:"},placeholders:{"account-number":"","routing-number":""},prefix:"echeck-",style:"default",values:{submit:"Submit"}};var tt=Object.freeze({__proto__:null,defaultOptions:et,form:function(e,t){if(void 0===t&&(t={}),"string"==typeof e){if(!(i=document.querySelector(e)))throw new Error("ACH/eCheck form target does not exist");e=i}e.className=e.className+" secure-payment-form";var r=ge();r&&"production"!==r.getEnv(N)&&_(e),t=ye(ye({},et),t);var n=["account-number","routing-number","account-type","check-type","submit"],a={};for(var o in n)if(n.hasOwnProperty(o)){var i,c=n[o];if(t.labels&&t.labels[c]){var s=document.createElement("label");s.setAttribute("for",t.prefix+c),s.appendChild(document.createTextNode(t.labels[c])),e.appendChild(s)}if((i=document.createElement("div")).id=t.prefix+c,e.appendChild(i),"account-type"!==c)if("check-type"!==c)a[c]={},a[c].target="#"+t.prefix+c,t.placeholders&&t.placeholders[c]&&(a[c].placeholder=t.placeholders[c]),t.values&&t.values[c]&&(a[c].value=t.values[c]);else{(l=document.createElement("select")).name="check-type",(p=document.createElement("option")).appendChild(document.createTextNode("-- Check Type --")),p.disabled=!0,p.selected=!0,l.appendChild(p);var d=document.createElement("option");d.appendChild(document.createTextNode("Checking")),l.appendChild(d);var u=document.createElement("option");u.appendChild(document.createTextNode("Savings")),l.appendChild(u),i.appendChild(l)}else{var l,p;(l=document.createElement("select")).name="account-type",(p=document.createElement("option")).appendChild(document.createTextNode("-- Account Type --")),p.disabled=!0,p.selected=!0,l.appendChild(p);var f=document.createElement("option");f.appendChild(document.createTextNode("Personal")),l.appendChild(f);var m=document.createElement("option");m.appendChild(document.createTextNode("Business")),l.appendChild(m),i.appendChild(l)}}return t.style&&be(xe(Ke[t.style])),new $e(a,t.style?Je[t.style]:{})}}),rt={labels:{"card-number":"Card Number:",pin:"PIN:"},placeholders:{"card-number":"   ",pin:""},prefix:"gift-and-loyalty-",style:"default",values:{submit:"Submit"}};var nt=Object.freeze({__proto__:null,defaultOptions:rt,form:function(e,t){if(void 0===t&&(t={}),"string"==typeof e){if(!(i=document.querySelector(e)))throw new Error("Gift and loyalty form target does not exist");e=i}e.className=e.className+" secure-payment-form";var r=ge();r&&"production"!==r.getEnv(N)&&_(e),t=ye(ye({},rt),t);var n=["card-number","pin","submit"],a={};for(var o in n)if(n.hasOwnProperty(o)){var i,c=n[o];if(t.labels&&t.labels[c]){var s=document.createElement("label");s.setAttribute("for",t.prefix+c),s.appendChild(document.createTextNode(t.labels[c])),e.appendChild(s)}if((i=document.createElement("div")).id=t.prefix+c,e.appendChild(i),"pin"!==c)a[c]={},a[c].target="#"+t.prefix+c,t.placeholders&&t.placeholders[c]&&(a[c].placeholder=t.placeholders[c]),t.values&&t.values[c]&&(a[c].value=t.values[c]);else{var d=document.createElement("input");d.name="pin",d.type="tel",i.appendChild(d)}}return t.style&&be(xe(Ke[t.style])),new $e(a,t.style?Je[t.style]:{})}});var at=function(e){function t(t){var r=e.call(this)||this;return r.iframe=t,r}return O(t,e),t.prototype.on=function(e,t){this.iframe.on(e,t)},t}(Ie);var ot=function(e){e.remove?e.remove():e.parentNode&&e.parentNode.removeChild&&e.parentNode.removeChild(e)},it=Object.freeze({__proto__:null,complete:function(e){var t=V;for(var r in t)t.hasOwnProperty(r)&&B.post({data:{status:e},id:r,type:"ui:iframe-field:payment-request-complete"},r)},setup:function(e,t,r,n,a){void 0===a&&(a=!1);var o=document.querySelector(e);if(!o)return De.emit("error",{error:!0,reasons:[{code:"INVALID_CONFIGURATION",message:"Invalid target element"}]});if("undefined"==typeof PaymentRequest)return De.emit("error",{error:!0,reasons:[{code:"ERROR",message:"PaymentRequest API not available"}]});var i=document.createElement("div");i.id="global-pay-payment-request",i.style.display="none";var c=o.parentElement;if(!c)return De.emit("error",{error:!0,reasons:[{code:"INVALID_CONFIGURATION",message:"Target element has no parent"}]});c.appendChild(i),delete o.style.display;var s=new Ge("payment-request",{target:"#"+i.id},Ee()+"field.html");r=r||[{supportedMethods:["basic-card"]}],t=t||{},n=n||{};var d=new at(s),u=function(){return B.post({data:{details:t,instruments:r,options:n},id:s.id,type:"ui:iframe-field:payment-request-start"},s.id)};return a?d.on("register",(function(){u()})):Me.addHandler(o,"click",(function(e){return e.preventDefault(),u(),!1})),s.on("token-success",(function(e){a&&ot(i),d.emit("token-success",e)})),s.on("token-error",(function(e){a&&ot(i),d.emit("token-error",e)})),s.on("payment-request-closed",(function(){a&&ot(i),d.emit("error",{error:!0,reasons:[{code:"PAYMENT_UI_CLOSED",message:"Payment UI closed"}]})})),s.on("error",(function(e){a&&ot(i),d.emit("error",{error:!0,reasons:[e]})})),d}});return{configure:function(e){for(var t in e)e.hasOwnProperty(t)&&(N[t]=e[t]);var r=ge();r&&r.actions.setup&&r.actions.setup()},creditCard:Ze,eCheck:tt,events:Me,giftAndLoyalty:nt,internal:je,on:function(e,t){return De.on(e,t)},paymentRequest:it,ui:Object.freeze({__proto__:null,form:function(e){return new $e(e.fields,e.styles||{})},fieldTypeAutocompleteMap:Ye,IframeField:Ge})}}));
//# sourceMappingURL=globalpayments.min.js.map
